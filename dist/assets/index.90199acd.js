var io=Object.defineProperty,lo=Object.defineProperties;var co=Object.getOwnPropertyDescriptors;var Ot=Object.getOwnPropertySymbols;var uo=Object.prototype.hasOwnProperty,po=Object.prototype.propertyIsEnumerable;var At=(t,o,s)=>o in t?io(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,Ce=(t,o)=>{for(var s in o||(o={}))uo.call(o,s)&&At(t,s,o[s]);if(Ot)for(var s of Ot(o))po.call(o,s)&&At(t,s,o[s]);return t},It=(t,o)=>lo(t,co(o));import{r as X,v as fo,d as le,u as e,o as C,c as E,a,b as K,e as Je,f as _,F as me,g as Lt,h as ge,i as de,j as te,k as Fe,D as Ye,I as Rt,A as Tt,H as Pt,W as Ut,l as Re,m as go,n as U,p as Te,q as ne,s as ho,P as Qe,N as Et,t as Mt,S as Ht,w as Bt,x as se,y as Ft,Y as mo,z as bo,C as yo,B as vo,E as ko,L as xo,G as wo,T as _o,J as So,U as $o,K as No,M as Co,O as Do,Q as Oo,V as Ao,R as Io,X as Lo,Z as zt,_ as Ro,$ as be,a0 as To,a1 as et,a2 as Po,a3 as D,a4 as tt,a5 as ce,a6 as ze,a7 as ue,a8 as Pe,a9 as he,aa as We,ab as je,ac as De,ad as ot,ae as Ue,af as Ee,ag as Uo,ah as Wt,ai as jt,aj as Ve,ak as Vt,al as Gt,am as Eo,an as Oe,ao as Mo,ap as mt,aq as Ho,ar as _e,as as Se,at as $e,au as Bo,av as Fo,aw as zo,ax as Wo,ay as jo}from"./vendor.1261b356.js";const Vo=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))r(d);new MutationObserver(d=>{for(const i of d)if(i.type==="childList")for(const y of i.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&r(y)}).observe(document,{childList:!0,subtree:!0});function s(d){const i={};return d.integrity&&(i.integrity=d.integrity),d.referrerpolicy&&(i.referrerPolicy=d.referrerpolicy),d.crossorigin==="use-credentials"?i.credentials="include":d.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(d){if(d.ep)return;d.ep=!0;const i=s(d);fetch(d.href,i)}};Vo();function Go(t={}){const{immediate:o=!1,onNeedRefresh:s,onOfflineReady:r,onRegistered:d,onRegisterError:i}=t;let y;const c=async(u=!0)=>{};return"serviceWorker"in navigator&&(y=new fo("/sw.js",{scope:"/"}),y.addEventListener("activated",u=>{u.isUpdate?window.location.reload():r==null||r()}),y.register({immediate:o}).then(u=>{d==null||d(u)}).catch(u=>{i==null||i(u)})),c}function Kt(t={}){const{immediate:o=!0,onNeedRefresh:s,onOfflineReady:r,onRegistered:d,onRegisterError:i}=t,y=X(!1),c=X(!1);return{updateServiceWorker:Go({immediate:o,onNeedRefresh(){y.value=!0,s==null||s()},onOfflineReady(){c.value=!0,r==null||r()},onRegistered:d,onRegisterError:i}),offlineReady:c,needRefresh:y}}const Ko={key:0,class:"pwa-toast",role:"alert"},Jo={class:"message"},qo={key:0},Zo={key:1},Xo=le({setup(t){const{offlineReady:o,needRefresh:s,updateServiceWorker:r}=Kt(),d=async()=>{o.value=!1,s.value=!1};return(i,y)=>e(o)||e(s)?(C(),E("div",Ko,[a("div",Jo,[e(o)?(C(),E("span",qo," App ready to work offline ")):(C(),E("span",Zo," New content available, click on reload button to update. "))]),e(s)?(C(),E("button",{key:0,onClick:y[0]||(y[0]=c=>e(r)())},"Reload")):K("",!0),a("button",{onClick:d},"Close")])):K("",!0)}});const Yo=le({setup(t){return(o,s)=>{const r=Je("router-view");return C(),E(me,null,[_(Xo),_(r)],64)}}}),Jt=()=>navigator.userAgent.indexOf("Mac OS X")!==-1,Qo=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),es=()=>{let t=!1;const o=document.createElement("div");if(CSS.supports("padding-bottom: env(safe-area-inset-bottom)")?(o.style.paddingBottom="env(safe-area-inset-bottom)",t=!0):CSS.supports("padding-bottom: constant(safe-area-inset-bottom)")&&(o.style.paddingBottom="constant(safe-area-inset-bottom)",t=!0),t){document.body.appendChild(o);const s=parseInt(window.getComputedStyle(o).paddingBottom);if(document.body.removeChild(o),s>0)return!0}return!1};function ts(t){return Jt()?t.metaKey:t.ctrlKey}const os=()=>"xxx-xxx-xxx".replace(/[xy]/g,function(t){const o=Math.random()*16|0;return(t=="x"?o:o&3|8).toString(16)}),bt=t=>t[Math.floor(Math.random()*t.length)],ss=()=>bt(["Isaac Newton","Friedrich Nietzsche","Johann Wolfgang von Goethe","Carl Jung","Steve Jobs","Ernesto Guevara","Robert M. Pirsig","Nikola Tesla","Leonardo da Vinci","Archimedes","Johannes Gutenberg","Galileo Galilei","Albert Einstein","Carl Benz","Steve Wozniak","Alfred Nobel","Hedy Lamarr","Ada Lovelace","Stephanie Kwolek","Grace Hopper","Konrad Zuse"]),ns=()=>bt(as()),as=()=>["#00a492","#00b1ff","#ffc711","#F98181","#b7f981","#81eff9","#8183f9","#d181f9","#f9ab81","#f9e181"],rs=t=>{let o="";if(Array.isArray(t))for(let s=0;s<t.length;s++)o+=t[s].text;else o=t;return o},is=t=>new Promise(o=>setTimeout(o,t)),ls=t=>{t=t.replace(/^\s+|\s+$/g,""),t=t.toLowerCase();const o="\xE0\xE1\xE4\xE2\xE8\xE9\xEB\xEA\xEC\xED\xEF\xEE\xF2\xF3\xF6\xF4\xF9\xFA\xFC\xFB\xF1\xE7\xB7/_,:;",s="aaaaeeeeiiiioooouuuunc------";for(let r=0,d=o.length;r<d;r++)t=t.replace(new RegExp(o.charAt(r),"g"),s.charAt(r));return t=t.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),t},cs=t=>Array.from(t.entries()).map(([o,s])=>Ce({clientId:o},s.user));function ds(t,o,s){let r={};const d=t.getMap().get(o);d&&(r=d),r.title=s.title,r.count=3,r.updatedAt=new Date().toISOString(),r.guid||(r.guid=o),r.filled=!0,r.createdAt||(r.createdAt=new Date().toISOString()),t.getMap().set(o,r)}const ye=()=>({isMac:Jt,isMobile:Qo,hasNotch:es,osKey:ts,uuid:os,delay:is,getPlainText:rs,getRandomElement:bt,getRandomUser:ss,getRandomColor:ns,stringToSlug:ls,updateDoc:ds,awarenessStatesToArray:cs}),{uuid:us,getRandomUser:ps,getRandomColor:fs}=ye(),yt="1.2.0",gs="",hs="",ms="",qt=!1,Zt=[],bs=t=>{T.value.debug&&console.log(t),T.value.debug&&Zt.push(t)},Xt={debug:qt,version:yt,useHocuspocus:!0,serverAddress:hs,serverToken:gs,useWebRtc:!1,signalingServerAddress:ms,localUserName:ps(),localUserId:us(),localUserColor:fs(),localWebRtcPassword:"",localLatestSpace:null,localLatestDocument:null,localLatestNode:null,isSettingsOpen:!1,isInfoOpen:!1,isSelectorOpen:!1,isSearchOpen:!1,isUserOpen:!1,isShareOpen:!1,isProviderOpen:!1,blurredInterface:!1,useLatestDocument:!0,showOtherColors:!0,showOtherUsers:!0,showOtherCursors:!0,useStrongGravity:!0,fixNodesOnDrag:!0,unfixLastNode:!0,zoomInOnNodeClick:!0,followNewlyCreatedNode:!0,followNewlyCreatedNodeMention:!0},T=Lt("local-lity-states",Xt),ys=()=>{T.value=Xt},Yt=()=>{T.value.isSelectorOpen=!1,T.value.isSearchOpen=!1,T.value.isSettingsOpen=!1,T.value.isInfoOpen=!1,T.value.isProviderOpen=!1,T.value.isUserOpen=!1,T.value.isShareOpen=!1,T.value.useWebRtc=!1,T.value.version<yt&&(T.value.version=yt,T.value.isInfoOpen=!0),T.value.blurredInterface&&(T.value.blurredInterface=!1,setTimeout(()=>{T.value.blurredInterface=!0},1e3))},vs=()=>{},ks=t=>{T.value.isSelectorOpen=t==="selector"?!T.value.isSelectorOpen:!1,T.value.isSearchOpen=t==="search"?!T.value.isSearchOpen:!1,T.value.isSettingsOpen=t==="settings"?!T.value.isSettingsOpen:!1,T.value.isInfoOpen=t==="info"?!T.value.isInfoOpen:!1,T.value.isProviderOpen=t==="provider"?!T.value.isProviderOpen:!1,T.value.isUserOpen=t==="user"?!T.value.isUserOpen:!1,T.value.isShareOpen=t==="share"?!T.value.isShareOpen:!1},xs=t=>{T.value.isSelectorOpen=!T.value.isSelectorOpen},ws=t=>{T.value.isSearchOpen=!T.value.isSearchOpen},_s=t=>{T.value.isSettingsOpen=!T.value.isSettingsOpen},Ss=t=>{T.value.isInfoOpen=!T.value.isInfoOpen},$s=t=>{T.value.isProviderOpen=!T.value.isProviderOpen},Ns=t=>{T.value.isUserOpen=!T.value.isUserOpen},Cs=t=>{T.value.isShareOpen=!T.value.isShareOpen};Yt();const ie=()=>({state:T,debug:qt,debugLog:Zt,toggleOnly:ks,logger:bs,checkForOpenWindows:vs,toggleSelector:xs,toggleSearch:ws,toggleSettings:_s,toggleProvider:$s,toggleInfo:Ss,toggleUser:Ns,toggleShare:Cs,setDefaults:ys,setAppDefaults:Yt}),{uuid:vt,stringToSlug:Ds}=ye(),ve=Lt("local-lity-spaces",{spaces:[]}),st=()=>{const t=ge(),o=de(),s=X(!1),r=te(()=>o.params.space),d=te(()=>o.params.space&&u(o.params.space)?u(o.params.space).url:""),i=te(()=>o.params.space&&u(o.params.space)?u(o.params.space).token:""),y=()=>{g(),s.value=!0},c=(N,R,j,F)=>{const A=R?Ds(R):vt(),W={id:N||A,name:R||"LocalStorage",url:j||null,token:F||null,index:o.params.document||vt()};ve.value.spaces.push(W)},u=N=>{for(let R=0;R<ve.value.spaces.length;R++)if(ve.value.spaces[R].id===N)return ve.value.spaces[R];return null},L=()=>ve.value.spaces[0],g=()=>{ve.value.spaces.length===0?f():(o.params.space&&(u(o.params.space)||c(o.params.space,"Shared Space",null,null)),o.params.space||O(L()),o.params.space&&!o.params.document&&O(u(o.params.space)))},f=()=>{ve.value.spaces=[],c(),c("causa-lity-cc","Lity.CC (readme only)","wss://causa.lity.cc","READ-ME-ONLY"),c("y","LocalStorage (previous versions)"),o.params.space?u(o.params.space)||c(o.params.space,"Shared Space",null,null):O(L())},S=(N,R)=>{if(N&&R)for(let j=0;j<ve.value.spaces.length;j++)ve.value.spaces[j].id===N&&(ve.value.spaces[j].index=R)},O=N=>{t.push(`/${N.id}/${N.index}/index`)};return{localSpaces:ve,resetSpaces:f,redirect:y,isRedirected:s,spaceId:r,spaceUrl:d,spaceToken:i,setIndex:S,getSpace:u,createSpace:c,setGravity:N=>{t.push(`/${o.params.space}/${N||vt()}/index`)},createDefaultSpace:g}};st();const Os=t=>{const o=Fe({hasLoadedRootDoc:!1}),s=new Ye({guid:t,autoLoad:!0}),r=s.getMap(),d=s.getMap("settings"),i=s.getText("latest"),y=new Rt(t,s),c=X();return y.once("synced",()=>{o.hasLoadedRootDoc=!0,c.value=Object.entries(r.toJSON());for(let u=0;u<c.value.length;u++)c.value[u][1].filled||r.delete(c.value[u][1].guid);r.observe(()=>{c.value=Object.entries(r.toJSON())})}),{rootState:o,yRootDoc:s,yRootDocs:r,yRootSettings:d,yRootLatestDoc:i,yRootIndexedDb:y,jRootDocs:c}},{awarenessStatesToArray:As}=ye(),Is=t=>{const{state:o,logger:s}=ie(),r=Fe({hocuspocus:{init:!1,connected:!1,authenticated:!1,readOnly:!1,awareness:[]},rtc:{init:!1,connected:!1,readOnly:!1,awareness:[]}});let d,i;const y=new Tt(t),c=(f,S)=>{f&&(d=new Pt({url:f,name:t.guid,document:t,token:S,awareness:y,onAwarenessUpdate:({states:O})=>{r.hocuspocus.awareness=O},onConnect:()=>{r.hocuspocus.connected=!0},onAuthenticated:()=>{},onAuthenticationFailed:()=>{},onMessage:({event:O,message:V})=>{},onClose:({event:O})=>{r.hocuspocus.connected=!1},onDisconnect:({event:O})=>{r.hocuspocus.connected=!1}}),r.hocuspocus.init=!0,d.setAwarenessField("user",{name:o.value.localUserName,color:o.value.localUserColor}))},u=()=>{i=new Ut(t.guid,t,{awareness:y,password:o.value.localWebRtcPassword}),r.rtc.init=!0,r.rtc.connected=!0,i.awareness.setLocalStateField("user",{name:o.value.localUserName,color:o.value.localUserColor}),i.awareness.on("update",()=>{r.rtc.awareness=As(i.awareness.states)})},L=()=>d.destroy();r.hocuspocus.connected=!1;const g=()=>i.destroy();return r.rtc.connected=!1,Re(()=>{d&&L(),i&&g()}),{rootStates:r,rootHocuspocusProvider:d,rootWebRtcProvider:i,rootAwareness:y,provideRootHocuspocus:c,provideRootWebRtc:u,destroyRootHocuspocus:L,destroyRootWebRtc:g}};var kt=(t,o)=>{for(const[s,r]of o)t[s]=r;return t};const Ls={props:{icon:{type:String,required:!0},title:{type:String,required:!0},action:{type:Function,required:!0},isActive:{type:Function,default:null}},data(){return{remixiconUrl:go}}},Rs=["title"],Ts={class:"remix"},Ps=["xlink:href"];function Us(t,o,s,r,d,i){return C(),E("button",{class:U(["menu-item text-black dark:text-white hover:bg-opacity-50 hover:bg-gray-300 dark:hover:bg-gray-800",{"bg-gray-200 dark:bg-gray-900 text-blue-500 dark:text-blue-500":s.isActive?s.isActive():null}]),title:s.title,onClick:o[0]||(o[0]=(...y)=>s.action&&s.action(...y))},[(C(),E("svg",Ts,[a("use",{"xlink:href":`${d.remixiconUrl}#ri-${s.icon}`},null,8,Ps)]))],10,Rs)}var Es=kt(Ls,[["render",Us]]);const Ms={components:{MenuItem:Es},props:{editor:{type:Object,required:!0},pane:{type:Object}},data(){return{items:[{icon:"bold",title:"Bold",action:()=>this.editor.chain().focus().toggleBold().run(),isActive:()=>this.editor.isActive("bold")},{icon:"italic",title:"Italic",action:()=>this.editor.chain().focus().toggleItalic().run(),isActive:()=>this.editor.isActive("italic")},{icon:"strikethrough",title:"Strike",action:()=>this.editor.chain().focus().toggleStrike().run(),isActive:()=>this.editor.isActive("strike")},{icon:"code-view",title:"Code",action:()=>this.editor.chain().focus().toggleCode().run(),isActive:()=>this.editor.isActive("code")},{icon:"mark-pen-line",title:"Highlight",action:()=>this.editor.chain().focus().toggleHighlight().run(),isActive:()=>this.editor.isActive("highlight")},{type:"divider"},{icon:"h-1",title:"Heading 1",action:()=>this.editor.chain().focus().toggleHeading({level:1}).run(),isActive:()=>this.editor.isActive("heading",{level:1})},{icon:"h-2",title:"Heading 2",action:()=>this.editor.chain().focus().toggleHeading({level:2}).run(),isActive:()=>this.editor.isActive("heading",{level:2})},{icon:"paragraph",title:"Paragraph",action:()=>this.editor.chain().focus().setParagraph().run(),isActive:()=>this.editor.isActive("paragraph")},{icon:"list-unordered",title:"Bullet List",action:()=>this.editor.chain().focus().toggleBulletList().run(),isActive:()=>this.editor.isActive("bulletList")},{icon:"list-ordered",title:"Ordered List",action:()=>this.editor.chain().focus().toggleOrderedList().run(),isActive:()=>this.editor.isActive("orderedList")},{icon:"list-check-2",title:"Task List",action:()=>this.editor.chain().focus().toggleTaskList().run(),isActive:()=>this.editor.isActive("taskList")},{icon:"code-box-line",title:"Code Block",action:()=>this.editor.chain().focus().toggleCodeBlock().run(),isActive:()=>this.editor.isActive("codeBlock")},{type:"divider"},{icon:"double-quotes-l",title:"Blockquote",action:()=>this.editor.chain().focus().toggleBlockquote().run(),isActive:()=>this.editor.isActive("blockquote")},{icon:"separator",title:"Horizontal Rule",action:()=>this.editor.chain().focus().setHorizontalRule().run()},{type:"divider"},{icon:"text-wrap",title:"Hard Break",action:()=>this.editor.chain().focus().setHardBreak().run()},{icon:"format-clear",title:"Clear Format",action:()=>this.editor.chain().focus().clearNodes().unsetAllMarks().run()},{type:"divider"},{icon:"arrow-go-back-line",title:"Undo",action:()=>this.editor.chain().focus().undo().run()},{icon:"arrow-go-forward-line",title:"Redo",action:()=>this.editor.chain().focus().redo().run()},{type:"divider"}]}}},Hs={class:"pl-3 pr-3"};function Bs(t,o,s,r,d,i){const y=Je("menu-item");return C(),E("div",Hs,[(C(!0),E(me,null,Te(d.items,(c,u)=>(C(),E(me,null,[c.type==="divider"?(C(),E("span",{key:`divider${u}`,class:"divider w-8"})):(C(),ne(y,ho({key:1,key:u},c),null,16))],64))),256))])}var Fs=kt(Ms,[["render",Bs]]);const zs=new Qe("mention"),Ws=Et.create({name:"mention",addOptions(){return{HTMLAttributes:{},renderLabel({options:t,node:o}){return`${o.attrs.label}`},suggestion:{char:"@",pluginKey:zs,command:({editor:t,range:o,props:s})=>{var i;const r=t.view.state.selection.$to.nodeAfter;((i=r==null?void 0:r.text)==null?void 0:i.startsWith(" "))&&(o.to+=1),t.chain().focus().insertContentAt(o,[{type:this.name,attrs:s},{type:"text",text:" "}]).run()},allow:({editor:t,range:o})=>{const s=t.state.doc.resolve(o.from),r=t.schema.nodes[this.name];return!!s.parent.type.contentMatch.matchType(r)}}}},group:"inline",inline:!0,draggable:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}}}},parseHTML(){return[{tag:"span[data-mention]"}]},renderHTML({node:t,HTMLAttributes:o}){return["span",Mt({"data-mention":"",class:"dark:bg-gray-700 dark:text-gray-200"},this.options.HTMLAttributes,o),this.options.renderLabel({options:this.options,node:t})]},renderText({node:t}){return this.options.renderLabel({options:this.options,node:t})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:o})=>{let s=!1;const{selection:r}=o,{empty:d,anchor:i}=r;return d?(o.doc.nodesBetween(i-1,i,(y,c)=>{if(y.type.name===this.name)return s=!0,t.insertText(this.options.suggestion.char||"",c,c+y.nodeSize),!1}),s):!1})}},addProseMirrorPlugins(){return[Ht(Ce({editor:this.editor},this.options.suggestion)),new Bt({key:new Qe("handleClick"),props:{handleClick:(t,o,s)=>{var d;const r=(d=s.target)==null?void 0:d.closest("span.mention");if(r){const i=window.location.href.match("(.*)#\\/(.+)\\/");return window.location.href=i[1]+"#/"+i[2]+"/"+r.getAttribute("data-id"),!0}return!1}}})]}});const js={props:{items:{type:Array,required:!0},command:{type:Function,required:!0}},data(){return{selectedIndex:0}},watch:{items(){this.selectedIndex=0}},methods:{onKeyDown({event:t}){return t.key==="ArrowUp"?(this.upHandler(),!0):t.key==="ArrowDown"?(this.downHandler(),!0):t.key==="Enter"?(this.enterHandler(),!0):!1},upHandler(){this.selectedIndex=(this.selectedIndex+this.items.length-1)%this.items.length},downHandler(){this.selectedIndex=(this.selectedIndex+1)%this.items.length},enterHandler(){this.selectItem(this.selectedIndex)},selectItem(t){const o=this.items[t];o&&this.command({id:o.id,label:o.label})}}},Vs={class:"items text-sm bg-white dark:bg-black shadow-xl backdrop-filter backdrop-blur2 backdrop-blur-lg font-mono p-0.5"},Gs=["onClick"];function Ks(t,o,s,r,d,i){return C(),E("div",Vs,[(C(!0),E(me,null,Te(s.items,(y,c)=>(C(),E("button",{key:c,class:U(["item text-gray-700 dark:text-gray-200 rounded-sm",{"dark:bg-blue-600 bg-blue-300 text-white ring-2 ring-blue-600 ":c===d.selectedIndex}]),onClick:u=>i.selectItem(c)},se(y.label),11,Gs))),128))])}var Js=kt(js,[["render",Ks],["__scopeId","data-v-59e8ae84"]]);const{awarenessStatesToArray:qs}=ye(),Qt=()=>{const{state:t,logger:o}=ie(),s=Fe({init:!1,hocuspocus:{init:!1,connected:!1,authenticated:!1,readOnly:!1,awareness:[]},rtc:{init:!1,connected:!1,readOnly:!1,awareness:[]}});let r,d;const i=f=>(d=f,r=new Tt(d),r);let y,c;const u=(f,S)=>!f&&!S?null:(y=new Pt({url:f,name:d.guid,document:d,token:S,awareness:r,onAwarenessUpdate:({states:O})=>{s.hocuspocus.awareness=O},onConnect:()=>{},onAuthenticated:()=>{},onAuthenticationFailed:()=>{},onMessage:({event:O,message:V})=>{},onClose:({event:O})=>{},onDisconnect:({event:O})=>{}}),s.hocuspocus.init=!0,y.setAwarenessField("user",{name:t.value.localUserName,color:t.value.localUserColor}),g(),y),L=()=>(c=new Ut(d.guid,d,{awareness:r,password:t.value.localWebRtcPassword}),s.rtc.init=!0,s.rtc.connected=!0,c.awareness.setLocalStateField("user",{test1:!0,name:t.value.localUserName,color:t.value.localUserColor}),c.awareness.on("update",()=>{s.rtc.awareness=qs(c.awareness.states)}),c),g=()=>{r.setLocalStateField("user",{latestDocument:"route.params.document",latestNode:"route.params.node",test:!0,name:t.value.localUserName,color:t.value.localUserColor})};return{subStates:s,subAwareness:r,subWebRtcProvider:c,subHocuspocusProvider:y,provideAwareness:i,provideSubHocuspocus:u,provideSubWebRtc:L}},Zs=new Qe("meta");Et.create({name:"meta",addOptions(){return{HTMLAttributes:{},renderLabel({options:t,node:o}){return`${o.attrs.label}`},suggestion:{char:"#",pluginKey:Zs,command:({editor:t,range:o,props:s})=>{var i;const r=t.view.state.selection.$to.nodeAfter;((i=r==null?void 0:r.text)==null?void 0:i.startsWith(" "))&&(o.to+=1),t.chain().focus().insertContentAt(o,[{type:this.name,attrs:s},{type:"text",text:" "}]).run()},allow:({editor:t,range:o})=>{const s=t.state.doc.resolve(o.from),r=t.schema.nodes[this.name];return!!s.parent.type.contentMatch.matchType(r)}}}},group:"inline",inline:!0,draggable:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}}}},parseHTML(){return[{tag:"span[data-meta]"}]},renderHTML({node:t,HTMLAttributes:o}){return["i",Mt({"data-meta":"",class:"dark:bg-gray-700 dark:text-gray-200 ri-"+t.attrs.label+"-fill"},this.options.HTMLAttributes,o)]},renderText({node:t}){return this.options.renderLabel({options:this.options,node:t})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:o})=>{let s=!1;const{selection:r}=o,{empty:d,anchor:i}=r;return d?(o.doc.nodesBetween(i-1,i,(y,c)=>{if(y.type.name===this.name)return s=!0,t.insertText(this.options.suggestion.char||"",c,c+y.nodeSize),!1}),s):!1})}},addProseMirrorPlugins(){return[Ht(Ce({editor:this.editor},this.options.suggestion)),new Bt({key:new Qe("handleClick"),props:{handleClick:(t,o,s)=>{var d;const r=(d=s.target)==null?void 0:d.closest("span.meta");if(r){const i=window.location.href.match("(.*)#\\/(.+)\\/");return window.location.href=i[1]+"#/"+i[2]+"/"+r.getAttribute("data-id"),!0}return!1}}})]}});const Xs=Ft.extend({content:"heading block*"}),{state:Ge,logger:tl}=ie();Qt();const Ys=(t,o,s,r,d,i)=>{const y=de();ge(),X([]);const{isMobile:c,getPlainText:u,delay:L}=ye(),g=o.getMap("nodes"),f=o.getMap("links"),S=new mo,O=g.get(s);let V;const N=[Xs,bo.configure({history:!1,document:!1,codeBlock:!1}),yo.configure({lowlight:vo}),ko.configure({placeholder:({node:p})=>p.type.name==="heading"?O&&O.href?"Type a title for "+O.href:"Type a title for "+s:"/"}),xo,wo,_o,So,$o,No,Co,Do,Oo,Ws.configure({HTMLAttributes:{class:"mention"},suggestion:{allowSpaces:!0,items:({query:p})=>{const b=Object.values(g.toJSON()),h=[];return b.forEach(v=>{const $=v.id!==v.title?u(v.title):v.title;h.push({id:v.id,label:$})}),p.length>0&&h.push({id:Math.floor(new Date().getTime()+Math.random()),label:p}),h.filter(v=>v.label.toLowerCase().includes(p.toLowerCase())).slice(0,10)},render:()=>{let p,b;return{onStart:h=>{p=new Ao(Js,{props:h,editor:h.editor}),b=Io("body",{getReferenceClientRect:h.clientRect,appendTo:()=>document.body,content:p.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate(h){p.updateProps(h),b[0].setProps({getReferenceClientRect:h.clientRect})},onKeyDown(h){var v;return h.event.key==="Escape"?(b[0].hide(),!0):(v=p.ref)==null?void 0:v.onKeyDown(h)},onExit(){b[0].destroy(),p.destroy()}}}}}),Lo.configure({document:o,field:s})];r&&Ge.value.showOtherCursors&&N.push(zt.configure({provider:r,user:{name:Ge.value.localUserName,color:Ge.value.localUserColor}})),d&&!r&&Ge.value.showOtherCursors&&N.push(zt.configure({provider:d,user:{name:Ge.value.localUserName,color:Ge.value.localUserColor}}));let R=!1;const j=new Ro({autofocus:!1,extensions:N,onCreate({editor:p}){M(p),H(),V=setTimeout(()=>{p.commands.focus("end")},500)},onUpdate({editor:p}){t("onUpdate"),H();function b(h,v){let $={};const P=h.getMap().get(v);P&&($=P),$.updatedAt=new Date().toISOString(),$.guid||($.guid=v),$.filled=!0,$.createdAt||($.createdAt=new Date().toISOString()),h.getMap().set(v,$)}R&&b(i,y.params.document),R||(R=!0),V&&(clearTimeout(V),V=setTimeout(()=>{M(p)},200))},onFocus({editor:p}){t("onFocus"),H(),p.commands.focus("end")},onBlur({editor:p}){t("onBlur")}}),F=p=>{const b=[];let h;function v($){if(Array.isArray($)){for(let P=0;P<$.length;P++)if(Array.isArray($[P].content)){for(let I=0;I<$[P].content.length;I++)if(Array.isArray($[P].content)&&Array.isArray($[P].content[I].marks)){const G=$[P].content[I];if(G){h={title:void 0,href:void 0},h.title=$[P].content[I].text;for(let B=0;B<$[P].content[I].marks.length;B++)h.href=$[P].content[I].marks[B].attrs.href,b.push(h)}else G.content&&v(G.content)}}}}if(Array.isArray(p)){for(let $=0;$<p.length;$++)if(Array.isArray(p[$].content)){for(let P=0;P<p[$].content.length;P++)if(Array.isArray(p[$].content)&&Array.isArray(p[$].content[P].marks)){h={title:void 0,href:void 0},h.title=p[$].content[P].text;for(let I=0;I<p[$].content[P].marks.length;I++)h.href=p[$].content[P].marks[I].attrs.href,b.push(h)}}}return v(p),b},A=p=>{const b=[];let h;function v($){if(Array.isArray($)){for(let P=0;P<$.length;P++)if(Array.isArray($[P].content)){for(let I=0;I<$[P].content.length;I++)if(Array.isArray($[P].content)){const G=$[P].content[I];G.type==="mention"?(h={title:G.attrs.label,id:G.attrs.id},b.push(h)):G.content&&v(G.content)}}}}return v(p),b};function W(p){p=p.replace(/^\s+|\s+$/g,""),p=p.toLowerCase();const b="\xE0\xE1\xE4\xE2\xE8\xE9\xEB\xEA\xEC\xED\xEF\xEE\xF2\xF3\xF6\xF4\xF9\xFA\xFC\xFB\xF1\xE7\xB7/_,:;",h="aaaaeeeeiiiioooouuuunc------";for(let v=0,$=b.length;v<$;v++)p=p.replace(new RegExp(b.charAt(v),"g"),h.charAt(v));return p=p.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),p}function M(p){let b={id:s,title:s,group:1,created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[],links:[]};const h=g.get(s);h&&(b=h,b.created||(b.created=new Date().toISOString(),g.set(s,b)));const v=p.getJSON().content;if(v&&v[0]){const $=v[0].content?v[0].content:"";if($&&u($)!==u(b.title)&&(b.title=$,g.set(s,b),s==="index"?function(I,G){let B={};const q=I.getMap().get(G);q&&(B=q),B.title=b.title,B.updatedAt=new Date().toISOString(),B.guid||(B.guid=G),B.filled=!0,B.createdAt||(B.createdAt=new Date().toISOString()),I.getMap().set(G,B)}(i,y.params.document):function(I,G){let B={};const q=I.getMap().get(G);q&&(B=q),B.updatedAt=new Date().toISOString(),B.guid||(B.guid=G),B.filled=!0,B.createdAt||(B.createdAt=new Date().toISOString()),I.getMap().set(G,B)}(i,y.params.document)),$||v[0]&&!v[0].content&&b.id!==u(b.title)&&(g.set(s,b),p.commands.setContent(b.title)),v&&v.length>=1){const P=A(v),I=F(v);for(let G=0;G<P.length;G++){const B=s.toString(),q=P[G].id.toString(),ae=f.get(B+"_"+q),pe=g.get(q);!ae&&!pe?(g.set(q,{id:q,group:1,title:""+P[G].title+"",created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[B],links:[B]}),(async()=>{await L(100),f.set(B+"_"+q,{target:q,source:B,value:0})})()):!ae&&pe&&(async()=>{await L(100),f.set(B+"_"+q,{target:q,source:B,value:0})})()}for(let G=0;G<I.length;G++){const B=s,q=I[G].href,ae=W(q),pe=g.get(ae);if((!pe||pe.href!==q)&&(g.set(ae,{id:ae,group:1,title:""+q+"",href:q,neighbors:[B],links:[B]}),f.set(ae+"_"+B,{target:B,source:ae,value:0})),pe){const ke=s,xe=W(q);g.get(xe+"_"+ke)||f.set(xe+"_"+ke,{target:ke,source:xe,value:0})}}}}}function H(){const p=document.getElementsByClassName("ProseMirror")[0];p&&p.clientHeight<=35?t("bottom"):p&&p.clientHeight>=36&&p.clientHeight<=229&&t("middle"),p&&p.clientHeight>=230&&t("top")}return{yNodes:g,yLinks:f,yxmlText:S,currentNode:O,editor:j,getAllLinks:F,getAllMentions:A,stringToSlug:W,managePane:M,changePane:H}};const Qs=a("i",{class:"ri-arrow-left-circle-fill text-2xl"},null,-1),en=[Qs],tn=a("i",{class:"ri-arrow-right-circle-fill text-2xl"},null,-1),on=[tn],sn=a("i",{class:"ri-close-circle-fill text-2xl"},null,-1),nn=[sn],an=le({props:{yRootDoc:null,yRootDocs:null,jRootDocs:null,ySubDoc:null,ySubDocIndexedDb:null,ySubDocs:null,jSubDocs:null,spaceId:null,docId:null,nodeId:null,hocuspocusProvider:null,webRtcProvider:null,subStates:null,paneVisible:null,paneState:null},emits:["onFocus","onBlur","onUpdate","bottom","middle","top","hide","back","forward","switch"],setup(t,{emit:o}){const s=t,r=()=>{const y=document.getElementsByClassName("editor__content")[0];y.scrollTop<=-50&&o("bottom"),y.scrollTop>=50&&o("top")},{state:d}=ie(),{editor:i}=Ys(o,s.ySubDoc,s.nodeId,s.hocuspocusProvider,s.webRtcProvider,s.yRootDoc);return Re(()=>{i.destroy()}),(y,c)=>(C(),E(me,null,[e(i)?(C(),E("div",{key:0,style:{width:"100%","margin-top":"-1px"},class:U(["mt-0 m-0 rounded-t-lg fixed z-20 top-0 flex bg-white dark:bg-lityblack",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":e(d).blurredInterface}])},[a("button",{class:"relative pt-0 p-1 pl-0 ml-3 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",type:"button",onClick:c[0]||(c[0]=u=>o("back"))},en),a("button",{class:"relative pt-0 p-1 pl-0 ml-1 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",type:"button",onClick:c[1]||(c[1]=u=>o("forward"))},on),_(Fs,{class:"editor__header my-2 w-auto mx-auto overflow-x-scroll whitespace-nowrap",editor:e(i)},null,8,["editor"]),a("button",{class:"relative pt-0 p-1 pr-0 mr-1 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",type:"button",onClick:c[2]||(c[2]=u=>o("switch"))},[a("i",{class:U(["text-2xl",{"ri-arrow-down-circle-fill":t.paneState==="top","ri-arrow-up-circle-fill":t.paneState!=="top"}])},null,2)]),a("button",{class:"relative pt-0 p-1 pr-0 mr-3 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",type:"button",onClick:c[3]||(c[3]=u=>o("hide"))},nn)],2)):K("",!0),e(i)?(C(),ne(e(To),{key:1,onScroll:r,onClick:c[4]||(c[4]=be(u=>e(i).commands.focus("end"),["self"])),class:"editor__content dark:text-white fixed top-0 bottom-10 left-0 right-0 overflow-y-scroll p-3 pt-12 select-auto",style:{height:"calc(95%)"},editor:e(i)},null,8,["editor"])):K("",!0)],64))}}),rn={class:"flex flex-col flex-nowrap items-center rounded-t-md rounded-b-md"},ln={class:"relative z-0 inline-flex"},cn=a("input",{id:"input",class:"hidden",type:"text"},null,-1),dn=a("i",{class:"ri-asterisk text-2xl"},null,-1),un=[dn],pn=a("i",{class:"ri-search-line text-2xl"},null,-1),fn=[pn],gn=a("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),hn=a("i",{class:"ri-refresh-line text-2xl"},null,-1),mn=[hn],bn=a("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),yn=a("i",{class:"ri-share-fill text-2xl"},null,-1),vn=[yn],kn=a("i",{class:"ri-add-circle-fill text-2xl"},null,-1),xn=[kn],wn=a("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),_n=a("i",{class:"ri-delete-bin-fill text-2xl"},null,-1),Sn=[_n],$n=a("i",{class:"ri-scissors-fill text-2xl"},null,-1),Nn=[$n],Cn=a("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),Dn=a("i",{class:"ri-arrow-go-back-fill text-2xl"},null,-1),On=[Dn],An=a("i",{class:"ri-arrow-go-forward-fill text-2xl"},null,-1),In=[An],Ln=a("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),Rn=a("i",{class:"ri-settings-5-fill text-2xl"},null,-1),Tn=[Rn],Pn=le({props:{unlinkingNodes:null,linkingNodes:null,deletingNodes:null},emits:["linkNodes","unlinkNodes","createNode","deleteNode","refreshGraph","undo","redo"],setup(t,{emit:o}){const s=t,r=et();Po(r);const{state:d,toggleInfo:i,toggleSettings:y,toggleSearch:c,toggleSelector:u}=ie();return(L,g)=>(C(),E("div",{style:{width:"23em"},class:U(["transition top-pane rounded-lg transition-all duration-500 ease-in-out bg-white dark:bg-lityblack absolute follower-bar ml-auto mr-auto left-0 right-0 z-10",{"dark:bg-lityblackblur bg-opacity-50 backdrop-filter backdrop-blur":e(d).blurredInterface,blur2:e(r)}])},[a("div",rn,[a("span",ln,[cn,a("button",{class:"tooltip -ml-px pl-1.5 pr-1.5 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:g[0]||(g[0]=(...f)=>e(u)&&e(u)(...f))},un),a("button",{type:"button",class:"tooltip p-1 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",onClick:g[1]||(g[1]=(...f)=>e(c)&&e(c)(...f))},fn),gn,a("button",{class:"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:g[2]||(g[2]=f=>o("refreshGraph"))},mn),bn,a("button",{class:U([{"text-black":!s.linkingNodes,"text-blue-500 dark:text-blue-500 animate-pulse":s.linkingNodes},"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none"]),type:"button",onClick:g[3]||(g[3]=f=>o("linkNodes"))},vn,2),a("button",{class:"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:g[4]||(g[4]=f=>o("createNode"))},xn),wn,a("button",{class:U([{"text-black":!s.deletingNodes,"text-red-500 dark:text-red-500 animate-pulse":s.deletingNodes},"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none"]),type:"button",onClick:g[5]||(g[5]=f=>o("deleteNode"))},Sn,2),a("button",{class:U([{"text-black":!s.unlinkingNodes,"text-yellow-500 dark:text-yellow-500 animate-pulse":s.unlinkingNodes},"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none"]),type:"button",onClick:g[6]||(g[6]=f=>o("unlinkNodes"))},Nn,2),Cn,a("button",{class:U([{"text-black":!s.unlinkingNodes,"text-yellow-500 dark:text-yellow-500 animate-pulse":s.unlinkingNodes},"tooltip -ml-px p-0.5 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none"]),type:"button",onClick:g[7]||(g[7]=f=>o("undo"))},On,2),a("button",{class:U([{"text-black":!s.unlinkingNodes,"text-yellow-500 dark:text-yellow-500 animate-pulse":s.unlinkingNodes},"tooltip -ml-px p-0.5 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none"]),type:"button",onClick:g[8]||(g[8]=f=>o("redo"))},In,2),Ln,a("button",{class:"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:g[9]||(g[9]=(...f)=>e(y)&&e(y)(...f))},Tn)])])],2))}}),Un={key:0,class:"font-medium leading-none text-white text-shadow-lg"},En={key:0,class:""},Mn={key:1,class:"mx-3"},Hn=le({props:{route:null,state:null},emits:["setStates"],setup(t,{emit:o}){const s=X(!1);return(r,d)=>{const i=Je("router-link");return C(),ne(i,{onMouseenter:d[0]||(d[0]=y=>s.value=!0),onMouseleave:d[1]||(d[1]=y=>s.value=!1),disabled:!t.state.user.latestDocument,to:`/${t.route.params.space}/${t.state.user.latestDocument}/${t.state.user.latestNode?t.state.user.latestNode:"index"}`,tabindex:"1",onClick:d[2]||(d[2]=y=>o("setStates")),class:U(["inline-flex transition transition-all ease-in-out duration-500 group items-center justify-center h-10 w-10 rounded-full mr-2",{"w-auto":s.value}]),style:tt("background: "+t.state.user.color)},{default:D(()=>[t.state.user&&t.state.user.name?(C(),E("span",Un,[s.value?K("",!0):(C(),E("span",En,se(t.state.user.name.split(/\s/).reduce((y,c)=>y+=c.slice(0,1),"")),1)),s.value?(C(),E("span",Mn,se(t.state.user.name),1)):K("",!0)])):K("",!0)]),_:1},8,["disabled","to","class","style"])}}}),Bn={class:"fixed inset-0 z-50 dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 overflow-y-auto"},Fn={class:"text-center"},zn=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),Wn={class:"m-3"};const jn={key:1,class:"relative mb-3 z-0 w-full inline-flex"},Vn=["onKeydown"],Gn={class:"absolute inset-y-0 right-0 flex py-0.5 pr-1.5"},Kn=a("i",{class:"ri-close-circle-fill text-2xl"},null,-1),Jn=[Kn],qn={key:0,class:"relative mt-3 z-0 overflow-ellipsis w-full overflow-x-scroll"},Zn={role:"list",style:{"max-height":"50vh"}},Xn={style:{"min-width":"300px"},class:"px-2 py-0"},Yn={class:"flex justify-between"},Qn={class:"flex"},ea={class:"flex items-center font-bold text-sm w-64"},ta=a("div",{class:"mt-2 flex items-center mt-0"},null,-1),oa={class:"mt-1 flex items-center mb-1"},sa={class:"px-2 w-28 text-sm font-medium"},na=a("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"Links ",-1),aa={class:"px-2 w-48 text-sm font-medium"},ra=a("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"Created ",-1),ia={class:"w-48 text-sm font-medium"},la=a("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"Updated ",-1),ca=le({props:{ySubDoc:null,jSubDocs:null,hocuspocusProvider:null,webRtcProvider:null,subStates:null},setup(t){const o=t;Ft.extend({content:"heading block*"});const s=de(),r=ge(),{state:d,toggleSearch:i}=ie(),y=X([]),c=X(""),u=te(()=>d.value.isSearchOpen),L=te(()=>o.jSubDocs?o.jSubDocs.filter(F=>j(F[1].title).toLowerCase().includes(c.value.toLowerCase())).slice(0,10).sort((F,A)=>j(F.title)>j(A.title)?1:j(A.title)>j(F.title)?-1:0):[]),g=X(0);ce(c,()=>{g.value=0}),ce(u,()=>{u.value?g.value=0:c.value=""});const f=()=>{g.value=(g.value+L.value.length-1)%L.value.length},S=()=>{g.value=(g.value+1)%L.value.length},O=()=>{c.value=j(L.value[g.value][1].title)},V=()=>{c.value.startsWith("{")?R(c.value):N(L.value[g.value],g.value)},N=(F,A)=>{g.value=A,i(),r.push("/"+s.params.space+"/"+s.params.document+"/"+F[0])},R=F=>{if(F){c.value="";const A=JSON.parse(F);if(A.nodes&&A.links&&A.documents){const W=Object.entries(A.links),M=Object.entries(A.nodes),H=o.ySubDoc.getMap("nodes"),p=o.ySubDoc.getMap("links");for(let b=0;b<M.length;b++)M[b][1].created||(M[b][1].created=new Date),M[b][1].updated||(M[b][1].updated=new Date),H.set(M[b][0],M[b][1]);for(let b=0;b<W.length;b++)p.set(W[b][0],W[b][1]);for(let b=0;b<A.documents.length;b++)o.ySubDoc.getXmlFragment()}}},j=F=>{let A="";if(Array.isArray(F))for(let W=0;W<F.length;W++)A+=F[W].text;else A=F;return A};return ze(()=>{y.value=o.ySubDoc.getMap("nodes").toJSON()}),(F,A)=>{const W=Je("router-link");return C(),ne(e(Ee),{show:e(d).isSearchOpen,as:"template"},{default:D(()=>[_(e(Ue),{as:"div",onClose:e(i)},{default:D(()=>[a("div",Bn,[a("div",Fn,[_(e(ue),{as:"template",enter:"duration-20 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-20 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[_(e(Pe),{class:"fixed inset-0"})]),_:1}),zn,_(e(ue),{as:"template",enter:"ease-out duration-20","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-20","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:U(["inline-block align-bottom bg-white dark:bg-lityblack mt-16 pb-3 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:align-middle sm:max-w-4xl w-full",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":e(d).blurredInterface}])},[a("div",Wn,[(t.subStates.hocuspocus.awareness&&t.subStates.hocuspocus.awareness.length>1,K("",!0)),(C(),E("span",jn,[a("form",{class:"w-full",onSubmit:A[2]||(A[2]=be(()=>{},["prevent"]))},[We(a("input",{id:"search",onKeydown:[De(be(f,["prevent"]),["up"]),De(be(S,["prevent"]),["down"]),De(be(O,["prevent"]),["right"]),De(be(V,["prevent"]),["enter"])],"onUpdate:modelValue":A[0]||(A[0]=M=>c.value=M),placeholder:"Search for Nodes",autocomplete:"off",autocapitalize:"off",spellcheck:"false",autofocus:"",type:"text",name:"search",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg pr-12"},null,40,Vn),[[je,c.value]]),a("div",Gn,[a("button",{type:"button",class:"-ml-px p-1 relative inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-200 hover:opacity-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-blue-600",onClick:A[1]||(A[1]=(...M)=>e(i)&&e(i)(...M))},Jn)])],32)])),K("",!0)]),(C(),E("div",qn,[a("ul",Zn,[(C(!0),E(me,null,Te(e(L),(M,H)=>(C(),E("li",{key:M},[M[1]&&M[1].title?(C(),ne(W,{key:0,"active-class":"bg-gray-200 dark:bg-gray-800",class:U(["mb-1 mt-0.5 m-3 block rounded-md mb-0.5 bg-white text-black dark:text-white dark:bg-gray-900 bg-opacity-50 dark:bg-opacity-50 hover:bg-gray-100 dark:hover:bg-gray-800 overflow-x-scroll",{"bg-blue-100 hover:text-black ring-2 ring-blue-600 dark:hover:text-white hover:bg-blue-200 dark:bg-blue-700 dark:hover:bg-blue-800":H===g.value}]),onClick:p=>N(M,H),to:"/"+e(s).params.space+"/"+e(s).params.document+"/"+M[0]},{default:D(()=>[a("div",Xn,[a("div",Yn,[a("div",Qn,[a("p",ea,se(j(M[1].title)),1)]),ta,a("div",oa,[a("p",sa,[na,he(" "+se(M[1].links.length),1)]),a("p",aa,[ra,_(e(ot),{time:M[1].created},{default:D(({timeAgo:p})=>[he(se(p),1)]),_:2},1032,["time"])]),a("p",ia,[la,_(e(ot),{time:M[1].updated},{default:D(({timeAgo:p})=>[he(se(p),1)]),_:2},1032,["time"])])])])])]),_:2},1032,["class","onClick","to"])):K("",!0)]))),128))])]))],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])}}}),nt=et(),z=Fe({autoLink:!1,linkingNodes:!1,unlinkingNodes:!1,deletingNodes:!1,firstNode:void 0,secondNode:void 0,jsonDocuments:[]}),{osKey:da}=ye(),{state:qe,logger:ol}=ie(),ua=(t,o,s,r,d,i)=>{const y="graph";let c;const u=de(),L=ge(),g=te(()=>u.params.node);te(()=>u.params.space);const f=Uo(),S=t.getMap("nodes"),O=t.getMap("links");t.getMap("selected");const V=new Wt(S),N=new Wt(O),R=te(()=>r.hocuspocus.awareness),j=te(()=>r.rtc.awareness),F=X(),A={background:"rgba(255,255,255,0)",fontSize:16,lineColor:"#a7bac4",lineWidth:1,particleWidth:1.5,highlightedForeground:qe.value.localUserColor||"#009dff",node:{note:"#00192a",placeholder:"#414141"}},W=jt().domain([0,30]).range([.5,2]).clamp(!0),M=jt().domain([1.2,2]).range([0,1]).clamp(!0),H={background:A.background,fontSize:parseInt(A.fontSize)-2,lineColor:A.lineColor,lineWidth:parseFloat(A.lineWidth),particleWidth:parseFloat(A.particleWidth),highlightedForeground:A.highlightedForeground,node:{note:A.node.note,placeholder:A.node.placeholder}},p={background:"rgba(0,0,0,0)",fontSize:16,lineColor:"#656565",lineWidth:1,particleWidth:1.5,highlightedForeground:qe.value.localUserColor||"#009dff",node:{note:"#eaeaea",placeholder:"#a1a1a1"}},b={selectedNodes:new Set,hoverNode:null,focusNodes:new Set,focusLinks:new Set,hoverNodes:new Set,hoverLinks:new Set,nodeInfo:{},data:{nodes:[],links:[]},style:H},h=n=>{n(b);const l=new Set,m=new Set,k=new Set,w=new Set;if(b.hoverNode){k.add(b.hoverNode);const x=b.nodeInfo[b.hoverNode];x!==void 0&&(x.neighbors.forEach(oe=>l.add(oe)),x.links.forEach(oe=>m.add(oe)))}b.selectedNodes&&b.selectedNodes.forEach(x=>{l.add(x);const oe=b.nodeInfo[x];oe!==void 0&&(oe.neighbors.forEach(ee=>l.add(ee)),oe.links.forEach(ee=>m.add(ee)))}),b.focusNodes=l,b.focusLinks=m,b.hoverNodes=k,b.hoverLinks=w},v={refresh:n=>h(l=>{l.nodeInfo=n.nodes;const m=n.links,k=new Set(Object.keys(l.nodeInfo)),w=new Set;l.data.nodes.forEach((x,oe)=>{k.has(x.id)?k.delete(x.id):w.add(oe)}),w.forEach(x=>{l.data.nodes.splice(x,1)}),k.forEach(x=>{S.get(x)&&l.data.nodes.push({id:x,y:S.get(x).y,x:S.get(x).x})}),l.data.links=m,l.hoverNode=l.nodeInfo[l.hoverNode]!=null?l.hoverNode:null,l.selectedNodes=new Set(Array.from(l.selectedNodes).filter(x=>l.nodeInfo[x]!=null)),f.graphData(l.data)}),selectNode:(n,l)=>h(m=>{if(l||m.selectedNodes.clear(),n!=null){m.selectedNodes.add(n);const k=f.graphData().nodes;for(const[w,x]of Object.entries(k))if(x.id===n){f.centerAt(x.x,x.y,300),f.zoom(7,300);break}}}),highlightNode:n=>h(l=>{l.hoverNode=n}),updateStyle:n=>{!n||(b.style=It(Ce(Ce({},H),n),{lineColor:n.lineColor||n.node&&n.node.note||H.lineColor,node:Ce(Ce({},H.node),n.node)}),f.backgroundColor(b.style.background))}},$=(n,l=!0)=>(Object.values(n.nodes).forEach(m=>{m.neighbors=[],m.links=[]}),l||n.links.forEach(m=>{try{const k=n.nodes[m.source||m.source.id],w=n.nodes[m.target||m.target.id];k&&w&&(k.neighbors.push(w.id),w.neighbors.push(k.id),k.links.push(m),w.links.push(m))}catch(k){console.log(k)}}),n);function P(){const n=[],l=[];O.forEach((m,k,w)=>{l.push(m)});for(let m=0;m<l.length;m++)l[m].source&&l[m].source.id?S.get(l[m].source.id)&&S.get(l[m].target.id)&&n.push({source:l[m].source.id,target:l[m].target.id,value:0}):S.get(l[m].source)&&S.get(l[m].target)&&n.push({source:l[m].source,target:l[m].target,value:0});return n}const I=(n=!1)=>{const l=P(),m=S.toJSON();S.get("index")||(S.set("index",{id:"index",group:1,title:"",created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[],links:[]}),v.selectNode("index"));function k(oe,ee){let Y={};const re=oe.getMap().get(ee);re&&(Y=re);const J=Object.entries(m).length;Y.count!==J&&(Y.count=J),Y.updatedAt=new Date().toISOString(),Y.guid||(Y.guid=ee),Y.filled=!0,Y.createdAt||(Y.createdAt=new Date().toISOString()),Y.count.toString()!==J.toString()&&oe.getMap().set(ee,Y)}k(i,u.params.document);const x=$({nodes:m,links:l},n);v.refresh(x),f.d3ReheatSimulation()},G=()=>{f.zoom(f.zoom()+1,300)},B=()=>{f.zoom(f.zoom()-1,300)},q=()=>{f.d3Force("center",Ve(0,0)),f.d3Force("x",Vt(0).strength(.1)),f.d3Force("y",Gt(0).strength(.1)),Xe()},ae=()=>{f.d3Force("center",Ve(0,0)),f.d3Force("x",Vt(0).strength(.01)),f.d3Force("y",Gt(0).strength(.01)),Xe()},pe=n=>{const l=Object.values(S.toJSON()),m=[];for(let k=0;k<l.length;k++)n.toLowerCase()===getPlainText(l[k].title).toLowerCase()&&m.push(l[k].id);return[]},ke=n=>{const l=pe(n);return l.length>=1?l[0]:!1},xe=n=>!!S.get(n).getJSON(),Ae=(n,l,m)=>(S.set(n,{id:n,group:1,title:""+l+"",neighbors:[],links:[]}),n),Q=(n,l)=>(O.set(n+"_"+l,{source:n,target:l,value:0}),n+"_"+l),Z=(n,l)=>{const k=Math.floor(new Date().getTime()+Math.random()).toString();return Ae(k,n,l)},fe=(n,l,m)=>{const w=Math.floor(new Date().getTime()+Math.random()).toString(),x=Ae(w,l,m);return Q(n,w),x},Ie=(n,l)=>{z.linkingNodes&&(z.linkingNodes=!1),z.deletingNodes&&(z.deletingNodes=!1),z.unlinkingNodes&&(z.unlinkingNodes=!1);const m=Math.floor(new Date().getTime()+Math.random());let k;if(l){const Y=g.value||null,re=l.id?l.id.toString():Y,J=m.toString();k=J,re?(S.set(J,{id:J,group:1,created:new Date().toISOString(),updated:new Date().toISOString(),title:""+J+"",neighbors:[re],links:[re]}),O.set(re+"_"+J,{source:re,target:J,value:0})):S.set(J,{id:J,group:1,title:""+J+"",created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[],links:[]})}else k=m,S.set(m.toString(),{id:m.toString(),group:1,title:""+m.toString()+"",created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[],links:[]});const w=P(),x={nodes:S.toJSON(),links:w},oe=S.get(k),ee=$(x,!1);v.refresh(ee),v.selectNode(k),f.centerAt(oe.x,oe.y,300),L.push({path:`/${u.params.space}/${u.params.document}/${k}`})},Ke=()=>{f(c).cooldownTicks(50).graphData(b.data).backgroundColor(b.style.background).linkHoverPrecision(8).d3Force("collide",Eo(f.nodeRelSize())).linkWidth(()=>b.style.lineWidth||A.lineWidth).linkDirectionalParticles(1).linkDirectionalParticleWidth(n=>ct(n,b)==="highlighted"?b.style.particleWidth||A.particleWidth:0).nodeCanvasObject((n,l,m)=>{const k=b.nodeInfo[n.id];if(k==null){console.error(`Could not find info for node ${n.id} - skipping`);return}const w=W(k.neighbors.length),{fill:x,border:oe}=xt(n.id,b),ee=b.style.fontSize/m*1.1,Y=lt(n.id,b),re=x.copy({opacity:Y==="regular"?M(m):Y==="highlighted"?1:Math.min(M(m),x.opacity)}),J=oe.copy({opacity:Y==="regular"?M(m):Y==="highlighted"?1:Math.min(M(m),x.opacity)}),we=(Ne=>{let Be="";const ro=[];if(Array.isArray(Ne))for(let ht=0;ht<Ne.length;ht++)Be+=Ne[ht].text;else Be=Ne;return{text:Be,marks:ro}})(k.title).text,no=JSON.stringify(k.title).toString(),Ct=/(\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/gi,ft=we.match(Ct);we.replace(Ct,"");const ao=n.id.startsWith("http"),gt=no.includes("highlight");function Le(Ne,Be){return Ne.length>Be?Ne.substr(0,Be-1)+"...":Ne}Oe(re).copy({opacity:.3});const Dt=Y==="lessened";ft&&!gt?He(l).circle(n.x,n.y,w+.5,J).circle(n.x,n.y,w,re).text(Le(we,48),n.x,n.y+w+1,ee,J):gt&&!ft?He(l).circle(n.x,n.y,w+.5,J).circle(n.x,n.y,w,re).highlighted(Le(we,48),n.x,n.y+w+1,ee,J,Dt,M(m)).text(Le(we,48),n.x,n.y+w+1,ee,J):gt&&ft?He(l).highlighted(Le(we,48),n.x,n.y+w,ee,J,Dt,M(m)).text(Le(we,48),n.x,n.y-w+1,ee,J):ao?He(l).circle(n.x,n.y,w,J).text(Le(we,48),n.x,n.y+w+1,ee,J):He(l).circle(n.x,n.y,w+.5,J).circle(n.x,n.y,w,re).text(Le(we,48),n.x,n.y+w+1,ee,J)}).linkColor(n=>wt(n,b)).nodePointerAreaPaint((n,l,m)=>{const k=6;m.beginPath(),m.arc(n.x,n.y,k,0,2*Math.PI,!1),m.fillStyle=l,m.fill(),m.closePath()}).onNodeHover(n=>{o("onNodeHover",n),v.highlightNode(n==null?void 0:n.id)}).onNodeClick((n,l)=>{if(o("onNodeClick",n),z.unlinkingNodes){dt(n.id);return}if(z.deletingNodes){ut(n.id);return}if(da(l)){const m=S.get(n.id);m.href&&open(m.href)}else n.fx=n.x,n.fy=n.y,z.linkingNodes&&(z.firstNode&&z.firstNode.length>3?St(z.firstNode,n.id):z.firstNode=n.id),f.centerAt(n.x,n.y,300),v.selectNode(n.id,!1),L.push({path:`/${u.params.space}/${u.params.document}/${n.id}`})}).onLinkRightClick((n,l)=>{o("onLinkRightClick")}).onZoom((n,l)=>{o("onZoom")}).onZoomEnd((n,l)=>{o("onZoomEnd")}).onLinkHover((n,l)=>{o("onLinkHover")}).onLinkClick((n,l)=>{o("onLinkClick")}).onLinkRightClick((n,l)=>{o("onLinkRightClick")}).onEngineTick((n,l)=>{o("onEngineTick")}).onEngineStop((n,l)=>{o("onEngineStop")}).onBackgroundClick(()=>{o("onBackgroundClick"),v.selectNode(void 0,!1),L.push({path:`/${u.params.space}/${u.params.document}`})}).onBackgroundRightClick(n=>{o("onBackgroundRightClick",n),f.screen2GraphCoords(n.x,n.y),Ie()}).onNodeRightClick(n=>{o("onNodeRightClick",n),Ie(!1,n)}).onNodeDrag(n=>{o("onNodeDrag",n)}).onNodeDragEnd(n=>{o("onNodeDragEnd",n),n.fx&&n.fy?(n.fx=void 0,n.fy=void 0):(n.fx=n.x,n.fy=n.y)})},Ze=n=>{const l=[],m=r.hocuspocus.awareness.length>1?Object.values(r.hocuspocus.awareness):r.rtc.awareness.length>1?Object.values(r.rtc.awareness):[];if(m)for(let k=0;k<m.length;k++){const w=m[k].user;w&&w.latestDocument&&w.latestNode&&w.latestNode===n&&l.push(w)}return l};function xt(n,l){var ee,Y,re,J;const m=l.nodeInfo[n],k=l.style,w=Oe((Y=k.node[(ee=m.type)!=null?ee:"note"])!=null?Y:k.node.note);let x=Oe((J=k.node[(re=m.type)!=null?re:"note"])!=null?J:k.node.note);const oe=qe.value.showOtherColors?Ze(n):[];switch(oe.length>=1&&(x=Oe(oe[0].color)),n===g.value&&(x=Oe(qe.value.localUserColor)),lt(n,l)){case"regular":return{fill:w,text:w,border:x};case"lessened":const Nt=Oe(w).copy({opacity:.3}),pt=Oe(x).copy({opacity:.3});return{fill:Nt,text:pt,border:pt};case"focused":return{fill:Oe(k.highlightedForeground),text:w,border:x};case"highlighted":return{fill:w,text:w,border:x};default:throw new Error("Unknown type for node",n)}}function wt(n,l){const m=l.style;switch(ct(n,l)){case"regular":return m.lineColor;case"highlighted":return m.highlightedForeground;case"focused":return m.highlightedForeground;case"lessened":return Mo(m.lineColor).copy({opacity:.5});default:throw new Error("Unknown type for link",n)}}function lt(n,l){return l.selectedNodes.has(n)?"highlighted":l.hoverNode===n?"focused":l.focusNodes.size===0||l.focusNodes.has(n)?"regular":"lessened"}function ct(n,l){return l.focusNodes.size===0?"regular":l.focusLinks.has(n)?"highlighted":"lessened"}const He=n=>({circle:function(l,m,k,w){return n.beginPath(),n.arc(l,m,k,0,2*Math.PI,!1),n.fillStyle=w,n.fill(),n.closePath(),this},ring:function(l,m,k,w){return n.beginPath(),n.arc(l,m,k*2,0,2*Math.PI,!1),n.fillStyle=w,n.fill(),n.closePath(),this},text:function(l,m,k,w,x){return n.font=`${w}px Sans-Serif`,n.textAlign="center",n.textBaseline="top",n.fillStyle=x,n.fillText(l,m,k),this},emoji:function(l,m,k,w,x){return n.font=`${w}px Sans-Serif`,n.textAlign="center",n.globalAlpha=.7,n.fillStyle=x,n.fillText(l,m,k),this},highlighted:function(l,m,k,w,x,oe,ee){n.font=`${w}px Sans-Serif`,n.fillStyle="rgba(255,251,0,"+(ee-.2)+")",oe&&(n.fillStyle="rgba(255,251,0,"+(ee-.2)+")");const Y=n.measureText(l).width;return n.fillRect(m-Y/2,k,Y,parseInt(n.font,0)*1.1),this}}),_t=()=>{L.push(`/${u.params.space}/${u.params.document}/`)},eo=()=>{z.deletingNodes&&(z.deletingNodes=!1),z.unlinkingNodes&&(z.unlinkingNodes=!1),g.value&&g.value.length>3&&(z.firstNode=g.value),z.linkingNodes=!z.linkingNodes,z.linkingNodes||(z.firstNode=null)},to=()=>{z.deletingNodes&&(z.deletingNodes=!1),z.linkingNodes&&(z.linkingNodes=!1),g.value&&g.value.length>3?dt(g.value):z.unlinkingNodes=!z.unlinkingNodes},oo=()=>{z.linkingNodes&&(z.linkingNodes=!1),z.unlinkingNodes&&(z.unlinkingNodes=!1),g.value&&g.value.length>3?ut(g.value):z.deletingNodes=!z.deletingNodes},St=(n,l)=>{n&&l&&(z.firstNode=void 0,z.secondNode=void 0,O.set(n+"_"+l,{source:n,target:l,value:0})),z.linkingNodes=!1},dt=n=>{n&&(S.forEach((l,m)=>{const k=l.neighbors,w=l.links;for(let x=0;x<k.length;x++)k[x]===n&&k.splice(x,1);for(let x=0;x<w.length;x++)(w[x].source==n||w[x].source.id==n||w[x].target==n||w[x].target.id==n)&&w.splice(x,1)}),O.forEach((l,m)=>{(l.target==n||l.source==n)&&(O.delete(m,1),I(!0))}),I(!1))},ut=n=>{n&&n!="index"?(S.delete(n.toString()),S.forEach((l,m)=>{const k=l.neighbors,w=l.links;for(let x=0;x<k.length;x++)k[x]===n&&k.splice(x,1);for(let x=0;x<w.length;x++)(w[x].source==n||w[x].source.id==n||w[x].target==n||w[x].target.id==n)&&w.splice(x,1)}),I(!1),_t()):o("deleteIndex")},$t=()=>{f.graphData().nodes.forEach((n,l,m)=>{n.fx&&n.fy&&(n.fx=void 0,n.fy=void 0)}),I(!1)};function so(){if(f.d3Force("center",Ve(0,0)),f.zoomToFit(300,20),g.value){const n=f.graphData().nodes;for(const[l,m]of Object.entries(n))if(m.id===g.value){f.d3Force("center",Ve(0,0)),f.centerAt(m.x,m.y,300);break}v.selectNode(g.value,!1)}}const Xe=()=>{f&&f._destructor(),Ke(),$t(),I(),F.value=Object.entries(S.toJSON()),f.width(window.innerWidth),f.height(window.innerHeight);const n=X(!0);f.onEngineStop(()=>{const l=f.graphData().nodes;if(n.value)if(l.length>1){if(f.d3Force("center",Ve(0,0)),f.zoomToFit(50,20),n.value=!1,g.value){for(const[m,k]of Object.entries(l))if(k.id===g.value){f.d3Force("center",Ve(0,0)),f.centerAt(k.x,k.y,50);break}v.selectNode(g.value,!1)}}else f.zoomToFit(50,0);f.cooldownTicks(20)}),window.addEventListener("resize",()=>{f.width(window.innerWidth),f.height(window.innerHeight)}),window.addEventListener("orientationchange",function(){f.width(window.innerWidth),f.height(window.innerHeight)})};return ze(()=>{if(c=document.getElementById(y),c!==void 0){S.observe(()=>{I(),F.value=Object.entries(S.toJSON())}),O.observe(()=>{I()}),ce(g,(l,m)=>{z.autoLink&&O.set(l+"_"+m,{source:l,target:m,value:0})}),ce(R,()=>{}),ce(j,()=>{}),ce(nt,()=>{nt.value&&v.updateStyle(p),nt.value||v.updateStyle(H)});const n=te(()=>qe.value.useStrongGravity);ce(n,()=>{n.value?q():ae()}),Xe(),nt.value?v.updateStyle(p):v.updateStyle(H),n.value?q():ae()}}),Re(()=>{f._destructor()}),ce(g,()=>{g.value?(v.selectNode(g.value,!1),o("show")):(v.selectNode(void 0,!1),o("hide"))}),{galaxyState:z,Actions:v,graph:f,update:h,augmentGraphInfo:$,updateLinks:P,updateAll:I,zoomIn:G,zoomOut:B,gravityOn:q,gravityOff:ae,nodesWithTitle:pe,hasNodesWithTitle:ke,doesNodeExist:xe,createNodeOrUpdate:Ae,directLinkNodes:Q,createRootNode:Z,createChildNode:fe,doAction:Ie,initDataviz:Ke,isWithUser:Ze,getNodeColor:xt,getLinkColor:wt,getNodeState:lt,getLinkState:ct,Draw:He,unsetID:_t,linkNodes:eo,unlinkNodes2:to,deleteNodes2:oo,linkNodesPermanent:St,unLinkNodes:dt,deleteNode:ut,unfixAll:$t,Escape:so,reRenderGraph:Xe,jsonDocuments:F,yUndoManagerNodes:V,yUndoManagerLinks:N}},pa=le({props:{yRootDoc:null,ySubDoc:null,ySubDocIndexedDb:null,ySubDocs:null,jSubDocs:null,spaceId:null,docId:null,nodeId:null,hocuspocusProvider:null,webRtcProvider:null,subStates:null,rootStates:null,paneVisible:null},emits:["onBackgroundClick","onBackgroundRightClick","onNodeHover","onNodeClick","onNodeRightClick","onNodeDrag","onNodeDragEnd","onLinkRightClick","onZoom","onZoomEnd","onLinkHover","onLinkClick","onLinkRightClick","onEngineTick","onEngineStop","deleteIndex","hide","show"],setup(t,{emit:o}){const s=t,r=et(),{state:d}=ie(),{osKey:i}=ye(),{galaxyState:y,graph:c,computedNodeId:u,gravityOn:L,gravityOff:g,reRenderGraph:f,Escape:S,deleteNodes2:O,unLinkNodes:V,unlinkNodes2:N,doAction:R,linkNodes:j,jsonDocuments:F,zoomIn:A,zoomOut:W,deleteNode:M,yUndoManagerNodes:H,yUndoManagerLinks:p}=ua(s.ySubDoc,o,s.docId,s.rootStates,s.hocuspocusProvider,s.yRootDoc);window.rpc&&window.rpc.notify&&mt.listen("tauri://menu",({event:h,payload:v})=>{switch(v){case"Center-Gravity":L();break;case"No-Gravity":g();break;case"Unfix-Gravity":f();break;case"Previous Node":break;case"Next Node":break;case"Exit Node":S();break;case"Delete Node":O();break;case"Cut Node-Links":N();break;case"New Root-Node":R(!1,!1);break;case"New Child-Node":R(!1,{id:s.nodeId});break;case"Link Nodes":j();break}});const b=h=>{h.key==="Escape"&&(h.preventDefault(),S()),h.key==="k"&&i(h)&&(h.preventDefault(),R(!1,{id:s.nodeId})),h.key==="o"&&i(h)&&h.preventDefault(),h.key==="j"&&i(h)&&(h.preventDefault(),R(!1,!0)),h.key==="l"&&i(h)&&(h.preventDefault(),V(s.nodeId)),h.key==="+"&&i(h)&&(h.preventDefault(),A()),h.key==="."&&i(h)&&(h.preventDefault(),d.value.useStrongGravity=!d.value.useStrongGravity),h.key==="-"&&i(h)&&(h.preventDefault(),W()),h.key==="Backspace"&&i(h)&&(h.preventDefault(),M(s.nodeId))};return ze(()=>{document.addEventListener("keydown",b)}),Re(()=>{document.removeEventListener("keydown",b)}),(h,v)=>(C(),E(me,null,[_(ca,{"y-sub-doc":t.ySubDoc,"sub-states":t.subStates,"j-sub-docs":t.jSubDocs,"hocuspocus-provider":t.hocuspocusProvider,"web-rtc-provider":t.webRtcProvider},null,8,["y-sub-doc","sub-states","j-sub-docs","hocuspocus-provider","web-rtc-provider"]),_(Pn,{"linking-nodes":e(y).linkingNodes,"unlinking-nodes":e(y).unlinkingNodes,"deleting-nodes":e(y).deletingNodes,onRefreshGraph:v[0]||(v[0]=$=>e(f)()),onUndo:v[1]||(v[1]=$=>{e(H).undo(),e(p).undo()}),onRedo:v[2]||(v[2]=$=>{e(H).redo(),e(p).redo()}),onLinkNodes:e(j),onUnlinkNodes:e(N),onCreateNode:v[3]||(v[3]=$=>t.nodeId?e(R)(!1,{id:t.nodeId}):e(R)(!1,!0)),onDeleteNode:e(O)},null,8,["linking-nodes","unlinking-nodes","deleting-nodes","onLinkNodes","onUnlinkNodes","onDeleteNode"]),a("div",{id:"graph",class:U([{"dark-bg":e(r)},"select-none fixed top-0 left-0 right-0 bottom-0"])},null,2)],64))}}),fa=t=>{const{isMobile:o,hasNotch:s}=ye(),r=ge(),d=de();let i;const y=te(()=>d.params.document),c=te(()=>d.params.node),u=Fe({paneCreated:!1,paneVisible:!1,paneState:"",backupPaneState:""}),L=()=>{o()&&(i.currentBreak()==="top"||i.moveToBreak("middle"))},g=()=>{u.paneVisible=!0,i.present()},f=()=>{i.hide()},S=W=>{c.value&&i.moveToBreak(W)},O=()=>{i.currentBreak()==="top"?(S("bottom"),u.paneState="bottom"):i.currentBreak()==="middle"?(S("top"),u.paneState="top"):i.currentBreak()==="bottom"&&(S("middle"),u.paneState="middle")},V=()=>{i.isPanePresented()&&!i.isHidden()&&(u.paneVisible=!1,i.hide())},N=()=>{r.push(`/${d.params.space}/${d.params.document}/`)},R=()=>{r.forward()},j=()=>{r.back()},F=()=>{i=new Ho(".editor-pane",{breaks:{top:{enabled:!0,height:window.innerHeight-(s()&&o()?110:50),bounce:!1},middle:{enabled:!0,height:300,bounce:!1},bottom:{enabled:!0,height:s()&&o()?120:100,bounce:!1}},buttonClose:!1,showDraggable:o(),draggableOver:o(),initialBreak:"bottom",dragBy:[".pane .draggable"],clickBottomOpen:!1,fastSwipeClose:!1,fitHeight:!1,fitScreenHeight:!1,bottomOffset:-10,onDidDismiss:()=>{t.value&&y.value&&r.push(`/${t.value}/${y.value}/`),u.paneVisible=!1},onWillPresent:()=>{u.paneVisible=!0},onTransitionEnd:()=>{var W;u.paneState=i.currentBreak()?(W=i.currentBreak())==null?void 0:W.toString():"",i.isPanePresented()?c.value||i.hide():i.present()}}),u.paneCreated=!0,i.isPanePresented()?c.value||i.hide():i.present(),u.backupPaneState&&i.moveToBreak(u.backupPaneState)},A=()=>{var W;u.paneCreated=!1,u.backupPaneState=(W=i.currentBreak())==null?void 0:W.toString(),i.destroy()};return ze(()=>{F()}),Re(()=>{A(),u.paneCreated=!1}),{editorPaneState:u,editorPane:i,moveToFocus:L,showPane:g,hidePane:V,moveTo:S,switchPane:O,hide:f,unsetId:N,goForward:R,goBack:j,destroyPane:A,createPane:F}},ga=(t,o,s)=>{const r=Fe({hasLoadedSubDoc:!1});ge();const d=de(),i=te(()=>d.params.node),y=t.getMap();let c;const u=()=>{y.delete(c.guid);const O=c.getMap("nodes"),V=c.getMap("links"),N=O.toJSON(),R=Object.entries(N),j=V.toJSON(),F=Object.entries(j);for(let A=0;A<R.length;A++){const W=c.getXmlFragment(R[A][0]);W.delete(0,W.length),O.delete(R[A][0])}for(let A=0;A<F.length;A++)V.delete(F[A][0])},L=O=>{const V=y.get(O);V?(V.updatedAt=new Date().toString(),y.set(O,V)):y.set(O,{guid:O,title:"Index",createdAt:new Date().toString(),updatedAt:new Date().toString()})};s&&s.length>=1?c=new Ye({guid:s,autoLoad:!0}):c=new Ye({autoLoad:!0});const g=c.getMap("nodes"),f=X(),S=new Rt(c.guid,c);return S.once("synced",()=>{r.hasLoadedSubDoc=!0,(!s||!i.value)&&L(c.guid),f.value=Object.entries(g.toJSON()),g.observe(()=>{f.value=Object.entries(g.toJSON())})}),{subDocState:r,ySubDoc:c,ySubDocIndexedDb:S,ySubDocs:g,jSubDocs:f,deleteSubDoc:u}},ha={class:"overflow-hidden"},ma=le({props:{yRootDoc:null,yRootDocIndexedDb:null,yRootDocs:null,jRootDocs:null,spaceId:null,spaceUrl:null,spaceToken:null,docId:null,nodeId:null,hocuspocusProvider:null,webRtcProvider:null,rootStates:null},setup(t){const o=t,s=ge();de();const{state:r,logger:d,toggleSearch:i,checkForOpenWindows:y,toggleOnly:c}=ie(),{osKey:u}=ye(),L=X(),g=X(),{editorPaneState:f,editorPane:S,destroyPane:O,moveToFocus:V,showPane:N,hidePane:R,moveTo:j,switchPane:F,unsetId:A,goForward:W,goBack:M,createPane:H}=fa(o.spaceId),{subDocState:p,ySubDoc:b,ySubDocIndexedDb:h,ySubDocs:v,jSubDocs:$,deleteSubDoc:P}=ga(o.yRootDoc,o.spaceId,o.docId?o.docId:null),{subStates:I,provideAwareness:G,provideSubHocuspocus:B,provideSubWebRtc:q}=Qt();G(b);const ae=te(()=>o.nodeId);te(()=>o.docId);const pe=te(()=>r.value.useWebRtc),ke=te(()=>r.value.useHocuspocus);X(!1);const xe=et();pe.value&&!g.value&&(g.value=q()),ke.value&&!L.value&&(L.value=B(o.spaceUrl,o.spaceToken)),window.rpc&&window.rpc.notify&&mt.listen("tauri://menu",({event:Q,payload:Z})=>{switch(Z){case"Open Search":i();break;case"Toggle Editor Breaks":F();break}});const Ae=Q=>{if(Q.key==="Escape"&&(Q.preventDefault(),s.push(`/${o.spaceId}/${o.docId}`)),Q.key==="Tab"&&Q.shiftKey&&!Q.altKey&&(Q.preventDefault(),F()),Q.key==="f"&&u(Q)&&(Q.preventDefault(),c("search")),Q.key==="Backspace"&&Q.shiftKey&&u(Q)&&(Q.preventDefault(),P(o.docId)),Q.key==="p"&&u(Q)){Q.preventDefault();const Z={nodes:[],links:[],documents:[]};Z.nodes=b.getMap("nodes").toJSON(),Z.links=b.getMap("links").toJSON();const fe=Object.entries(Z.nodes);for(let Ie=0;Ie<fe.length;Ie++){const Ke=fe[Ie][1],Ze=b.getXmlFragment(Ke.id);Z.documents.push([Ke.id,JSON.stringify(Ze)])}}};return ce(ae,()=>{ae.value&&ae.value.length>=3?N():R()}),ce(pe,()=>{pe.value?g.value=q():g.value&&g.value.destroy()}),ce(ke,()=>{ke.value?L.value=B(o.spaceUrl,o.spaceToken):L.value&&L.value.destroy()}),ze(()=>{document.addEventListener("keydown",Ae);let Q;window.addEventListener("resize",()=>{f.paneCreated&&O(),clearTimeout(Q),Q=setTimeout(()=>{H()},200)})}),Re(()=>{g.value&&g.value.destroy(),L.value&&L.value.destroy(),document.removeEventListener("keydown",Ae)}),(Q,Z)=>(C(),E("div",ha,[a("div",{class:U(["cupertino-pane editor-pane select-none",{blur:e(r)?e(r).blurredInterface&&!e(xe):!1,"blur-dark":e(r)?e(r).blurredInterface&&e(xe):!1,dark:e(r)&&!e(r).blurredInterface&&e(xe)}])},[e(p).hasLoadedSubDoc&&t.nodeId&&e(f).paneCreated?(C(),ne(an,{key:t.spaceId+t.docId+t.nodeId,"y-root-doc":t.yRootDoc,"y-root-docs":t.yRootDocs,"j-root-docs":t.jRootDocs,"y-sub-doc":e(b),"y-sub-doc-indexed-db":e(h),"y-sub-docs":e(v),"j-sub-docs":e($),"space-id":t.spaceId,"doc-id":t.docId,"node-id":t.nodeId,"hocuspocus-provider":L.value,"web-rtc-provider":g.value,"sub-states":e(I),"pane-visible":e(f).paneVisible,"pane-state":e(f).paneState,onOnFocus:Z[0]||(Z[0]=fe=>e(V)()),onBottom:Z[1]||(Z[1]=fe=>e(j)("bottom")),onMiddle:Z[2]||(Z[2]=fe=>e(j)("middle")),onTop:Z[3]||(Z[3]=fe=>e(j)("top")),onHide:Z[4]||(Z[4]=fe=>e(A)()),onBack:Z[5]||(Z[5]=fe=>e(M)()),onForward:Z[6]||(Z[6]=fe=>e(W)()),onSwitch:Z[7]||(Z[7]=fe=>e(F)())},null,8,["y-root-doc","y-root-docs","j-root-docs","y-sub-doc","y-sub-doc-indexed-db","y-sub-docs","j-sub-docs","space-id","doc-id","node-id","hocuspocus-provider","web-rtc-provider","sub-states","pane-visible","pane-state"])):K("",!0)],2),e(p).hasLoadedSubDoc&&t.docId&&e(f).paneCreated?(C(),ne(pa,{key:t.spaceId+t.docId,"y-root-doc":t.yRootDoc,"y-sub-doc":e(b),"y-sub-doc-indexed-db":e(h),"y-sub-docs":e(v),"j-sub-docs":e($),"space-id":t.spaceId,"doc-id":t.docId,"node-id":t.nodeId,"hocuspocus-provider":L.value,"web-rtc-provider":g.value,"sub-states":e(I),"root-states":t.rootStates,"pane-visible":e(f).paneVisible,onHide:e(R),onShow:e(N),onDeleteIndex:Z[8]||(Z[8]=fe=>{e(P)(o.docId)})},null,8,["y-root-doc","y-sub-doc","y-sub-doc-indexed-db","y-sub-docs","j-sub-docs","space-id","doc-id","node-id","hocuspocus-provider","web-rtc-provider","sub-states","root-states","pane-visible","onHide","onShow"])):K("",!0)]))}}),ba={class:"fixed inset-0 z-50 dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 overflow-y-auto"},ya={class:"text-center"},va=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),ka={class:"m-3"},xa={key:0,class:"pb-4"},wa={key:1,class:"relative z-0 w-full mb-4 inline-flex justify-between"},_a=["onKeydown","placeholder"],Sa={class:"absolute inset-y-0 right-0 flex py-0.5 pr-1.5"},$a=a("i",{class:"ri-question-fill text-2xl"},null,-1),Na=[$a],Ca=a("i",{class:"ri-close-circle-fill text-2xl"},null,-1),Da=[Ca],Oa={class:"relative z-0 w-full inline-flex"},Aa=a("i",{class:"ri-focus-line pr-1.5 text-2xl"},null,-1),Ia=he(" New Gravity "),La=[Aa,Ia],Ra=he(" Change Space "),Ta={class:"relative z-0 overflow-ellipsis w-full overflow-x-scroll"},Pa={role:"list"},Ua={style:{"min-width":"300px"},class:"px-2"},Ea={class:"flex justify-between"},Ma={class:"flex"},Ha={class:"mx-1 flex items-center text-sm w-64 font-bold"},Ba=a("div",{class:"mt-1 flex items-center text-sm sm:mt-0"},null,-1),Fa={class:"mt-1 flex items-center text-sm sm:mt-0"},za={key:0,class:"px-1 w-28 text-sm font-medium"},Wa=a("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"nodes ",-1),ja={class:"w-48 text-md font-medium"},Va=a("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"UPDATED ",-1),Ga={class:"px-1 w-48 text-sm font-medium"},Ka=a("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"CREATED ",-1),Ja=a("p",{class:"opacity-0 px-2 groups-hover:opacity-100"},[a("i",{class:"ri-delete-bin-2-fill text-lg"})],-1),qa=le({props:{yRootDoc:null,yRootDocIndexedDb:null,jRootDocs:null,hocuspocusProvider:null,webRtcProvider:null,rootStates:null},emits:["createDocument"],setup(t,{emit:o}){const s=t,r=de(),d=ge(),{state:i,toggleSelector:y,toggleProvider:c,toggleShare:u,toggleUser:L,toggleOnly:g}=ie(),{getPlainText:f}=ye(),S=X(""),O=X(0),V=(H,p)=>{W(H,p)},N=te(()=>s.jRootDocs?s.jRootDocs.filter(H=>H[1].title&&f(H[1].title).toLowerCase().includes(S.value.toLowerCase())).sort((H,p)=>H.updatedAt>p.updatedAt?-1:H.updatedAt<p.updatedAt?1:0).sort((H,p)=>f(H.title)>f(p.title)?1:f(p.title)>f(H.title)?-1:0):[]),R=()=>{O.value=(O.value+N.value.length-1)%N.value.length},j=()=>{O.value=(O.value+1)%N.value.length},F=()=>{S.value=f(N.value[O.value][1].title)},A=()=>{S.value.startsWith("/")?d.push(S.value):S.value.startsWith("{")?M(S.value):W(N.value[O.value][0],O.value)},W=(H,p)=>{O.value=p,y(),d.push("/"+r.params.space+"/"+H+"/index"),p>=N.value.length},M=H=>{if(H){S.value="";const p=JSON.parse(H);if(p.nodes&&p.links&&p.documents){const b=new Ye;d.push(`/${r.params.space}/${b.guid}/index`);const h=Object.entries(p.links),v=Object.entries(p.nodes),$=b.getMap("nodes"),P=b.getMap("links");for(let I=0;I<v.length;I++)$.set(v[I][0],v[I][1]);for(let I=0;I<h.length;I++)P.set(h[I][0],h[I][1]);for(let I=0;I<p.documents.length;I++);}}};return(H,p)=>{const b=Je("router-link");return C(),ne(e(Ee),{show:e(i).isSelectorOpen,as:"template"},{default:D(()=>[_(e(Ue),{as:"div",onClose:e(y)},{default:D(()=>[a("div",ba,[a("div",ya,[_(e(ue),{as:"template",enter:"duration-20 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-20 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[_(e(Pe),{class:"fixed inset-0 backdrop-filter backdrop-blur2"})]),_:1}),va,_(e(ue),{as:"template",enter:"ease-out duration-20","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-20","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:U(["inline-block align-bottom bg-white dark:bg-lityblack mt-16 p-0 rounded-lg pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:align-middle sm:max-w-4xl w-full",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":e(i).blurredInterface}])},[a("div",ka,[t.rootStates.hocuspocus.awareness&&t.rootStates.hocuspocus.awareness.length>1?(C(),E("div",xa,[(C(!0),E(me,null,Te(t.rootStates.hocuspocus.awareness,h=>(C(),ne(Hn,{key:h.clientId,route:e(r),state:h},null,8,["route","state"]))),128))])):K("",!0),(C(),E("span",wa,[a("form",{class:"w-full",onSubmit:p[3]||(p[3]=be(()=>{},["prevent"]))},[We(a("input",{id:"search",onKeydown:[De(be(R,["prevent"]),["up"]),De(be(j,["prevent"]),["down"]),De(be(F,["prevent"]),["right"]),De(be(A,["prevent"]),["enter"])],"onUpdate:modelValue":p[0]||(p[0]=h=>S.value=h),placeholder:"/"+e(r).params.space+"/"+(e(r).params.document?e(r).params.document+"/"+(e(r).params.node?e(r).params.node:""):""),autocomplete:"off",autocapitalize:"off",spellcheck:"false",autofocus:"",tabindex:"0",type:"text",name:"search",class:"border-0 h-8 bg-white dark:bg-gray-800 dark:text-white bg-opacity-50 dark:bg-opacity-50 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-100 block w-full pl-3 py-5 pr-12 rounded-lg"},null,40,_a),[[je,S.value]]),a("div",Sa,[a("button",{type:"button",class:"-ml-px p-1 relative inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-200 hover:opacity-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-blue-600",onClick:p[1]||(p[1]=h=>e(g)("info"))},Na),a("button",{type:"button",class:"-ml-px p-1 relative inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-200 hover:opacity-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-blue-600",onClick:p[2]||(p[2]=(...h)=>e(y)&&e(y)(...h))},Da)])],32)])),a("span",Oa,[a("button",{type:"button",class:"ml-1 p-1 pr-3 relative inline-flex items-center text-sm font-medium text-gray-900 dark:text-gray-100 hover:opacity-70 focus:z-10 focus:outline-none",onClick:p[4]||(p[4]=h=>{o("createDocument"),e(y)()})},La),a("button",{type:"button",class:"ml-1 p-1 pr-3 relative inline-flex items-center text-sm font-medium text-gray-900 dark:text-gray-100 hover:opacity-70 focus:z-10 focus:outline-none",onClick:p[5]||(p[5]=h=>{e(y)(),e(c)()})},[a("i",{class:U([{"animate animate-pulse text-green-600 dark:text-green-400":t.rootStates.hocuspocus.connected&&e(i).useHocuspocus},"ri-focus-2-line pr-1.5 text-2xl"])},null,2),Ra]),a("button",{type:"button",class:"ml-1 p-1 pr-3 relative inline-flex items-center text-sm font-medium text-gray-900 dark:text-gray-100 hover:opacity-70 focus:z-10 focus:outline-none",onClick:p[6]||(p[6]=h=>{e(y)(),e(u)()})},[a("i",{class:U([{"animate animate-pulse text-blue-600 dark:text-blue-400":e(i).useWebRtc},"ri-broadcast-line pr-1.5 text-2xl"])},null,2),he(" "+se(e(i).useWebRtc?"Sharing":"Share")+" P2P ",1)]),a("button",{type:"button",class:"ml-1 p-1 pr-3 relative inline-flex items-center text-sm font-medium text-gray-900 dark:text-gray-100 hover:opacity-70 focus:z-10 focus:outline-none",onClick:p[7]||(p[7]=h=>{e(y)(),e(L)()})},[a("i",{class:"ri-fingerprint-line pr-1.5 text-2xl",style:tt("color: "+e(i).localUserColor)},null,4),he(" "+se(e(i).localUserName),1)])])]),a("div",Ta,[a("ul",Pa,[(C(!0),E(me,null,Te(e(N),(h,v)=>(C(),E("li",{class:"group",key:h[1].id},[h[1]&&h[1].title?(C(),ne(b,{key:0,"active-class":"bg-gray-200 dark:bg-gray-800",class:U(["mb-1 mt-1 m-3 block rounded-md bg-white text-black dark:text-white dark:bg-gray-900 bg-opacity-50 dark:bg-opacity-50 group-hover:bg-gray-100 group-hover:bg-opacity-50 dark:group-hover:bg-gray-800 overflow-x-scroll",{"bg-blue-100 group-hover:text-black ring-2 ring-blue-600 dark:group-hover:text-white hover:bg-blue-200 dark:bg-blue-700 dark:group-hover:bg-blue-800":v===O.value}]),to:"/"+e(r).params.space+"/"+h[1].id+"/index",onClick:$=>V(h[0],v)},{default:D(()=>[a("div",Ua,[a("div",Ea,[a("div",Ma,[a("p",Ha,se(e(f)(h[1].title)),1)]),Ba,a("div",Fa,[(C(),E("p",za,[Wa,he(" "+se(h[1].count),1)])),a("p",ja,[Va,_(e(ot),{time:h[1].updatedAt},{default:D(({timeAgo:$})=>[he(se($),1)]),_:2},1032,["time"])]),a("p",Ga,[Ka,_(e(ot),{time:h[1].createdAt},{default:D(({timeAgo:$})=>[he(se($),1)]),_:2},1032,["time"])]),Ja])])])]),_:2},1032,["class","to","onClick"])):K("",!0)]))),128))])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])}}});var Za="/assets/icon.43d42a8c.png";const Xa={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 backdrop-filter backdrop-blur2 inset-0 z-50 overflow-y-auto"},Ya={class:"text-center"},Qa=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),er={class:"grid grid-cols-2 text-black dark:text-white"},tr=a("img",{class:"mx-auto h-32 w-auto",src:Za,alt:"lity logo"},null,-1),or={class:"mx-auto my-auto"},sr=a("h1",{class:"mb-2 leading-1 text-2xl"},[he("Lity "),a("span",{class:"text-gray-700 dark:text-gray-300"},"Beta")],-1),nr={class:"text-gray-600 dark:text-gray-200"},ar=le({setup(t){de(),ge();const{state:o,toggleInfo:s}=ie();return(r,d)=>(C(),ne(e(Ee),{show:e(o).isInfoOpen,as:"template"},{default:D(()=>[_(e(Ue),{as:"div",onClose:e(s)},{default:D(()=>[a("div",Xa,[a("div",Ya,[_(e(ue),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[_(e(Pe),{class:"fixed inset-0"})]),_:1}),Qa,_(e(ue),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:U(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all m-3 sm:align-middle sm:max-w-md sm:w-full sm:p-6",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":e(o).blurredInterface}])},[a("div",null,[a("div",er,[tr,a("div",or,[sr,a("span",nr,"Version "+se(e(o).version),1)])])]),K("",!0)],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),rr={class:"h-full flex flex-col overflow-hidden dark:text-white text-black"},ir=le({props:{spaceId:null,spaceUrl:null,spaceToken:null},setup(t){const o=t,s=de(),{state:r,logger:d,toggleOnly:i}=ie(),{osKey:y}=ye(),{getSpace:c,setGravity:u,setIndex:L}=st(),{rootState:g,yRootDoc:f,yRootDocs:S,yRootIndexedDb:O,jRootDocs:V}=Os(o.spaceId),{rootStates:N,rootHocuspocusProvider:R,rootWebRtcProvider:j,rootAwareness:F,provideRootHocuspocus:A,provideRootWebRtc:W,destroyRootWebRtc:M,destroyRootHocuspocus:H}=Is(f);c(o.spaceId);const p=te(()=>r.value.useWebRtc),b=te(()=>r.value.useHocuspocus);p.value&&W(),b.value&&A(o.spaceUrl,o.spaceToken),te(()=>s.params.space);const h=te(()=>s.params.document),v=te(()=>s.params.node);ce(v,()=>{$()}),ce(h,()=>{$(),h.value||u()});const $=()=>{F.setLocalStateField("user",{latestNode:v.value?v.value:null,latestDocument:h.value?h.value:null,latestSpace:o.spaceId||null,name:r.value.localUserName,color:r.value.localUserColor})};window.rpc&&window.rpc.notify&&mt.listen("tauri://menu",({event:I,payload:G})=>{}),ce(p,()=>{p.value?W():M()}),ce(b,()=>{b.value?A(o.spaceUrl,o.spaceToken):H()});const P=I=>{I.key==="p"&&y(I)&&(I.preventDefault(),i("selector"))};return ze(()=>{document.addEventListener("keydown",P)}),Re(()=>{document.removeEventListener("keydown",P)}),(I,G)=>(C(),E("div",rr,[_(ar),e(g).hasLoadedRootDoc?(C(),ne(qa,{key:0,"y-root-doc":e(f),"y-root-doc-indexed-db":e(O),"hocuspocus-provider":e(R),"web-rtc-provider":e(j),"root-states":e(N),"j-root-docs":e(V),onCreateDocument:e(u)},null,8,["y-root-doc","y-root-doc-indexed-db","hocuspocus-provider","web-rtc-provider","root-states","j-root-docs","onCreateDocument"])):K("",!0),e(g).hasLoadedRootDoc?(C(),ne(ma,{"y-root-doc":e(f),"y-root-doc-indexed-db":e(O),"y-root-docs":e(S),"j-root-docs":e(V),key:e(s).params.space+e(s).params.document,"space-id":e(s).params.space,"space-token":t.spaceToken,"space-url":t.spaceUrl,"doc-id":e(s).params.document,"node-id":e(s).params.node,"hocuspocus-provider":e(R),"web-rtc-provider":e(j),"root-states":e(N)},null,8,["y-root-doc","y-root-doc-indexed-db","y-root-docs","j-root-docs","space-id","space-token","space-url","doc-id","node-id","hocuspocus-provider","web-rtc-provider","root-states"])):K("",!0)]))}}),lr={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 backdrop-filter backdrop-blur2 inset-0 z-50 overflow-y-auto"},cr={class:"text-center"},dr=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),ur={class:"mt-2"},pr=a("h1",{class:"text-2xl text-center"},"Settings ",-1),fr={key:0,class:"mt-1"},gr=a("div",{class:"text-xs font-sans font-bold text-gray-500 dark:text-gray-400 uppercase text-center tracking-wider"}," general ",-1),hr={class:"my-2"},mr=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Reopen last document on start",-1),br={class:"my-2"},yr=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Create new document on start",-1),vr=a("div",{class:"text-xs font-sans font-bold text-gray-500 dark:text-gray-400 uppercase text-center tracking-wider"}," visual ",-1),kr={class:"my-2"},xr=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Enable blurred windows",-1),wr=a("div",{class:"text-xs font-sans font-bold text-gray-500 dark:text-gray-400 uppercase text-center tracking-wider"}," collaboration ",-1),_r={class:"my-2"},Sr=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Show other online users in selectors",-1),$r={class:"my-2"},Nr=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Dye nodes in user color",-1),Cr={class:"my-2"},Dr=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Show cursors in nodes",-1),Or=a("span",{class:"text-sm text-gray-500"},null,-1),Ar=a("div",{class:"text-xs font-sans font-bold text-gray-500 dark:text-gray-400 uppercase text-center tracking-wider"}," gravity ",-1),Ir={class:"my-2"},Lr=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Use stronger gravity forces ",-1),Rr=a("span",{class:"text-sm mx-2 float-right text-gray-500"},[a("kbd",null,"\u2318"),a("kbd",null,".")],-1),Tr=le({emits:["change"],setup(t,{emit:o}){de(),ge();const{state:s,toggleInfo:r,toggleSettings:d,setDefaults:i}=ie();return X(),X(),(y,c)=>(C(),ne(e(Ee),{show:e(s).isSettingsOpen,as:"template"},{default:D(()=>[_(e(Ue),{as:"div",onClose:e(d)},{default:D(()=>[a("div",lr,[a("div",cr,[_(e(ue),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[_(e(Pe),{class:"fixed inset-0"})]),_:1}),dr,_(e(ue),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:U(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-3 text-left overflow-hidden shadow-xl transform transition-all sm:align-middle sm:max-w-md w-full",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":e(s).blurredInterface}])},[a("div",null,[a("div",ur,[pr,(C(),E("div",fr,[gr,a("div",hr,[_(e(_e),{as:"div",class:"flex justify-between"},{default:D(()=>[_(e(Se),{as:"span",class:""},{default:D(()=>[mr]),_:1}),_(e($e),{modelValue:e(s).useLatestDocument,"onUpdate:modelValue":c[0]||(c[0]=u=>e(s).useLatestDocument=u),class:U([e(s).useLatestDocument?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:U([e(s).useLatestDocument?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),a("div",br,[_(e(_e),{as:"div",class:"flex justify-between"},{default:D(()=>[_(e(Se),{as:"span",class:""},{default:D(()=>[yr]),_:1}),_(e($e),{modelValue:e(s).useLatestDocument,"onUpdate:modelValue":c[1]||(c[1]=u=>e(s).useLatestDocument=u),class:U([e(s).useLatestDocument?"bg-gray-200 dark:bg-gray-800":"bg-blue-600","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:U([e(s).useLatestDocument?"translate-x-0":"translate-x-5","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),vr,a("div",kr,[_(e(_e),{as:"div",class:"flex justify-between"},{default:D(()=>[_(e(Se),{as:"span",class:""},{default:D(()=>[xr]),_:1}),_(e($e),{modelValue:e(s).blurredInterface,"onUpdate:modelValue":c[2]||(c[2]=u=>e(s).blurredInterface=u),class:U([e(s).blurredInterface?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:U([e(s).blurredInterface?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),wr,a("div",_r,[_(e(_e),{as:"div",class:"flex justify-between"},{default:D(()=>[_(e(Se),{as:"span",class:""},{default:D(()=>[Sr]),_:1}),_(e($e),{modelValue:e(s).showOtherUsers,"onUpdate:modelValue":c[3]||(c[3]=u=>e(s).showOtherUsers=u),class:U([e(s).showOtherUsers?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:U([e(s).showOtherUsers?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),a("div",$r,[_(e(_e),{as:"div",class:"flex justify-between"},{default:D(()=>[_(e(Se),{as:"span",class:""},{default:D(()=>[Nr]),_:1}),_(e($e),{modelValue:e(s).showOtherColors,"onUpdate:modelValue":c[4]||(c[4]=u=>e(s).showOtherColors=u),class:U([e(s).showOtherColors?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:U([e(s).showOtherColors?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),a("div",Cr,[_(e(_e),{as:"div",class:"flex justify-between"},{default:D(()=>[_(e(Se),{as:"span",class:""},{default:D(()=>[Dr,Or]),_:1}),_(e($e),{modelValue:e(s).showOtherCursors,"onUpdate:modelValue":c[5]||(c[5]=u=>e(s).showOtherCursors=u),class:U([e(s).showOtherCursors?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:U([e(s).showOtherCursors?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),Ar,a("div",Ir,[_(e(_e),{as:"div",class:"flex justify-between"},{default:D(()=>[_(e(Se),{as:"span",class:""},{default:D(()=>[Lr]),_:1}),Rr,_(e($e),{modelValue:e(s).useStrongGravity,"onUpdate:modelValue":c[6]||(c[6]=u=>e(s).useStrongGravity=u),class:U([e(s).useStrongGravity?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:U([e(s).useStrongGravity?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),K("",!0),K("",!0),K("",!0),K("",!0),K("",!0),a("div",{onClick:c[12]||(c[12]=u=>{e(i)(),e(d)()}),class:"cursor-pointer text-xs font-sans font-bold m-3 text-gray-500 uppercase text-center tracking-wider"}," defaults ")]))])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),Pr={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 inset-0 z-50 overflow-y-auto"},Ur={class:"text-center"},Er=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),Mr={class:""},Hr={class:"pb-2"},Br=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Synchronize with Server",-1),Fr=a("span",{class:"text-sm text-gray-500 dark:text-gray-400"}," (when set)",-1),zr={key:0,class:"mt-2"},Wr={class:"space-y-2"},jr=["onClick"],Vr={class:"flex dark:text-white text-black items-center"},Gr={class:"text-sm"},Kr={as:"p",class:"font-medium text-gray-900 dark:text-gray-100"},Jr={key:0,as:"div",class:"text-gray-500"},qr={class:"sm:inline"},Zr=he(" "+se(" ")+" "),Xr=a("span",{class:"hidden sm:inline sm:mx-1","aria-hidden":"true"},"\xB7",-1),Yr={key:1,class:""},Qr={class:"my-2 w-full"},ei=a("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Server Address",-1),ti={class:"mt-1 relative rounded-md shadow-sm"},oi=["onUpdate:modelValue"],si={class:"my-1"},ni=a("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Access Code",-1),ai={class:"mt-1 relative rounded-md shadow-sm"},ri=["onUpdate:modelValue"],ii=a("p",null,"Leave empty if you want this space to remain offline.",-1),li=["onClick"],ci={as:"div",class:"mt-2 flex text-sm sm:mt-0 sm:block sm:ml-4 sm:text-right"},di={class:"font-medium text-gray-900 dark:text-gray-300"},ui=le({emits:["change"],setup(t,{emit:o}){const s=de(),r=ge(),{state:d,toggleInfo:i,toggleProvider:y,toggleSelector:c,toggleOnly:u}=ie(),{localSpaces:L,resetSpaces:g,getSpace:f}=st();X(),X();const S=X(L.value.spaces[0]);return(O,V)=>(C(),ne(e(Ee),{show:e(d).isProviderOpen,as:"template"},{default:D(()=>[_(e(Ue),{as:"div",onClose:e(y)},{default:D(()=>[a("div",Pr,[a("div",Ur,[_(e(ue),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[_(e(Pe),{class:"fixed inset-0"})]),_:1}),Er,_(e(ue),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:U(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all m-3 sm:align-middle sm:max-w-md sm:w-full sm:p-6",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":e(d).blurredInterface}])},[a("div",null,[a("div",Mr,[a("div",Hr,[_(e(_e),{as:"div",class:"flex justify-between"},{default:D(()=>[_(e(Se),{as:"span",class:""},{default:D(()=>[Br,Fr]),_:1}),_(e($e),{modelValue:e(d).useHocuspocus,"onUpdate:modelValue":V[0]||(V[0]=N=>e(d).useHocuspocus=N),class:U([e(d).useHocuspocus?"bg-green-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:U([e(d).useHocuspocus?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),(C(),E("div",zr,[a("div",null,[a("div",Wr,[(C(!0),E(me,null,Te(e(L).spaces,N=>(C(),E("div",{as:"template",key:N.id,onClick:R=>S.value=N.id},[a("div",{class:U([N.id!==S.value?"border-transparent":"border-gray-300 ring-2 ring-blue-600",N.id===e(s).params.space?" bg-blue-300 dark:bg-blue-600 bg-opacity-50 dark:bg-opacity-50":"","relative block border rounded-lg shadow-sm px-6 py-4 cursor-pointer sm:flex sm:justify-between focus:outline-none dark:bg-opacity-50 bg-opacity-50"])},[a("div",Vr,[a("div",Gr,[a("div",Kr,se(N.name),1),N.url?(C(),E("div",Jr,[a("p",qr,se(N.url)+" / "+se(N.id),1),Zr,Xr])):K("",!0),S.value===N.id?(C(),E("div",Yr,[a("div",Qr,[ei,a("div",ti,[We(a("input",{"onUpdate:modelValue":R=>N.url=R,tabindex:"0",type:"text",name:"lity-server",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"wss://causa.lity.cc"},null,8,oi),[[je,N.url]])])]),a("div",si,[ni,a("div",ai,[We(a("input",{"onUpdate:modelValue":R=>N.token=R,type:"text",name:"lity-server",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"xxxx-xxxx-xxxx-xxxx"},null,8,ri),[[je,N.token]])])]),ii,N.id!==e(s).params.space?(C(),E("button",{key:0,type:"button",class:"mt-2 rounded-lg p-3 shadow-xl bg-blue-700 text-white bg-opacity-50",onClick:R=>{e(r).push(`/${N.id}/`),e(u)("selector")}}," Set as current Space ",8,li)):K("",!0)])):K("",!0)])]),a("div",ci,[a("div",di,"/"+se(N.id),1)]),a("div",{class:U([N.id===e(s).params.space?"border":"border-2",N.id===S.value?"border-white":"border-opacity-50","absolute -inset-px rounded-lg pointer-events-none"]),"aria-hidden":"true"},null,2)],2)],8,jr))),128))])])])),K("",!0),K("",!0)])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),pi={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 backdrop-filter backdrop-blur2 inset-0 z-50 overflow-y-auto"},fi={class:"text-center"},gi=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),hi={class:""},mi={key:0,class:"mt-2"},bi={class:"mt-2"},yi=a("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Display Name",-1),vi={class:"mt-1 relative rounded-md shadow-sm"},ki={class:"mt-2"},xi=a("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Color",-1),wi={class:"mt-1 relative rounded-md shadow-sm"},_i={class:"absolute inset-y-0 right-0 flex py-0.5 pr-1.5"},Si={type:"button",class:"-ml-px p-1 relative inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-200 focus:z-10 focus:outline-none"},$i={class:"mt-4"},Ni={class:"flex justify-between","aria-label":"Tabs"},Ci=["onClick"],Di=le({emits:["change"],setup(t,{emit:o}){de(),ge();const{state:s,toggleInfo:r,toggleProvider:d,toggleUser:i}=ie();X(),X();const y=[{color:"#00a492",current:!1},{color:"#00b1ff",current:!1},{color:"#ffc711",current:!1},{color:"#F98181",current:!1},{color:"#b7f981",current:!1},{color:"#81eff9",current:!1},{color:"#8183f9",current:!1},{color:"#d181f9",current:!1},{color:"#f9ab81",current:!1},{color:"#f9e181",current:!1}];return(c,u)=>(C(),ne(e(Ee),{show:e(s).isUserOpen,as:"template"},{default:D(()=>[_(e(Ue),{as:"div",onClose:e(i)},{default:D(()=>[a("div",pi,[a("div",fi,[_(e(ue),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[_(e(Pe),{class:"fixed inset-0"})]),_:1}),gi,_(e(ue),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:U(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all m-3 sm:align-middle sm:max-w-md sm:w-full sm:p-6",{"bg-opacity-80 dark:bg-lityblackblur backdrop-filter backdrop-blur":e(s).blurredInterface}])},[a("div",null,[a("div",hi,[(C(),E("div",mi,[a("div",bi,[yi,a("div",vi,[We(a("input",{"onUpdate:modelValue":u[0]||(u[0]=L=>e(s).localUserName=L),type:"text",name:"lity-server",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"Name"},null,512),[[je,e(s).localUserName]])])]),a("div",ki,[xi,a("div",wi,[We(a("input",{"onUpdate:modelValue":u[1]||(u[1]=L=>e(s).localUserColor=L),type:"text",name:"lity-server",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"Color"},null,512),[[je,e(s).localUserColor]]),a("div",_i,[a("button",Si,[a("i",{class:"ri-paint-brush-fill text-2xl",style:tt("color: "+e(s).localUserColor)},null,4)])])])]),a("div",$i,[a("nav",Ni,[(C(),E(me,null,Te(y,L=>a("span",{onClick:g=>e(s).localUserColor=L.color,key:L.color,style:tt("cursor: pointer; background: "+L.color),class:U([[L.current?" text-gray-700":"text-gray-500 hover:text-gray-700","transition transition-opacity hover:opacity-50 px-3 py-2 font-medium text-sm rounded-md"],"inline-flex items-center justify-center h-8 w-8 rounded-full"])},null,14,Ci)),64))])])]))])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),Oi={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 backdrop-filter backdrop-blur2 inset-0 z-50 overflow-y-auto"},Ai={class:"text-center"},Ii=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),Li={class:""},Ri={class:""},Ti={class:"mt-0"},Pi=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Share Gravity",-1),Ui=a("span",{class:"text-sm text-gray-500 dark:text-gray-400"}," (using WebRTC until restart)",-1),Ei={key:0,class:"mt-2"},Mi=a("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Share Link",-1),Hi={class:"mt-1 relative rounded-md shadow-sm"},Bi=["value"];const Fi=le({emits:["share","stop-sharing"],setup(t,{emit:o}){de(),ge();const{state:s,toggleShare:r}=ie();X(),X();const d=X(),i=window.location.href.match("(.*)#\\/(.+)\\/");return i&&i.length>1&&(d.value="https://dev.lity.cc/#/"+i[2]),(y,c)=>(C(),ne(e(Ee),{show:e(s).isShareOpen,as:"template"},{default:D(()=>[_(e(Ue),{as:"div",onClose:e(r)},{default:D(()=>[a("div",Oi,[a("div",Ai,[_(e(ue),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[_(e(Pe),{class:"fixed inset-0"})]),_:1}),Ii,_(e(ue),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:U(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all m-3 sm:align-middle sm:max-w-md sm:w-full sm:p-6",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":e(s).blurredInterface}])},[a("div",null,[a("div",Li,[a("div",Ri,[a("div",Ti,[_(e(_e),{as:"div",class:"flex justify-between"},{default:D(()=>[_(e(Se),{as:"span",class:""},{default:D(()=>[Pi,Ui]),_:1}),_(e($e),{modelValue:e(s).useWebRtc,"onUpdate:modelValue":c[0]||(c[0]=u=>e(s).useWebRtc=u),class:U([e(s).useWebRtc?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:U([e(s).useWebRtc?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),e(s).useWebRtc?(C(),E("div",Ei,[Mi,a("div",Hi,[a("input",{type:"text",name:"webrtc-password",readonly:"",value:d.value,class:"h-8on bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg select-all",placeholder:"Room Password"},null,8,Bi)])])):K("",!0),(e(s).useWebRtc,K("",!0))])])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),zi={class:"w-screen h-screen"},at={setup(t){const{redirect:o,isRedirected:s,spaceId:r,spaceUrl:d,spaceToken:i}=st();return o(),(y,c)=>(C(),E("div",zi,[_(Tr),_(ui),_(Di),_(Fi),e(s)?(C(),ne(ir,{"space-id":e(r),key:e(r),"space-token":e(i),"space-url":e(d)},null,8,["space-id","space-token","space-url"])):K("",!0)]))}},Wi=[{path:"/",component:at},{path:"/:space",component:at},{path:"/:space/:document",component:at},{path:"/:space/:document/:node",component:at}],ji=Bo({history:Fo(),linkActiveClass:"text-gray-900 font-bold",routes:Wi});var rt;(function(t){t.INCREMENT="INCREMENT",t.RESTORE="RESTORE"})(rt||(rt={}));const Vi={[rt.INCREMENT](t,o=1){t.count+=o},[rt.RESTORE](t,o){o.localUserName&&(t.localUserName=o.localUserName),o.localUserColor&&(t.localUserColor=o.localUserColor),o.serverAddress&&(t.serverAddress=o.serverAddress),o.serverToken&&(t.serverToken=o.serverToken),o.v1&&(t.v1=o.v1)}};var Me;(function(t){t.initApp="initApp",t.openInfo="openInfo",t.openSelector="openSelector",t.openSettings="openSettings",t.openSearch="openSearch"})(Me||(Me={}));const Gi={[Me.initApp]({state:t,commit:o,dispatch:s}){},[Me.openSelector]({state:t,commit:o,dispatch:s}){t.isSelectorOpen=!t.isSelectorOpen},[Me.openInfo]({state:t,commit:o,dispatch:s}){t.isInfoOpen=!t.isInfoOpen},[Me.openSettings]({state:t,commit:o,dispatch:s}){t.isSettingsOpen=!t.isSettingsOpen},[Me.openSearch]({state:t,commit:o,dispatch:s}){t.isSearchOpen=!t.isSearchOpen}},Ki={isReady(t){return!t.isInitialized}},Ji="1.2.0",qi={debug:!1,version:Ji,isInitialized:!1,isOffline:!1,count:0,localUserName:"",localUserColor:"",localUserId:"",serverAddress:"",serverToken:"",isSettingsOpen:!1,isInfoOpen:!1,isSelectorOpen:!1,isSearchOpen:!1,useRTC:!1,useHocuspocus:!0},Zi=zo({state:qi,getters:Ki,mutations:Vi,actions:Gi});const Xi=60*60*1e3;Kt({onRegistered(t){t&&setInterval(()=>{t.update()},Xi)}});const Yi=Wo(),it=jo(Yo);it.use(Zi);it.use(ji);it.use(Yi);it.mount("#app");
