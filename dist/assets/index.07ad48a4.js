var no=Object.defineProperty,ao=Object.defineProperties;var ro=Object.getOwnPropertyDescriptors;var Ct=Object.getOwnPropertySymbols;var lo=Object.prototype.hasOwnProperty,io=Object.prototype.propertyIsEnumerable;var Dt=(e,o,a)=>o in e?no(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,Ne=(e,o)=>{for(var a in o||(o={}))lo.call(o,a)&&Dt(e,a,o[a]);if(Ct)for(var a of Ct(o))io.call(o,a)&&Dt(e,a,o[a]);return e},Ot=(e,o)=>ao(e,ro(o));import{r as ee,v as co,d as pe,u as t,o as $,c as j,a as s,b as q,e as Ge,f as _,F as ke,g as It,h as ve,i as me,j as ae,k as We,D as qe,I as At,A as Lt,H as Rt,W as Tt,l as Ce,m as uo,n as z,p as Te,q as le,s as po,P as pt,N as Pt,t as Et,S as Ut,w as fo,x as ie,y as Mt,z as go,C as ho,B as mo,E as bo,L as yo,G as vo,T as xo,J as ko,U as wo,K as _o,M as So,O as $o,Q as No,V as Co,R as Do,X as Oo,Y as Ht,Z as Io,_ as we,$ as Ao,a0 as Ze,a1 as Lo,a2 as O,a3 as Xe,a4 as fe,a5 as Pe,a6 as ge,a7 as De,a8 as Ee,a9 as Ue,aa as Oe,ab as be,ac as Ye,ad as Ie,ae as Ae,af as Ro,ag as To,ah as Bt,ai as Ve,aj as jt,ak as Ft,al as Po,am as Le,an as Eo,ao as ft,ap as Uo,aq as Mo,ar as Me,as as He,at as Be,au as Ho,av as Bo,aw as jo,ax as Fo,ay as zo}from"./vendor.855e8817.js";const Wo=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))r(u);new MutationObserver(u=>{for(const l of u)if(l.type==="childList")for(const p of l.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function a(u){const l={};return u.integrity&&(l.integrity=u.integrity),u.referrerpolicy&&(l.referrerPolicy=u.referrerpolicy),u.crossorigin==="use-credentials"?l.credentials="include":u.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(u){if(u.ep)return;u.ep=!0;const l=a(u);fetch(u.href,l)}};Wo();function Vo(e={}){const{immediate:o=!1,onNeedRefresh:a,onOfflineReady:r,onRegistered:u,onRegisterError:l}=e;let p;const h=async(c=!0)=>{};return"serviceWorker"in navigator&&(p=new co("/sw.js",{scope:"/"}),p.addEventListener("activated",c=>{c.isUpdate?window.location.reload():r==null||r()}),p.register({immediate:o}).then(c=>{u==null||u(c)}).catch(c=>{l==null||l(c)})),h}function zt(e={}){const{immediate:o=!0,onNeedRefresh:a,onOfflineReady:r,onRegistered:u,onRegisterError:l}=e,p=ee(!1),h=ee(!1);return{updateServiceWorker:Vo({immediate:o,onNeedRefresh(){p.value=!0,a==null||a()},onOfflineReady(){h.value=!0,r==null||r()},onRegistered:u,onRegisterError:l}),offlineReady:h,needRefresh:p}}const Go={key:0,class:"pwa-toast",role:"alert"},Ko={class:"message"},Jo={key:0},qo={key:1},Zo=pe({setup(e){const{offlineReady:o,needRefresh:a,updateServiceWorker:r}=zt(),u=async()=>{o.value=!1,a.value=!1};return(l,p)=>t(o)||t(a)?($(),j("div",Go,[s("div",Ko,[t(o)?($(),j("span",Jo," App ready to work offline ")):($(),j("span",qo," New content available, click on reload button to update. "))]),t(a)?($(),j("button",{key:0,onClick:p[0]||(p[0]=h=>t(r)())},"Reload")):q("",!0),s("button",{onClick:u},"Close")])):q("",!0)}});const Xo=pe({setup(e){return(o,a)=>{const r=Ge("router-view");return $(),j(ke,null,[_(Zo),_(r)],64)}}}),Wt=()=>navigator.userAgent.indexOf("Mac OS X")!==-1,Yo=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),Qo=()=>{let e=!1;const o=document.createElement("div");if(CSS.supports("padding-bottom: env(safe-area-inset-bottom)")?(o.style.paddingBottom="env(safe-area-inset-bottom)",e=!0):CSS.supports("padding-bottom: constant(safe-area-inset-bottom)")&&(o.style.paddingBottom="constant(safe-area-inset-bottom)",e=!0),e){document.body.appendChild(o);const a=parseInt(window.getComputedStyle(o).paddingBottom);if(document.body.removeChild(o),a>0)return!0}return!1};function es(e){return Wt()?e.metaKey:e.ctrlKey}const ts=()=>"xxx-xxx-xxx".replace(/[xy]/g,function(e){const o=Math.random()*16|0;return(e=="x"?o:o&3|8).toString(16)}),gt=e=>e[Math.floor(Math.random()*e.length)],os=()=>gt(["Isaac Newton","Friedrich Nietzsche","Johann Wolfgang von Goethe","Carl Jung","Steve Jobs","Ernesto Guevara","Robert M. Pirsig","Nikola Tesla","Leonardo da Vinci","Archimedes","Johannes Gutenberg","Galileo Galilei","Albert Einstein","Carl Benz","Steve Wozniak","Alfred Nobel","Hedy Lamarr","Ada Lovelace","Stephanie Kwolek","Grace Hopper","Konrad Zuse"]),ss=()=>gt(ns()),ns=()=>["#00a492","#00b1ff","#ffc711","#F98181","#b7f981","#81eff9","#8183f9","#d181f9","#f9ab81","#f9e181"],as=e=>{let o="";if(Array.isArray(e))for(let a=0;a<e.length;a++)o+=e[a].text;else o=e;return o},rs=e=>new Promise(o=>setTimeout(o,e)),ls=e=>{e=e.replace(/^\s+|\s+$/g,""),e=e.toLowerCase();const o="\xE0\xE1\xE4\xE2\xE8\xE9\xEB\xEA\xEC\xED\xEF\xEE\xF2\xF3\xF6\xF4\xF9\xFA\xFC\xFB\xF1\xE7\xB7/_,:;",a="aaaaeeeeiiiioooouuuunc------";for(let r=0,u=o.length;r<u;r++)e=e.replace(new RegExp(o.charAt(r),"g"),a.charAt(r));return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),e},is=e=>Array.from(e.entries()).map(([o,a])=>Ne({clientId:o},a.user));function cs(e,o,a){let r={};const u=e.getMap().get(o);u&&(r=u),r.title=a.title,r.count=3,r.updatedAt=new Date().toISOString(),r.guid||(r.guid=o),r.filled=!0,r.createdAt||(r.createdAt=new Date().toISOString()),e.getMap().set(o,r)}const de=()=>({isMac:Wt,isMobile:Yo,hasNotch:Qo,osKey:es,uuid:ts,delay:rs,getPlainText:as,getRandomElement:gt,getRandomUser:os,getRandomColor:ss,stringToSlug:ls,updateDoc:cs,awarenessStatesToArray:is}),{uuid:ds,getRandomUser:us,getRandomColor:ps}=de(),ht="1.2.5",fs="",gs="",hs="",Vt=!1,Gt=[],ms=e=>{M.value.debug&&console.log(e),M.value.debug&&Gt.push(e)},Kt={debug:Vt,version:ht,useHocuspocus:!0,serverAddress:gs,serverToken:fs,useWebRtc:!1,signalingServerAddress:hs,localUserName:us(),localUserId:ds(),localUserColor:ps(),localWebRtcPassword:"",localLatestSpace:null,localLatestDocument:null,localLatestNode:null,isSettingsOpen:!1,isInfoOpen:!1,isSelectorOpen:!1,isSearchOpen:!1,isUserOpen:!1,isShareOpen:!1,isProviderOpen:!1,blurredInterface:!1,useLatestDocument:!0,showOtherColors:!0,showOtherUsers:!0,showOtherCursors:!0,useStrongGravity:!0,fixNodesOnDrag:!0,unfixLastNode:!0,zoomInOnNodeClick:!0,followNewlyCreatedNode:!0,followNewlyCreatedNodeMention:!0},M=It("local-lity-states",Kt),bs=()=>{M.value=Kt},Jt=()=>{M.value.isSelectorOpen=!1,M.value.isSearchOpen=!1,M.value.isSettingsOpen=!1,M.value.isInfoOpen=!1,M.value.isProviderOpen=!1,M.value.isUserOpen=!1,M.value.isShareOpen=!1,M.value.useWebRtc=!1,M.value.version<ht&&(M.value.version=ht,M.value.isInfoOpen=!0),M.value.blurredInterface&&(M.value.blurredInterface=!1,setTimeout(()=>{M.value.blurredInterface=!0},1e3))},ys=()=>{},vs=e=>{M.value.isSelectorOpen=e==="selector"?!M.value.isSelectorOpen:!1,M.value.isSearchOpen=e==="search"?!M.value.isSearchOpen:!1,M.value.isSettingsOpen=e==="settings"?!M.value.isSettingsOpen:!1,M.value.isInfoOpen=e==="info"?!M.value.isInfoOpen:!1,M.value.isProviderOpen=e==="provider"?!M.value.isProviderOpen:!1,M.value.isUserOpen=e==="user"?!M.value.isUserOpen:!1,M.value.isShareOpen=e==="share"?!M.value.isShareOpen:!1},xs=e=>{M.value.isSelectorOpen=!M.value.isSelectorOpen},ks=e=>{M.value.isSearchOpen=!M.value.isSearchOpen},ws=e=>{M.value.isSettingsOpen=!M.value.isSettingsOpen},_s=e=>{M.value.isInfoOpen=!M.value.isInfoOpen},Ss=e=>{M.value.isProviderOpen=!M.value.isProviderOpen},$s=e=>{M.value.isUserOpen=!M.value.isUserOpen},Ns=e=>{M.value.isShareOpen=!M.value.isShareOpen};Jt();const ue=()=>({state:M,debug:Vt,debugLog:Gt,toggleOnly:vs,logger:ms,checkForOpenWindows:ys,toggleSelector:xs,toggleSearch:ks,toggleSettings:ws,toggleProvider:Ss,toggleInfo:_s,toggleUser:$s,toggleShare:Ns,setDefaults:bs,setAppDefaults:Jt}),{uuid:mt,stringToSlug:Cs}=de(),_e=It("local-lity-spaces",{spaces:[]}),Qe=()=>{const e=ve(),o=me(),a=ee(!1),r=ae(()=>o.params.space),u=ae(()=>o.params.space&&c(o.params.space)?c(o.params.space).url:""),l=ae(()=>o.params.space&&c(o.params.space)?c(o.params.space).token:""),p=()=>{f(),a.value=!0},h=(G,T,R,H)=>{const P=T?Cs(T):mt(),L={id:G||P,name:T||"LocalStorage",url:R||null,token:H||null,index:o.params.document||mt()};_e.value.spaces.push(L)},c=G=>{for(let T=0;T<_e.value.spaces.length;T++)if(_e.value.spaces[T].id===G)return _e.value.spaces[T];return null},C=()=>_e.value.spaces[0],f=()=>{_e.value.spaces.length===0?d():(o.params.space&&(c(o.params.space)||h(o.params.space,"Shared Space",null,null)),o.params.space||S(C()),o.params.space&&!o.params.document&&S(c(o.params.space)))},d=()=>{_e.value.spaces=[],h(),h("causa-lity-cc","Lity.CC (readme only)","wss://causa.lity.cc","READ-ME-ONLY"),h("y","LocalStorage (previous versions)"),o.params.space?c(o.params.space)||h(o.params.space,"Shared Space",null,null):S(C())},y=(G,T)=>{if(G&&T)for(let R=0;R<_e.value.spaces.length;R++)_e.value.spaces[R].id===G&&(_e.value.spaces[R].index=T)},S=G=>{e.push(`/${G.id}/${G.index}/index`)};return{localSpaces:_e,resetSpaces:d,redirect:p,isRedirected:a,spaceId:r,spaceUrl:u,spaceToken:l,setIndex:y,getSpace:c,createSpace:h,setGravity:G=>{const T=G||mt();e.push(`/${o.params.space}/${T}/index`)},createDefaultSpace:f}};Qe();const Ds=e=>{const o=We({hasLoadedRootDoc:!1}),a=new qe({guid:e,autoLoad:!0}),r=a.getMap(),u=a.getMap("settings"),l=a.getText("latest"),p=new At(e,a),h=ee();return p.once("synced",()=>{o.hasLoadedRootDoc=!0,h.value=Object.entries(r.toJSON());for(let c=0;c<h.value.length;c++)h.value[c][1].filled||r.delete(h.value[c][1].guid);r.observe(()=>{h.value=Object.entries(r.toJSON())})}),{rootState:o,yRootDoc:a,yRootDocs:r,yRootSettings:u,yRootLatestDoc:l,yRootIndexedDb:p,jRootDocs:h}},{awarenessStatesToArray:Os}=de(),Is=e=>{const{state:o,logger:a}=ue(),r=We({hocuspocus:{init:!1,connected:!1,authenticated:!1,readOnly:!1,awareness:[]},rtc:{init:!1,connected:!1,readOnly:!1,awareness:[]}});let u,l;const p=new Lt(e),h=(d,y)=>{d&&(u=new Rt({url:d,name:e.guid,document:e,token:y,awareness:p,onAwarenessUpdate:({states:S})=>{r.hocuspocus.awareness=S},onConnect:()=>{r.hocuspocus.connected=!0},onAuthenticated:()=>{},onAuthenticationFailed:()=>{},onMessage:({event:S,message:K})=>{},onClose:({event:S})=>{r.hocuspocus.connected=!1},onDisconnect:({event:S})=>{r.hocuspocus.connected=!1}}),r.hocuspocus.init=!0,u.setAwarenessField("user",{name:o.value.localUserName,color:o.value.localUserColor}))},c=()=>{l=new Tt(e.guid,e,{awareness:p,password:o.value.localWebRtcPassword}),r.rtc.init=!0,r.rtc.connected=!0,l.awareness.setLocalStateField("user",{name:o.value.localUserName,color:o.value.localUserColor}),l.awareness.on("update",()=>{r.rtc.awareness=Os(l.awareness.states)})},C=()=>u.destroy();r.hocuspocus.connected=!1;const f=()=>l.destroy();return r.rtc.connected=!1,Ce(()=>{u&&C(),l&&f()}),{rootStates:r,rootHocuspocusProvider:u,rootWebRtcProvider:l,rootAwareness:p,provideRootHocuspocus:h,provideRootWebRtc:c,destroyRootHocuspocus:C,destroyRootWebRtc:f}};var bt=(e,o)=>{for(const[a,r]of o)e[a]=r;return e};const As={props:{icon:{type:String,required:!0},title:{type:String,required:!0},action:{type:Function,required:!0},isActive:{type:Function,default:null}},data(){return{remixiconUrl:uo}}},Ls=["title"],Rs={class:"remix"},Ts=["xlink:href"];function Ps(e,o,a,r,u,l){return $(),j("button",{class:z(["menu-item text-black dark:text-white hover:bg-opacity-50 hover:bg-gray-300 dark:hover:bg-gray-800",{"bg-gray-200 dark:bg-gray-900 text-blue-500 dark:text-blue-500":a.isActive?a.isActive():null}]),title:a.title,onClick:o[0]||(o[0]=(...p)=>a.action&&a.action(...p))},[($(),j("svg",Rs,[s("use",{"xlink:href":`${u.remixiconUrl}#ri-${a.icon}`},null,8,Ts)]))],10,Ls)}var Es=bt(As,[["render",Ps]]);const Us={components:{MenuItem:Es},props:{editor:{type:Object,required:!0},pane:{type:Object}},data(){return{items:[{icon:"bold",title:"Bold",action:()=>this.editor.chain().focus().toggleBold().run(),isActive:()=>this.editor.isActive("bold")},{icon:"italic",title:"Italic",action:()=>this.editor.chain().focus().toggleItalic().run(),isActive:()=>this.editor.isActive("italic")},{icon:"strikethrough",title:"Strike",action:()=>this.editor.chain().focus().toggleStrike().run(),isActive:()=>this.editor.isActive("strike")},{icon:"code-view",title:"Code",action:()=>this.editor.chain().focus().toggleCode().run(),isActive:()=>this.editor.isActive("code")},{icon:"mark-pen-line",title:"Highlight",action:()=>this.editor.chain().focus().toggleHighlight().run(),isActive:()=>this.editor.isActive("highlight")},{type:"divider"},{icon:"h-1",title:"Heading 1",action:()=>this.editor.chain().focus().toggleHeading({level:1}).run(),isActive:()=>this.editor.isActive("heading",{level:1})},{icon:"h-2",title:"Heading 2",action:()=>this.editor.chain().focus().toggleHeading({level:2}).run(),isActive:()=>this.editor.isActive("heading",{level:2})},{icon:"paragraph",title:"Paragraph",action:()=>this.editor.chain().focus().setParagraph().run(),isActive:()=>this.editor.isActive("paragraph")},{icon:"list-unordered",title:"Bullet List",action:()=>this.editor.chain().focus().toggleBulletList().run(),isActive:()=>this.editor.isActive("bulletList")},{icon:"list-ordered",title:"Ordered List",action:()=>this.editor.chain().focus().toggleOrderedList().run(),isActive:()=>this.editor.isActive("orderedList")},{icon:"list-check-2",title:"Task List",action:()=>this.editor.chain().focus().toggleTaskList().run(),isActive:()=>this.editor.isActive("taskList")},{icon:"code-box-line",title:"Code Block",action:()=>this.editor.chain().focus().toggleCodeBlock().run(),isActive:()=>this.editor.isActive("codeBlock")},{type:"divider"},{icon:"double-quotes-l",title:"Blockquote",action:()=>this.editor.chain().focus().toggleBlockquote().run(),isActive:()=>this.editor.isActive("blockquote")},{icon:"separator",title:"Horizontal Rule",action:()=>this.editor.chain().focus().setHorizontalRule().run()},{type:"divider"},{icon:"text-wrap",title:"Hard Break",action:()=>this.editor.chain().focus().setHardBreak().run()},{icon:"format-clear",title:"Clear Format",action:()=>this.editor.chain().focus().clearNodes().unsetAllMarks().run()},{type:"divider"},{icon:"arrow-go-back-line",title:"Undo",action:()=>this.editor.chain().focus().undo().run()},{icon:"arrow-go-forward-line",title:"Redo",action:()=>this.editor.chain().focus().redo().run()},{type:"divider"}]}}},Ms={class:"pl-3 pr-3"};function Hs(e,o,a,r,u,l){const p=Ge("menu-item");return $(),j("div",Ms,[($(!0),j(ke,null,Te(u.items,(h,c)=>($(),j(ke,null,[h.type==="divider"?($(),j("span",{key:`divider${c}`,class:"divider w-8"})):($(),le(p,po({key:1,key:c},h),null,16))],64))),256))])}var Bs=bt(Us,[["render",Hs]]);const js=new pt("mention"),Fs=Pt.create({name:"mention",addOptions(){return{HTMLAttributes:{},renderLabel({options:e,node:o}){return`${o.attrs.label}`},suggestion:{char:"@",pluginKey:js,command:({editor:e,range:o,props:a})=>{var l;const r=e.view.state.selection.$to.nodeAfter;((l=r==null?void 0:r.text)==null?void 0:l.startsWith(" "))&&(o.to+=1),e.chain().focus().insertContentAt(o,[{type:this.name,attrs:a},{type:"text",text:" "}]).run()},allow:({editor:e,range:o})=>{const a=e.state.doc.resolve(o.from),r=e.schema.nodes[this.name];return!!a.parent.type.contentMatch.matchType(r)}}}},group:"inline",inline:!0,draggable:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},space:{default:null,parseHTML:e=>e.getAttribute("data-space"),renderHTML:e=>e.space?{"data-space":e.space}:{}},spaceLabel:{default:null,parseHTML:e=>e.getAttribute("data-space-label"),renderHTML:e=>e.spaceLabel?{"data-space-label":e.spaceLabel}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}}},parseHTML(){return[{tag:"span[data-mention]"}]},renderHTML({node:e,HTMLAttributes:o}){return["span",Et({"data-mention":"",class:"bg-blue-200 dark:bg-blue-700 dark:text-blue-200"},this.options.HTMLAttributes,o),this.options.renderLabel({options:this.options,node:e})]},renderText({node:e}){return this.options.renderLabel({options:this.options,node:e})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:e,state:o})=>{let a=!1;const{selection:r}=o,{empty:u,anchor:l}=r;return u?(o.doc.nodesBetween(l-1,l,(p,h)=>{if(p.type.name===this.name)return a=!0,e.insertText(this.options.suggestion.char||"",h,h+p.nodeSize),!1}),a):!1}),"Mod-Shift-k":()=>this.editor.commands.command(({tr:e,state:o})=>{const{selection:a}=o,r=Math.floor(new Date().getTime()+Math.random());return this.editor.chain().focus().insertContentAt(a,[{type:this.name,attrs:{space:null,id:r,label:a.$from.doc.textBetween(a.from,a.to,"")}},{type:"text",text:" "}]).run()})}},addProseMirrorPlugins(){return[Ut(Ne({editor:this.editor},this.options.suggestion)),new fo({key:new pt("handleClick"),props:{handleClick:(e,o,a)=>{var u;const r=(u=a.target)==null?void 0:u.closest("span.mention");if(r){const l=window.location.href.match("(.*)#\\/(.+)\\/"),p=r.getAttribute("data-space");return console.log(p),p?window.location.href=l[1]+"#/"+p+"/"+r.getAttribute("data-id"):window.location.href=l[1]+"#/"+l[2]+"/"+r.getAttribute("data-id"),!0}return!1}}})]}});const zs={props:{items:{type:Array,required:!0},command:{type:Function,required:!0}},data(){return{selectedIndex:0}},watch:{items(){this.selectedIndex=0}},methods:{onKeyDown({event:e}){return e.key==="ArrowUp"?(this.upHandler(),!0):e.key==="ArrowDown"?(this.downHandler(),!0):e.key==="Enter"?(this.enterHandler(),!0):!1},upHandler(){this.selectedIndex=(this.selectedIndex+this.items.length-1)%this.items.length},downHandler(){this.selectedIndex=(this.selectedIndex+1)%this.items.length},enterHandler(){this.selectItem(this.selectedIndex)},selectItem(e){const o=this.items[e];o&&this.command({id:o.id,label:o.label,space:o.space,spaceLabel:o.spaceLabel})}}},Ws={class:"items text-sm bg-white dark:bg-black shadow-xl backdrop-filter backdrop-blur2 backdrop-blur-lg font-mono p-0.5"},Vs=["onClick"];function Gs(e,o,a,r,u,l){return $(),j("div",Ws,[($(!0),j(ke,null,Te(a.items,(p,h)=>($(),j("button",{key:h,class:z(["item text-gray-700 dark:text-gray-200 rounded-sm",{"dark:bg-blue-600 bg-blue-300 text-white ring-2 ring-blue-600 ":h===u.selectedIndex}]),onClick:c=>l.selectItem(h)},ie(p.label),11,Vs))),128))])}var Ks=bt(zs,[["render",Gs],["__scopeId","data-v-1b750266"]]);const{awarenessStatesToArray:Js}=de(),qt=()=>{const{state:e,logger:o}=ue(),a=We({init:!1,hocuspocus:{init:!1,connected:!1,authenticated:!1,readOnly:!1,awareness:[]},rtc:{init:!1,connected:!1,readOnly:!1,awareness:[]}});let r,u;const l=d=>(u=d,r=new Lt(u),r);let p,h;const c=(d,y)=>!d&&!y?null:(p=new Rt({url:d,name:u.guid,document:u,token:y,awareness:r,onAwarenessUpdate:({states:S})=>{a.hocuspocus.awareness=S},onConnect:()=>{a.hocuspocus.connected=!0},onAuthenticated:()=>{a.hocuspocus.authenticated=!0},onAuthenticationFailed:()=>{a.hocuspocus.authenticated=!1},onMessage:({event:S,message:K})=>{a.hocuspocus.init=!0},onClose:({event:S})=>{a.hocuspocus.init=!1},onDisconnect:({event:S})=>{a.hocuspocus.connected=!1,a.hocuspocus.authenticated=!1}}),a.hocuspocus.init=!0,p.setAwarenessField("user",{name:e.value.localUserName,color:e.value.localUserColor}),f(),p),C=()=>(h=new Tt(u.guid,u,{awareness:r,password:e.value.localWebRtcPassword}),a.rtc.init=!0,a.rtc.connected=!0,h.awareness.setLocalStateField("user",{test1:!0,name:e.value.localUserName,color:e.value.localUserColor}),h.awareness.on("update",()=>{a.rtc.awareness=Js(h.awareness.states)}),h),f=()=>{r.setLocalStateField("user",{latestDocument:"route.params.document",latestNode:"route.params.node",test:!0,name:e.value.localUserName,color:e.value.localUserColor})};return{subStates:a,subAwareness:r,subWebRtcProvider:h,subHocuspocusProvider:p,provideAwareness:l,provideSubHocuspocus:c,provideSubWebRtc:C}},qs=new pt("meta");Pt.create({name:"meta",addOptions(){return{HTMLAttributes:{},renderLabel({options:e,node:o}){return`${o.attrs.label}`},suggestion:{char:"#",pluginKey:qs,command:({editor:e,range:o,props:a})=>{var l;const r=e.view.state.selection.$to.nodeAfter;((l=r==null?void 0:r.text)==null?void 0:l.startsWith(" "))&&(o.to+=1),e.chain().focus().insertContentAt(o,[{type:this.name,attrs:a},{type:"text",text:" "}]).run()},allow:({editor:e,range:o})=>{const a=e.state.doc.resolve(o.from),r=e.schema.nodes[this.name];return!!a.parent.type.contentMatch.matchType(r)}}}},group:"inline",inline:!0,draggable:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}}},parseHTML(){return[{tag:"span[data-meta]"}]},renderHTML({node:e,HTMLAttributes:o}){return["span",Et({"data-meta":"",class:"bg-gray-200 dark:bg-gray-700 font-mono dark:text-gray-200"},this.options.HTMLAttributes,o),this.options.renderLabel({options:this.options,node:e})]},renderText({node:e}){return this.options.renderLabel({options:this.options,node:e})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:e,state:o})=>{let a=!1;const{selection:r}=o,{empty:u,anchor:l}=r;return u?(o.doc.nodesBetween(l-1,l,(p,h)=>{if(p.type.name===this.name)return a=!0,e.insertText(this.options.suggestion.char||"",h,h+p.nodeSize),!1}),a):!1})}},addProseMirrorPlugins(){return[Ut(Ne({editor:this.editor},this.options.suggestion))]}});const Zs=Mt.extend({content:"heading block*"}),Xs=(e,o,a,r,u,l)=>{const{state:p,logger:h}=ue();qt();const c=me();ve(),ee([]);const{isMobile:C,getPlainText:f,delay:d}=de(),y=o.getMap("nodes"),S=o.getMap("links"),K=l.getMap();let G=[];K.observe(()=>{G=T()});const T=()=>{const v=Object.values(K.toJSON()),D=[];for(let U=0;U<v.length;U++)if(v[U].nodes)for(let N=0;N<v[U].nodes.length;N++){const k=v[U].nodes[N];k.space=l.guid+"/"+v[U].guid,k.spaceLabel=f(v[U].title),D.push(k)}return D};G=T();const R=y.get(a);let H;const P=[Zs,go.configure({history:!1,document:!1,codeBlock:!1}),ho.configure({lowlight:mo}),bo.configure({placeholder:({node:v})=>v.type.name==="heading"?R&&R.href?"Type a title for "+R.href:"Type a title for "+a:"/"}),yo,vo,xo,ko,wo,_o,So,$o,No,Fs.configure({HTMLAttributes:{class:"mention"},ySubDoc:o,suggestion:{allowSpaces:!0,items:({query:v})=>{Object.values(y.toJSON());const D=[];G.forEach(k=>{let B=k.id!==k.title?f(k.title):k.title;k.id==="index"&&(B="Index"),k.space.split("/")[1]===c.params.document?D.push({id:k.id,label:B}):D.push({id:k.id,label:k.space?B+" ("+k.spaceLabel+")":B,space:k.space,spaceLabel:k.spaceLabel})}),v.length>0&&D.push({id:Math.floor(new Date().getTime()+Math.random()),label:v,space:null});let U=[];const N=v.toLowerCase().split(" ");return U=D.filter(k=>k.label.toLowerCase().includes(N[0])).sort((k,B)=>k.label>B.label?1:B.label>k.label?-1:0).slice(0,10),N.length>1&&(U=U.filter(k=>k.label.toLowerCase().includes(N[1]))),U},render:()=>{let v,D;return{onStart:U=>{v=new Co(Ks,{props:U,editor:U.editor}),D=Do("body",{getReferenceClientRect:U.clientRect,appendTo:()=>document.body,content:v.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate(U){v.updateProps(U),D[0].setProps({getReferenceClientRect:U.clientRect})},onKeyDown(U){var N;return U.event.key==="Escape"?(D[0].hide(),!0):(N=v.ref)==null?void 0:N.onKeyDown(U)},onExit(){D[0].destroy(),v.destroy()}}}}}),Oo.configure({document:o,field:a})];r&&p.value.showOtherCursors&&P.push(Ht.configure({provider:r,user:{name:p.value.localUserName,color:p.value.localUserColor}})),u&&!r&&p.value.showOtherCursors&&P.push(Ht.configure({provider:u,user:{name:p.value.localUserName,color:p.value.localUserColor}}));let L=!1;const Y=new Io({autofocus:!1,extensions:P,onCreate({editor:v}){I(v),E(),H=setTimeout(()=>{C()||v.commands.focus("end")},500)},onUpdate({editor:v}){e("onUpdate"),E();function D(U,N){let k={};const B=U.getMap().get(N);B&&(k=B),k.updatedAt=new Date().toISOString(),k.guid||(k.guid=N),k.filled=!0,k.createdAt||(k.createdAt=new Date().toISOString()),U.getMap().set(N,k)}L&&D(l,c.params.document),L||(L=!0),H&&(clearTimeout(H),H=setTimeout(()=>{I(v)},200))},onFocus({editor:v}){e("onFocus"),E()},onBlur({editor:v}){e("onBlur")}}),V=v=>{const D=[];let U;function N(k){if(Array.isArray(k)){for(let B=0;B<k.length;B++)if(Array.isArray(k[B].content))for(let Z=0;Z<k[B].content.length;Z++)if(Array.isArray(k[B].content)&&Array.isArray(k[B].content[Z].marks)){if(k[B].content[Z]){U={title:void 0,href:void 0},U.title=k[B].content[Z].text;for(let F=0;F<k[B].content[Z].marks.length;F++)k[B].content[Z].marks[F].attrs&&k[B].content[Z].marks[F].attrs.href&&(U.href=k[B].content[Z].marks[F].attrs.href.replace(/\/$/,""),D.push(U))}}else k[B].content[Z].content&&N(k[B].content[Z].content)}}return N(v),D},A=v=>{const D=[];let U;function N(k){if(Array.isArray(k)){for(let B=0;B<k.length;B++)if(Array.isArray(k[B].content)){for(let Z=0;Z<k[B].content.length;Z++)if(Array.isArray(k[B].content)){const X=k[B].content[Z];X.type==="mention"?(U={title:X.attrs.label,id:X.attrs.id},X.attrs.space||D.push(U)):X.content&&N(X.content)}}}}return N(v),D};function m(v){v=v.replace(/^\s+|\s+$/g,""),v=v.toLowerCase();const D="\xE0\xE1\xE4\xE2\xE8\xE9\xEB\xEA\xEC\xED\xEF\xEE\xF2\xF3\xF6\xF4\xF9\xFA\xFC\xFB\xF1\xE7\xB7/_,:;",U="aaaaeeeeiiiioooouuuunc------";for(let N=0,k=D.length;N<k;N++)v=v.replace(new RegExp(D.charAt(N),"g"),U.charAt(N));return v=v.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),v}function I(v){let D={id:a,title:a,group:1,created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[],links:[]};const U=y.get(a);U&&(D=U,D.created||(D.created=new Date().toISOString(),y.set(a,D)));const N=v.getJSON().content;if(N&&N[0]){const k=N[0].content?N[0].content:"";if(k&&f(k)!==f(D.title)&&(D.title=k,y.set(a,D),a==="index"?function(Z,X){let F={};const Q=Z.getMap().get(X);Q&&(F=Q),F.title=D.title,F.updatedAt=new Date().toISOString(),F.guid||(F.guid=X),F.filled=!0,F.createdAt||(F.createdAt=new Date().toISOString()),Z.getMap().set(X,F)}(l,c.params.document):function(Z,X){let F={};const Q=Z.getMap().get(X);Q&&(F=Q),F.updatedAt=new Date().toISOString(),F.guid||(F.guid=X),F.filled=!0,F.createdAt||(F.createdAt=new Date().toISOString()),Z.getMap().set(X,F)}(l,c.params.document)),k||N[0]&&!N[0].content&&D.id!==f(D.title)&&(y.set(a,D),D.href?v.commands.setContent(`<a href="${D.href}">${D.title}</a>`):v.commands.setContent(D.title)),N&&N.length>=1){const B=A(N),Z=V(N);for(let X=0;X<B.length;X++){const F=a.toString(),Q=B[X].id.toString(),he=S.get(F+"_"+Q),xe=y.get(Q);!he&&!xe?(y.set(Q,{id:Q,group:1,title:""+B[X].title+"",created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[F],links:[F]}),(async()=>{await d(100),S.set(F+"_"+Q,{target:Q,source:F,value:0})})()):!he&&xe&&(async()=>{await d(100),S.set(F+"_"+Q,{target:Q,source:F,value:0})})()}for(let X=0;X<Z.length;X++){const F=a,Q=Z[X].href,he=m(Q),xe=y.get(he);if((!xe||xe.href!==Q)&&(y.set(he,{id:he,group:1,title:Q,created:new Date().toISOString(),updated:new Date().toISOString(),href:Q,neighbors:[F],links:[F]}),S.set(he+"_"+F,{target:F,source:he,value:0})),xe){const se=a,J=m(Q);y.get(J+"_"+se)||S.set(J+"_"+se,{target:se,source:J,value:0})}}}}}function E(){const v=document.getElementsByClassName("ProseMirror")[0];v&&v.clientHeight<=35?e("bottom"):v&&v.clientHeight>=36&&v.clientHeight<=229&&e("middle"),v&&v.clientHeight>=230&&e("top")}return{yNodes:y,yLinks:S,currentNode:R,editor:Y,getAllLinks:V,getAllMentions:A,stringToSlug:m,managePane:I,changePane:E}};const Ys=s("i",{class:"ri-arrow-left-circle-fill text-2xl"},null,-1),Qs=[Ys],en=s("i",{class:"ri-arrow-right-circle-fill text-2xl"},null,-1),tn=[en],on=s("i",{class:"ri-close-circle-fill text-2xl"},null,-1),sn=[on],nn=pe({props:{yRootDoc:null,yRootDocs:null,jRootDocs:null,ySubDoc:null,ySubDocIndexedDb:null,ySubDocs:null,jSubDocs:null,spaceId:null,docId:null,nodeId:null,hocuspocusProvider:null,webRtcProvider:null,subStates:null,paneVisible:null,paneState:null},emits:["onFocus","onBlur","onUpdate","bottom","middle","top","hide","back","forward","switch"],setup(e,{emit:o}){const a=e,r=()=>{const p=document.getElementsByClassName("editor__content")[0];p.scrollTop<=-50&&o("bottom"),p.scrollTop>=50&&o("top")},{state:u}=ue(),{editor:l}=Xs(o,a.ySubDoc,a.nodeId,a.hocuspocusProvider,a.webRtcProvider,a.yRootDoc);return Ce(()=>{l.destroy()}),(p,h)=>($(),j(ke,null,[t(l)?($(),j("div",{key:0,style:{width:"100%","margin-top":"-1px"},class:z(["mt-0 m-0 rounded-t-lg fixed z-20 top-0 flex bg-white dark:bg-lityblack",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(u).blurredInterface}])},[s("button",{class:"relative pt-0 p-1 pl-0 ml-3 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",type:"button",onClick:h[0]||(h[0]=c=>o("back"))},Qs),s("button",{class:"relative pt-0 p-1 pl-0 ml-1 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",type:"button",onClick:h[1]||(h[1]=c=>o("forward"))},tn),_(Bs,{class:"editor__header my-2 w-auto mx-auto overflow-x-scroll whitespace-nowrap",editor:t(l)},null,8,["editor"]),s("button",{class:"relative pt-0 p-1 pr-0 mr-1 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",type:"button",onClick:h[2]||(h[2]=c=>o("switch"))},[s("i",{class:z(["text-2xl",{"ri-arrow-down-circle-fill":e.paneState==="top","ri-arrow-up-circle-fill":e.paneState!=="top"}])},null,2)]),s("button",{class:"relative pt-0 p-1 pr-0 mr-3 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",type:"button",onClick:h[3]||(h[3]=c=>o("hide"))},sn)],2)):q("",!0),t(l)?($(),le(t(Ao),{key:1,onScroll:r,onClick:h[4]||(h[4]=we(c=>t(l).isFocused?null:t(l).commands.focus("end"),["self"])),class:"editor__content dark:text-white fixed top-0 bottom-5 left-0 right-0 overflow-y-scroll p-3 pb-12 pt-12 select-auto",editor:t(l)},null,8,["editor"])):q("",!0)],64))}}),an={class:"relative z-0 flex flex-col flex-nowrap items-center rounded-t-md rounded-b-md",style:{width:"22.5em"}},rn={class:"inline-flex"},ln=s("input",{id:"input",class:"hidden",type:"text"},null,-1),cn=s("i",{class:"ri-asterisk text-2xl"},null,-1),dn=[cn],un=s("i",{class:"ri-search-line text-2xl"},null,-1),pn=[un],fn=s("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),gn=s("i",{class:"ri-refresh-line text-2xl"},null,-1),hn=[gn],mn=s("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),bn=s("i",{class:"ri-share-fill text-2xl"},null,-1),yn=[bn],vn=s("i",{class:"ri-add-circle-fill text-2xl"},null,-1),xn=[vn],kn=s("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),wn=s("i",{class:"ri-delete-bin-fill text-2xl"},null,-1),_n=[wn],Sn=s("i",{class:"ri-scissors-fill text-2xl"},null,-1),$n=[Sn],Nn=s("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),Cn=s("i",{class:"ri-arrow-go-back-fill text-2xl"},null,-1),Dn=[Cn],On=s("i",{class:"ri-arrow-go-forward-fill text-2xl"},null,-1),In=[On],An=s("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),Ln=s("i",{class:"ri-settings-5-fill text-2xl"},null,-1),Rn=[Ln],Tn=pe({props:{unlinkingNodes:null,linkingNodes:null,deletingNodes:null},emits:["linkNodes","unlinkNodes","createNode","deleteNode","refreshGraph","undo","redo"],setup(e,{emit:o}){const a=e,r=Ze();Lo(r);const{state:u,toggleInfo:l,toggleSettings:p,toggleSearch:h,toggleSelector:c}=ue();return(C,f)=>($(),j("div",{style:{"max-width":"22.5em"},class:z(["transition top-pane rounded-lg transition-all duration-500 ease-in-out bg-white dark:bg-lityblack absolute follower-bar ml-auto mr-auto left-0 right-0 z-10 overflow-y-scroll",{"dark:bg-lityblackblur bg-opacity-50 backdrop-filter backdrop-blur":t(u).blurredInterface,blur2:t(r)}])},[s("div",an,[s("span",rn,[ln,s("button",{class:"tooltip -ml-px pl-2 pr-0.5 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:f[0]||(f[0]=(...d)=>t(c)&&t(c)(...d))},dn),s("button",{type:"button",class:"tooltip p-1 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",onClick:f[1]||(f[1]=(...d)=>t(h)&&t(h)(...d))},pn),fn,s("button",{class:"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:f[2]||(f[2]=d=>o("refreshGraph"))},hn),mn,s("button",{class:z([{"text-black":!a.linkingNodes,"text-blue-500 dark:text-blue-500 animate-pulse":a.linkingNodes},"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none"]),type:"button",onClick:f[3]||(f[3]=d=>o("linkNodes"))},yn,2),s("button",{class:"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:f[4]||(f[4]=d=>o("createNode"))},xn),kn,s("button",{class:z([{"text-black":!a.deletingNodes,"text-red-500 dark:text-red-500 animate-pulse":a.deletingNodes},"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none"]),type:"button",onClick:f[5]||(f[5]=d=>o("deleteNode"))},_n,2),s("button",{class:z([{"text-black":!a.unlinkingNodes,"text-yellow-500 dark:text-yellow-500 animate-pulse":a.unlinkingNodes},"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none"]),type:"button",onClick:f[6]||(f[6]=d=>o("unlinkNodes"))},$n,2),Nn,s("button",{class:"tooltip -ml-px p-0.5 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:f[7]||(f[7]=d=>o("undo"))},Dn),s("button",{class:"tooltip -ml-px p-0.5 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:f[8]||(f[8]=d=>o("redo"))},In),An,s("button",{class:"tooltip -ml-px p-1 pr-2 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:f[9]||(f[9]=(...d)=>t(p)&&t(p)(...d))},Rn)])])],2))}}),Pn={key:0,class:"font-medium leading-none text-white text-shadow-lg"},En={key:0,class:""},Un={key:1,class:"mx-3"},Mn=pe({props:{route:null,state:null},emits:["setStates"],setup(e,{emit:o}){const a=ee(!1);return(r,u)=>{const l=Ge("router-link");return $(),le(l,{onMouseenter:u[0]||(u[0]=p=>a.value=!0),onMouseleave:u[1]||(u[1]=p=>a.value=!1),disabled:!e.state.user.latestDocument,to:`/${e.route.params.space}/${e.state.user.latestDocument}/${e.state.user.latestNode?e.state.user.latestNode:"index"}`,tabindex:"1",onClick:u[2]||(u[2]=p=>o("setStates")),class:z(["inline-flex transition transition-all ease-in-out duration-500 group items-center justify-center h-10 w-10 rounded-full mr-2",{"w-auto":a.value}]),style:Xe("background: "+e.state.user.color)},{default:O(()=>[e.state.user&&e.state.user.name?($(),j("span",Pn,[a.value?q("",!0):($(),j("span",En,ie(e.state.user.name.split(/\s/).reduce((p,h)=>p+=h.slice(0,1),"")),1)),a.value?($(),j("span",Un,ie(e.state.user.name),1)):q("",!0)])):q("",!0)]),_:1},8,["disabled","to","class","style"])}}}),Hn={class:"fixed inset-0 z-50 dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 overflow-y-auto"},Bn={class:"text-center"},jn=s("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),Fn={class:"m-3"};const zn={key:1,class:"relative mb-3 z-0 w-full inline-flex"},Wn=["onKeydown"],Vn={class:"absolute inset-y-0 right-0 flex py-0.5 pr-1.5"},Gn=s("i",{class:"ri-close-circle-fill text-2xl"},null,-1),Kn=[Gn],Jn={key:0,class:"relative mt-3 z-0 overflow-ellipsis w-full overflow-x-scroll"},qn={role:"list",style:{"max-height":"50vh"}},Zn={style:{"min-width":"300px"},class:"px-2 py-0"},Xn={class:"flex justify-between"},Yn={class:"flex"},Qn={class:"flex items-center font-bold text-sm w-64 overflow-ellipsis"},ea=s("div",{class:"mt-2 flex items-center mt-0"},null,-1),ta={class:"mt-1 flex items-center mb-1"},oa={class:"px-2 w-28 text-sm font-medium"},sa=s("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"Links ",-1),na={class:"px-2 w-48 text-sm font-medium"},aa=s("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"Created ",-1),ra={class:"w-48 text-sm font-medium"},la=s("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"Updated ",-1),ia=pe({props:{ySubDoc:null,jSubDocs:null,hocuspocusProvider:null,webRtcProvider:null,subStates:null},setup(e){const o=e;Mt.extend({content:"heading block*"});const a=me(),r=ve(),{hasNotch:u}=de(),{state:l,toggleSearch:p}=ue(),h=ee([]),c=ee(""),C=ae(()=>l.value.isSearchOpen),f=ae(()=>o.jSubDocs?o.jSubDocs.filter(P=>H(P[1].title).toLowerCase().includes(c.value.toLowerCase())).slice(0,10).sort((P,L)=>H(P.title)>H(L.title)?1:H(L.title)>H(P.title)?-1:0):[]),d=ee(0);fe(c,()=>{d.value=0}),fe(C,()=>{C.value?d.value=0:c.value=""});const y=()=>{d.value=(d.value+f.value.length-1)%f.value.length},S=()=>{d.value=(d.value+1)%f.value.length},K=()=>{c.value=H(f.value[d.value][1].title)},G=()=>{c.value.startsWith("{")?R(c.value):T(f.value[d.value],d.value)},T=(P,L)=>{d.value=L,p(),r.push("/"+a.params.space+"/"+a.params.document+"/"+P[0])},R=P=>{if(P){c.value="";const L=JSON.parse(P);if(L.nodes&&L.links&&L.documents){const Y=Object.entries(L.links),V=Object.entries(L.nodes),A=o.ySubDoc.getMap("nodes"),m=o.ySubDoc.getMap("links");for(let I=0;I<V.length;I++)V[I][1].created||(V[I][1].created=new Date),V[I][1].updated||(V[I][1].updated=new Date),A.set(V[I][0],V[I][1]);for(let I=0;I<Y.length;I++)m.set(Y[I][0],Y[I][1]);for(let I=0;I<L.documents.length;I++)o.ySubDoc.getXmlFragment()}}},H=P=>{let L="";if(Array.isArray(P))for(let Y=0;Y<P.length;Y++)L+=P[Y].text;else L=P;return L};return Pe(()=>{h.value=o.ySubDoc.getMap("nodes").toJSON()}),(P,L)=>{const Y=Ge("router-link");return $(),le(t(Ae),{show:t(l).isSearchOpen,as:"template"},{default:O(()=>[_(t(Ie),{as:"div",onClose:t(p)},{default:O(()=>[s("div",Hn,[s("div",Bn,[_(t(ge),{as:"template",enter:"duration-20 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-20 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[_(t(De),{class:"fixed inset-0"})]),_:1}),jn,_(t(ge),{as:"template",enter:"ease-out duration-20","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-20","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[s("div",{class:z(["inline-block align-bottom bg-white dark:bg-lityblack mt-16 pb-3 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:align-middle sm:max-w-4xl w-full",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(l).blurredInterface,"mt-32":t(u)()}])},[s("div",Fn,[(e.subStates.hocuspocus.awareness&&e.subStates.hocuspocus.awareness.length>1,q("",!0)),($(),j("span",zn,[s("form",{class:"w-full",onSubmit:L[2]||(L[2]=we(()=>{},["prevent"]))},[Ee(s("input",{id:"search",onKeydown:[Oe(we(y,["prevent"]),["up"]),Oe(we(S,["prevent"]),["down"]),Oe(we(K,["prevent"]),["right"]),Oe(we(G,["prevent"]),["enter"])],"onUpdate:modelValue":L[0]||(L[0]=V=>c.value=V),placeholder:"Search for Nodes",autocomplete:"off",autocapitalize:"off",spellcheck:"false",autofocus:"",type:"text",name:"search",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg pr-12"},null,40,Wn),[[Ue,c.value]]),s("div",Vn,[s("button",{type:"button",class:"-ml-px p-1 relative inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-200 hover:opacity-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-blue-600",onClick:L[1]||(L[1]=(...V)=>t(p)&&t(p)(...V))},Kn)])],32)])),q("",!0)]),($(),j("div",Jn,[s("ul",qn,[($(!0),j(ke,null,Te(t(f),(V,A)=>($(),j("li",{key:V},[V[1]&&V[1].title?($(),le(Y,{key:0,"active-class":"bg-gray-200 dark:bg-gray-800",class:z(["mb-1 mt-0.5 m-3 block rounded-md mb-0.5 bg-white text-black dark:text-white dark:bg-gray-900 bg-opacity-50 dark:bg-opacity-50 hover:bg-gray-100 dark:hover:bg-gray-800 overflow-x-scroll",{"bg-blue-100 hover:text-black ring-2 ring-blue-600 dark:hover:text-white hover:bg-blue-200 dark:bg-blue-700 dark:hover:bg-blue-800":A===d.value}]),onClick:m=>T(V,A),to:"/"+t(a).params.space+"/"+t(a).params.document+"/"+V[0]},{default:O(()=>[s("div",Zn,[s("div",Xn,[s("div",Yn,[s("p",Qn,ie(H(V[1].title)),1)]),ea,s("div",ta,[s("p",oa,[sa,be(" "+ie(V[1].links.length),1)]),s("p",na,[aa,_(t(Ye),{time:V[1].created},{default:O(({timeAgo:m})=>[be(ie(m),1)]),_:2},1032,["time"])]),s("p",ra,[la,_(t(Ye),{time:V[1].updated},{default:O(({timeAgo:m})=>[be(ie(m),1)]),_:2},1032,["time"])])])])])]),_:2},1032,["class","onClick","to"])):q("",!0)]))),128))])]))],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])}}}),et=Ze(),W=We({autoLink:!1,linkingNodes:!1,unlinkingNodes:!1,deletingNodes:!1,firstNode:void 0,secondNode:void 0,jsonDocuments:[]}),{osKey:ca}=de(),{state:Ke,logger:pi}=ue(),da=(e,o,a,r,u,l)=>{const p="graph";let h;const c=me(),C=ve(),f=ae(()=>c.params.node);ae(()=>c.params.space);const d=Ro(),y=e.getMap("nodes"),S=e.getMap("links");e.getMap("selected");const K=new To([y,S]),G=ae(()=>r.hocuspocus.awareness),T=ae(()=>r.rtc.awareness),R=ee(),H={background:"rgba(255,255,255,0)",fontSize:16,lineColor:"#a7bac4",lineWidth:1,particleWidth:1.5,highlightedForeground:Ke.value.localUserColor||"#009dff",node:{note:"#00192a",placeholder:"#414141"}},P=Bt().domain([0,30]).range([.5,2]).clamp(!0),L=Bt().domain([1.2,2]).range([0,1]).clamp(!0),Y={background:H.background,fontSize:parseInt(H.fontSize)-2,lineColor:H.lineColor,lineWidth:parseFloat(H.lineWidth),particleWidth:parseFloat(H.particleWidth),highlightedForeground:H.highlightedForeground,node:{note:H.node.note,placeholder:H.node.placeholder}},V={background:"rgba(0,0,0,0)",fontSize:16,lineColor:"#656565",lineWidth:1,particleWidth:1.5,highlightedForeground:Ke.value.localUserColor||"#009dff",node:{note:"#eaeaea",placeholder:"#a1a1a1"}},A={selectedNodes:new Set,hoverNode:null,focusNodes:new Set,focusLinks:new Set,hoverNodes:new Set,hoverLinks:new Set,nodeInfo:{},data:{nodes:[],links:[]},style:Y},m=n=>{n(A);const i=new Set,g=new Set,x=new Set,w=new Set;if(A.hoverNode){x.add(A.hoverNode);const b=A.nodeInfo[A.hoverNode];b!==void 0&&(b.neighbors.forEach(oe=>i.add(oe)),b.links.forEach(oe=>g.add(oe)))}A.selectedNodes&&A.selectedNodes.forEach(b=>{i.add(b);const oe=A.nodeInfo[b];oe!==void 0&&(oe.neighbors.forEach(re=>i.add(re)),oe.links.forEach(re=>g.add(re)))}),A.focusNodes=i,A.focusLinks=g,A.hoverNodes=x,A.hoverLinks=w},I={refresh:n=>m(i=>{i.nodeInfo=n.nodes;const g=n.links,x=new Set(Object.keys(i.nodeInfo)),w=new Set;i.data.nodes.forEach((b,oe)=>{x.has(b.id)?x.delete(b.id):w.add(oe)}),w.forEach(b=>{i.data.nodes.splice(b,1)}),x.forEach(b=>{y.get(b)&&i.data.nodes.push({id:b,y:y.get(b).y,x:y.get(b).x})}),i.data.links=g,i.hoverNode=i.nodeInfo[i.hoverNode]!=null?i.hoverNode:null,i.selectedNodes=new Set(Array.from(i.selectedNodes).filter(b=>i.nodeInfo[b]!=null)),d.graphData(i.data)}),selectNode:(n,i)=>m(g=>{if(i||g.selectedNodes.clear(),n!=null){g.selectedNodes.add(n);const x=d.graphData().nodes;for(const[w,b]of Object.entries(x))if(b.id===n){d.centerAt(b.x,b.y,300),d.zoom(7,300);break}}}),highlightNode:n=>m(i=>{i.hoverNode=n}),updateStyle:n=>{!n||(A.style=Ot(Ne(Ne({},Y),n),{lineColor:n.lineColor||n.node&&n.node.note||Y.lineColor,node:Ne(Ne({},Y.node),n.node)}),d.backgroundColor(A.style.background))}},E=(n,i=!0)=>(Object.values(n.nodes).forEach(g=>{g.neighbors=[],g.links=[]}),i||n.links.forEach(g=>{try{const x=n.nodes[g.source||g.source.id],w=n.nodes[g.target||g.target.id];x&&w&&(x.neighbors.push(w.id),w.neighbors.push(x.id),x.links.push(g),w.links.push(g))}catch(x){console.log(x)}}),n);function v(){const n=[],i=[];S.forEach((g,x,w)=>{i.push(g)});for(let g=0;g<i.length;g++)i[g].source&&i[g].source.id?y.get(i[g].source.id)&&y.get(i[g].target.id)&&n.push({source:i[g].source.id,target:i[g].target.id,value:0}):y.get(i[g].source)&&y.get(i[g].target)&&n.push({source:i[g].source,target:i[g].target,value:0});return n}const D=(n=!1)=>{const i=v(),g=y.toJSON();y.get("index")||(y.set("index",{id:"index",group:1,title:"",created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[],links:[]}),I.selectNode("index"));function x(oe,re){let te={};const ye=oe.getMap().get(re);ye&&(te=ye);const ne=Object.entries(g).length;te.count!==ne&&(te.count=ne),te.nodes=Object.values(g),te.links=Object.values(i),te.updatedAt=new Date().toISOString(),te.guid||(te.guid=re),te.filled=!0,te.createdAt||(te.createdAt=new Date().toISOString()),te.count.toString()!==ne.toString()&&oe.getMap().set(re,te)}x(l,c.params.document);const b=E({nodes:g,links:i},n);I.refresh(b),d.d3ReheatSimulation()},U=()=>{d.zoom(d.zoom()+1,300)},N=()=>{d.zoom(d.zoom()-1,300)},k=()=>{d.d3Force("center",Ve(0,0)),d.d3Force("x",jt(0).strength(.1)),d.d3Force("y",Ft(0).strength(.1)),Je()},B=()=>{d.d3Force("center",Ve(0,0)),d.d3Force("x",jt(0).strength(.01)),d.d3Force("y",Ft(0).strength(.01)),Je()},Z=n=>{const i=Object.values(y.toJSON()),g=[];for(let x=0;x<i.length;x++)n.toLowerCase()===getPlainText(i[x].title).toLowerCase()&&g.push(i[x].id);return[]},X=n=>{const i=Z(n);return i.length>=1?i[0]:!1},F=n=>!!y.get(n).getJSON(),Q=(n,i,g)=>(y.set(n,{id:n,group:1,title:""+i+"",neighbors:[],links:[]}),n),he=(n,i)=>(S.set(n+"_"+i,{source:n,target:i,value:0}),n+"_"+i),xe=(n,i)=>{const x=Math.floor(new Date().getTime()+Math.random()).toString();return Q(x,n,i)},se=(n,i,g)=>{const w=Math.floor(new Date().getTime()+Math.random()).toString(),b=Q(w,i,g);return he(n,w),b},J=(n,i)=>{W.linkingNodes&&(W.linkingNodes=!1),W.deletingNodes&&(W.deletingNodes=!1),W.unlinkingNodes&&(W.unlinkingNodes=!1);const g=Math.floor(new Date().getTime()+Math.random());let x;if(i){const te=f.value||null,ye=i.id?i.id.toString():te,ne=g.toString();x=ne,ye?(y.set(ne,{id:ne,group:1,created:new Date().toISOString(),updated:new Date().toISOString(),title:""+ne+"",neighbors:[ye],links:[ye]}),S.set(ye+"_"+ne,{source:ye,target:ne,value:0})):y.set(ne,{id:ne,group:1,title:""+ne+"",created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[],links:[]})}else x=g,y.set(g.toString(),{id:g.toString(),group:1,title:""+g.toString()+"",created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[],links:[]});const w=v(),b={nodes:y.toJSON(),links:w},oe=y.get(x),re=E(b,!1);I.refresh(re),I.selectNode(x),d.centerAt(oe.x,oe.y,300),C.push({path:`/${c.params.space}/${c.params.document}/${x}`})},ce=()=>{d(h).cooldownTicks(50).graphData(A.data).backgroundColor(A.style.background).linkHoverPrecision(8).d3Force("collide",Po(d.nodeRelSize())).linkWidth(()=>A.style.lineWidth||H.lineWidth).linkDirectionalParticles(1).linkDirectionalParticleWidth(n=>at(n,A)==="highlighted"?A.style.particleWidth||H.particleWidth:0).nodeCanvasObject((n,i,g)=>{const x=A.nodeInfo[n.id];if(x==null){console.error(`Could not find info for node ${n.id} - skipping`);return}const w=P(x.neighbors.length),{fill:b,border:oe}=vt(n.id,A),re=A.style.fontSize/g*1.1,te=nt(n.id,A),ye=b.copy({opacity:te==="regular"?L(g):te==="highlighted"?1:Math.min(L(g),b.opacity)}),ne=oe.copy({opacity:te==="regular"?L(g):te==="highlighted"?1:Math.min(L(g),b.opacity)}),Se=($e=>{let ze="";const so=[];if(Array.isArray($e))for(let ut=0;ut<$e.length;ut++)ze+=$e[ut].text;else ze=$e;return{text:ze,marks:so}})(x.title).text,to=JSON.stringify(x.title).toString(),$t=/(\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/gi,ct=Se.match($t);Se.replace($t,"");const oo=n.id.startsWith("http"),dt=to.includes("highlight");function Re($e,ze){return $e.length>ze?$e.substr(0,ze-1)+"...":$e}Le(ye).copy({opacity:.3});const Nt=te==="lessened";ct&&!dt?Fe(i).circle(n.x,n.y,w+.5,oe).circle(n.x,n.y,w,b).text(Re(Se,48),n.x,n.y+w+1,re,ne):dt&&!ct?Fe(i).circle(n.x,n.y,w+.5,oe).circle(n.x,n.y,w,b).highlighted(Re(Se,48),n.x,n.y+w+1,re,ne,Nt,L(g)).text(Re(Se,48),n.x,n.y+w+1,re,ne):dt&&ct?Fe(i).highlighted(Re(Se,48),n.x,n.y+w,re,ne,Nt,L(g)).text(Re(Se,48),n.x,n.y-w+1,re,ne):oo?Fe(i).circle(n.x,n.y,w,oe).text(Re(Se,48),n.x,n.y+w+1,re,ne):Fe(i).circle(n.x,n.y,w+.5,b).circle(n.x,n.y,w,oe).text(Re(Se,48),n.x,n.y+w+1,re,ne)}).linkColor(n=>xt(n,A)).nodePointerAreaPaint((n,i,g)=>{const x=6;g.beginPath(),g.arc(n.x,n.y,x,0,2*Math.PI,!1),g.fillStyle=i,g.fill(),g.closePath()}).onNodeHover(n=>{o("onNodeHover",n),I.highlightNode(n==null?void 0:n.id)}).onNodeClick((n,i)=>{if(o("onNodeClick",n),W.unlinkingNodes){rt(n.id);return}if(W.deletingNodes){lt(n.id);return}if(ca(i)){const g=y.get(n.id);g.href&&open(g.href)}else n.fx=n.x,n.fy=n.y,W.linkingNodes&&(W.firstNode&&W.firstNode.length>3?wt(W.firstNode,n.id):W.firstNode=n.id),d.centerAt(n.x,n.y,300),I.selectNode(n.id,!1),C.push({path:`/${c.params.space}/${c.params.document}/${n.id}`})}).onZoom((n,i)=>{o("onZoom")}).onZoomEnd((n,i)=>{o("onZoomEnd")}).onLinkHover((n,i)=>{o("onLinkHover")}).onLinkClick((n,i)=>{o("onLinkClick"),W.unlinkingNodes&&Qt(n.source.id+"_"+n.target.id)}).onLinkRightClick((n,i)=>{o("onLinkRightClick")}).onEngineTick((n,i)=>{o("onEngineTick")}).onEngineStop((n,i)=>{o("onEngineStop")}).onBackgroundClick(()=>{o("onBackgroundClick"),I.selectNode(void 0,!1),C.push({path:`/${c.params.space}/${c.params.document}`})}).onBackgroundRightClick(n=>{o("onBackgroundRightClick",n),d.screen2GraphCoords(n.x,n.y),J()}).onNodeRightClick(n=>{o("onNodeRightClick",n),J(!1,n)}).onNodeDrag(n=>{o("onNodeDrag",n)}).onNodeDragEnd(n=>{o("onNodeDragEnd",n),n.fx&&n.fy?(n.fx=void 0,n.fy=void 0):(n.fx=n.x,n.fy=n.y)})},yt=n=>{const i=[],g=r.hocuspocus.awareness.length>1?Object.values(r.hocuspocus.awareness):r.rtc.awareness.length>1?Object.values(r.rtc.awareness):[];if(g)for(let x=0;x<g.length;x++){const w=g[x].user;w&&w.latestDocument&&w.latestNode&&w.latestNode===n&&i.push(w)}return i};function vt(n,i){var re,te,ye,ne;const g=i.nodeInfo[n],x=i.style,w=Le((te=x.node[(re=g.type)!=null?re:"note"])!=null?te:x.node.note);let b=Le((ne=x.node[(ye=g.type)!=null?ye:"note"])!=null?ne:x.node.note);const oe=Ke.value.showOtherColors?yt(n):[];switch(oe.length>=1&&(b=Le(oe[0].color)),n===f.value&&(b=Le(Ke.value.localUserColor)),nt(n,i)){case"regular":return{fill:w,text:w,border:b};case"lessened":const St=Le(w).copy({opacity:.3}),it=Le(b).copy({opacity:.3});return{fill:St,text:it,border:it};case"focused":return{fill:Le(x.highlightedForeground),text:w,border:b};case"highlighted":return{fill:w,text:w,border:b};default:throw new Error("Unknown type for node",n)}}function xt(n,i){const g=i.style;switch(at(n,i)){case"regular":return g.lineColor;case"highlighted":return g.highlightedForeground;case"focused":return g.highlightedForeground;case"lessened":return Eo(g.lineColor).copy({opacity:.5});default:throw new Error("Unknown type for link",n)}}function nt(n,i){return i.selectedNodes.has(n)?"highlighted":i.hoverNode===n?"focused":i.focusNodes.size===0||i.focusNodes.has(n)?"regular":"lessened"}function at(n,i){return i.focusNodes.size===0?"regular":i.focusLinks.has(n)?"highlighted":"lessened"}const Fe=n=>({circle:function(i,g,x,w){return n.beginPath(),n.arc(i,g,x,0,2*Math.PI,!1),n.fillStyle=w,n.fill(),n.closePath(),this},ring:function(i,g,x,w){return n.beginPath(),n.arc(i,g,x*2,0,2*Math.PI,!1),n.fillStyle=w,n.fill(),n.closePath(),this},text:function(i,g,x,w,b){return n.font=`${w}px Sans-Serif`,n.textAlign="center",n.textBaseline="top",n.fillStyle=b,n.fillText(i,g,x),this},emoji:function(i,g,x,w,b){return n.font=`${w}px Sans-Serif`,n.textAlign="center",n.globalAlpha=.7,n.fillStyle=b,n.fillText(i,g,x),this},highlighted:function(i,g,x,w,b,oe,re){n.font=`${w}px Sans-Serif`,n.fillStyle="rgba(255,251,0,"+(re-.2)+")",oe&&(n.fillStyle="rgba(255,251,0,"+(re-.2)+")");const te=n.measureText(i).width;return n.fillRect(g-te/2,x,te,parseInt(n.font,0)*1.1),this}}),kt=()=>{C.push(`/${c.params.space}/${c.params.document}/`)},Zt=()=>{W.deletingNodes&&(W.deletingNodes=!1),W.unlinkingNodes&&(W.unlinkingNodes=!1),f.value&&f.value.length>3&&(W.firstNode=f.value),W.linkingNodes=!W.linkingNodes,W.linkingNodes||(W.firstNode=null)},Xt=()=>{W.deletingNodes&&(W.deletingNodes=!1),W.linkingNodes&&(W.linkingNodes=!1),f.value&&f.value.length>3?rt(f.value):W.unlinkingNodes=!W.unlinkingNodes},Yt=()=>{W.linkingNodes&&(W.linkingNodes=!1),W.unlinkingNodes&&(W.unlinkingNodes=!1),f.value&&f.value.length>3?lt(f.value):W.deletingNodes=!W.deletingNodes},wt=(n,i)=>{n&&i&&(W.firstNode=void 0,W.secondNode=void 0,S.set(n+"_"+i,{source:n,target:i,value:0})),W.linkingNodes=!1},rt=n=>{n&&(y.forEach((i,g)=>{const x=i.neighbors,w=i.links;for(let b=0;b<x.length;b++)x[b]===n&&x.splice(b,1);for(let b=0;b<w.length;b++)(w[b].source==n||w[b].source.id==n||w[b].target==n||w[b].target.id==n)&&w.splice(b,1)}),S.forEach((i,g)=>{(i.target==n||i.source==n)&&(S.delete(g,1),D(!0))}),D(!1))},Qt=n=>{console.log(n),n&&S.delete(n.toString())},lt=n=>{n&&n!="index"?(y.delete(n.toString()),y.forEach((i,g)=>{const x=i.neighbors,w=i.links;for(let b=0;b<x.length;b++)x[b]===n&&x.splice(b,1);for(let b=0;b<w.length;b++)(w[b].source==n||w[b].source.id==n||w[b].target==n||w[b].target.id==n)&&w.splice(b,1)}),D(!1),kt()):n&&n==="index"&&o("deleteIndex")},_t=()=>{d.graphData().nodes.forEach((n,i,g)=>{n.fx&&n.fy&&(n.fx=void 0,n.fy=void 0)}),D(!1)};function eo(){if(d.d3Force("center",Ve(0,0)),d.zoomToFit(300,20),f.value){const n=d.graphData().nodes;for(const[i,g]of Object.entries(n))if(g.id===f.value){d.d3Force("center",Ve(0,0)),d.centerAt(g.x,g.y,300);break}I.selectNode(f.value,!1)}}const Je=()=>{d&&d._destructor(),ce(),_t(),D(),R.value=Object.entries(y.toJSON()),d.width(window.innerWidth),d.height(window.innerHeight);const n=ee(!0);d.onEngineStop(()=>{const i=d.graphData().nodes;if(n.value)if(i.length>1){if(d.d3Force("center",Ve(0,0)),d.zoomToFit(50,20),n.value=!1,f.value){for(const[g,x]of Object.entries(i))if(x.id===f.value){d.d3Force("center",Ve(0,0)),d.centerAt(x.x,x.y,50);break}I.selectNode(f.value,!1)}}else d.zoomToFit(50,0);d.cooldownTicks(20)}),window.addEventListener("resize",()=>{d.width(window.innerWidth),d.height(window.innerHeight)}),window.addEventListener("orientationchange",function(){d.width(window.innerWidth),d.height(window.innerHeight)})};return Pe(()=>{if(h=document.getElementById(p),h!==void 0){y.observe(()=>{D(),R.value=Object.entries(y.toJSON())}),S.observe(()=>{D()}),fe(f,(i,g)=>{W.autoLink&&S.set(i+"_"+g,{source:i,target:g,value:0})}),fe(G,()=>{}),fe(T,()=>{}),fe(et,()=>{et.value&&I.updateStyle(V),et.value||I.updateStyle(Y)});const n=ae(()=>Ke.value.useStrongGravity);fe(n,()=>{n.value?k():B()}),et.value?I.updateStyle(V):I.updateStyle(Y),n.value?k():B(),Je()}}),Ce(()=>{d._destructor()}),fe(f,()=>{f.value?(I.selectNode(f.value,!1),o("show")):(I.selectNode(void 0,!1),o("hide"))}),{galaxyState:W,Actions:I,graph:d,update:m,augmentGraphInfo:E,updateLinks:v,updateAll:D,zoomIn:U,zoomOut:N,gravityOn:k,gravityOff:B,nodesWithTitle:Z,hasNodesWithTitle:X,doesNodeExist:F,createNodeOrUpdate:Q,directLinkNodes:he,createRootNode:xe,createChildNode:se,doAction:J,initDataviz:ce,isWithUser:yt,getNodeColor:vt,getLinkColor:xt,getNodeState:nt,getLinkState:at,Draw:Fe,unsetID:kt,linkNodes:Zt,unlinkNodes2:Xt,deleteNodes2:Yt,linkNodesPermanent:wt,unLinkNodes:rt,deleteNode:lt,unfixAll:_t,Escape:eo,reRenderGraph:Je,jsonDocuments:R,yUndoManagerNodes:K}},ua=pe({props:{yRootDoc:null,ySubDoc:null,ySubDocIndexedDb:null,ySubDocs:null,jSubDocs:null,spaceId:null,docId:null,nodeId:null,hocuspocusProvider:null,webRtcProvider:null,subStates:null,rootStates:null,paneVisible:null},emits:["onBackgroundClick","onBackgroundRightClick","onNodeHover","onNodeClick","onNodeRightClick","onNodeDrag","onNodeDragEnd","onLinkRightClick","onZoom","onZoomEnd","onLinkHover","onLinkClick","onLinkRightClick","onEngineTick","onEngineStop","deleteIndex","hide","show"],setup(e,{emit:o}){const a=e,r=Ze(),{state:u}=ue(),{osKey:l}=de(),{galaxyState:p,graph:h,computedNodeId:c,gravityOn:C,gravityOff:f,reRenderGraph:d,Escape:y,deleteNodes2:S,unLinkNodes:K,unlinkNodes2:G,doAction:T,linkNodes:R,jsonDocuments:H,zoomIn:P,zoomOut:L,deleteNode:Y,yUndoManagerNodes:V}=da(a.ySubDoc,o,a.docId,a.rootStates,a.hocuspocusProvider,a.yRootDoc);window.rpc&&window.rpc.notify&&ft.listen("tauri://menu",({event:m,payload:I})=>{switch(I){case"Center-Gravity":C();break;case"No-Gravity":f();break;case"Unfix-Gravity":d();break;case"Previous Node":break;case"Next Node":break;case"Exit Node":y();break;case"Delete Node":S();break;case"Cut Node-Links":G();break;case"New Root-Node":T(!1,!1);break;case"New Child-Node":T(!1,{id:a.nodeId});break;case"Link Nodes":R();break}});const A=m=>{m.key==="Escape"&&(m.preventDefault(),y()),m.key==="k"&&l(m)&&!m.shiftKey&&(m.preventDefault(),T(!1,{id:a.nodeId})),m.key==="o"&&l(m)&&m.preventDefault(),m.key==="j"&&l(m)&&(m.preventDefault(),T(!1,!0)),m.key==="l"&&l(m)&&(m.preventDefault(),K(a.nodeId)),m.key==="+"&&l(m)&&(m.preventDefault(),P()),m.key==="."&&l(m)&&(m.preventDefault(),u.value.useStrongGravity=!u.value.useStrongGravity),m.key==="-"&&l(m)&&(m.preventDefault(),L()),m.key==="Backspace"&&l(m)&&(m.preventDefault(),Y(a.nodeId))};return Pe(()=>{document.addEventListener("keydown",A)}),Ce(()=>{document.removeEventListener("keydown",A)}),(m,I)=>($(),j(ke,null,[_(ia,{"y-sub-doc":e.ySubDoc,"sub-states":e.subStates,"j-sub-docs":e.jSubDocs,"hocuspocus-provider":e.hocuspocusProvider,"web-rtc-provider":e.webRtcProvider},null,8,["y-sub-doc","sub-states","j-sub-docs","hocuspocus-provider","web-rtc-provider"]),_(Tn,{"linking-nodes":t(p).linkingNodes,"unlinking-nodes":t(p).unlinkingNodes,"deleting-nodes":t(p).deletingNodes,onRefreshGraph:I[0]||(I[0]=E=>t(d)()),onUndo:I[1]||(I[1]=E=>t(V).undo()),onRedo:I[2]||(I[2]=E=>t(V).redo()),onLinkNodes:t(R),onUnlinkNodes:t(G),onCreateNode:I[3]||(I[3]=E=>e.nodeId?t(T)(!1,{id:e.nodeId}):t(T)(!1,!0)),onDeleteNode:t(S)},null,8,["linking-nodes","unlinking-nodes","deleting-nodes","onLinkNodes","onUnlinkNodes","onDeleteNode"]),s("div",{id:"graph",class:z([{"dark-bg":t(r)},"select-none fixed top-0 left-0 right-0 bottom-0"])},null,2)],64))}}),pa=e=>{const{isMobile:o,hasNotch:a}=de(),r=ve(),u=me();let l;const p=ae(()=>u.params.document),h=ae(()=>u.params.node),c=We({paneCreated:!1,paneVisible:!1,paneState:"",backupPaneState:""}),C=()=>{o()&&(l.currentBreak()==="top"||l.moveToBreak("middle"))},f=()=>{c.paneVisible=!0,l.present()},d=()=>{l.hide()},y=L=>{h.value&&l.moveToBreak(L)},S=()=>{l.currentBreak()==="top"?(y("bottom"),c.paneState="bottom"):l.currentBreak()==="middle"?(y("top"),c.paneState="top"):l.currentBreak()==="bottom"&&(y("middle"),c.paneState="middle")},K=()=>{l.isPanePresented()&&!l.isHidden()&&(c.paneVisible=!1,l.hide())},G=()=>{r.push(`/${u.params.space}/${u.params.document}/`)},T=()=>{r.forward()},R=()=>{r.back()},H=()=>{l=new Uo(".editor-pane",{breaks:{top:{enabled:!0,height:window.innerHeight-(a()&&o()?90:60),bounce:!1},middle:{enabled:!0,height:a()&&o()?400:300,bounce:!1},bottom:{enabled:!0,height:a()&&o()?150:100,bounce:!1}},screenHeightOffset:"100",followerElement:"div.nav-bar",buttonClose:!1,showDraggable:o(),draggableOver:o(),initialBreak:"bottom",dragBy:[".pane .draggable"],clickBottomOpen:!1,fastSwipeClose:!1,fitHeight:!1,fitScreenHeight:!1,bottomOffset:a()?-40:0,onDidDismiss:()=>{e.value&&p.value&&r.push(`/${e.value}/${p.value}/`),c.paneVisible=!1},onWillPresent:()=>{c.paneVisible=!0},onDidPresent:()=>{h.value||l.hide()},onTransitionEnd:()=>{var L;c.paneState=l.currentBreak()?(L=l.currentBreak())==null?void 0:L.toString():"",l.isPanePresented()?h.value||l.hide():l.present()}}),c.paneCreated=!0,l.isPanePresented()?h.value||l.hide():l.present(),c.backupPaneState&&l.moveToBreak(c.backupPaneState)},P=()=>{var L;c.paneCreated=!1,c.backupPaneState=(L=l.currentBreak())==null?void 0:L.toString(),l.destroy()};return Pe(()=>{H()}),Ce(()=>{P(),c.paneCreated=!1}),{editorPaneState:c,editorPane:l,moveToFocus:C,showPane:f,hidePane:K,moveTo:y,switchPane:S,hide:d,unsetId:G,goForward:T,goBack:R,destroyPane:P,createPane:H}},fa=(e,o,a)=>{const r=We({hasLoadedSubDoc:!1});ve();const u=me(),l=ae(()=>u.params.node),p=e.getMap();let h;a&&a.length>=1?h=new qe({guid:a,autoLoad:!0}):h=new qe({autoLoad:!0});const c=h.getMap("nodes"),C=ee(),f=new At(h.guid,h),d=()=>{p.delete(h.guid);const S=h.getMap("nodes"),K=h.getMap("links"),G=S.toJSON(),T=Object.entries(G),R=K.toJSON(),H=Object.entries(R);for(let P=0;P<T.length;P++){const L=h.getXmlFragment(T[P][0]);L.delete(0,L.length),S.delete(T[P][0])}for(let P=0;P<H.length;P++)K.delete(H[P][0]);f.clearData().then(P=>console.log("cleared data",P))},y=S=>{const K=p.get(S);K?(K.updatedAt=new Date().toString(),p.set(S,K)):p.set(S,{guid:S,title:"Index",createdAt:new Date().toString(),updatedAt:new Date().toString()})};return f.once("synced",()=>{r.hasLoadedSubDoc=!0,(!a||!l.value)&&y(h.guid),C.value=Object.entries(c.toJSON()),c.observe(()=>{C.value=Object.entries(c.toJSON())})}),{subDocState:r,ySubDoc:h,ySubDocIndexedDb:f,ySubDocs:c,jSubDocs:C,deleteSubDoc:d}},ga={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 sm:block sm:p-0"},ha=s("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),ma={class:"inline-block align-bottom bg-white dark:bg-lityblack rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},ba={class:"bg-white bg-lityblack px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},ya={class:"sm:flex sm:items-start"},va={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},xa=be(" Do you want to delete all Nodes? "),ka=s("div",{class:"mt-2"},[s("p",{class:"text-sm font-medium text-gray-500 dark:text-gray-300"}," This action can only be partially reversed. ")],-1),wa={class:"bg-opacity-50 dark:bg-opacity-50 dark:bg-gray-900 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},_a=pe({props:{open:null},emits:["action"],setup(e,{emit:o}){return(a,r)=>($(),le(t(Ae),{as:"template",show:e.open},{default:O(()=>[_(t(Ie),{as:"div",class:"fixed z-10 inset-0 overflow-y-auto",onClose:r[2]||(r[2]=u=>e.open=!1)},{default:O(()=>[s("div",ga,[_(t(ge),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[_(t(De),{class:"fixed inset-0 transition-opacity"})]),_:1}),ha,_(t(ge),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[s("div",ma,[s("div",ba,[s("div",ya,[s("div",va,[_(t(Mo),{as:"h3",class:"text-lg leading-6 font-sans font-bold text-gray-900 dark:text-gray-100"},{default:O(()=>[xa]),_:1}),ka])])]),s("div",wa,[s("button",{type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:r[0]||(r[0]=u=>{e.open=!1,o("action")})}," Delete "),s("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white dark:bg-black text-base font-medium text-gray-700 dark:text-gray-100 dark:hover:ring-2 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:r[1]||(r[1]=u=>{e.open=!1,o("cancel")}),ref:(u,l)=>{l.cancelButtonRef=u}}," Cancel ",512)])])]),_:1})])]),_:1})]),_:1},8,["show"]))}}),Sa={class:"overflow-hidden"},$a=s("i",{class:"ri-arrow-left-circle-fill text-2xl"},null,-1),Na=[$a],Ca=s("i",{class:"ri-arrow-right-circle-fill text-2xl"},null,-1),Da=[Ca],Oa=pe({props:{yRootDoc:null,yRootDocIndexedDb:null,yRootDocs:null,jRootDocs:null,spaceId:null,spaceUrl:null,spaceToken:null,docId:null,nodeId:null,hocuspocusProvider:null,webRtcProvider:null,rootStates:null},setup(e){const o=e,a=ve();me();const{state:r,logger:u,toggleSearch:l,checkForOpenWindows:p,toggleOnly:h}=ue(),{osKey:c}=de(),C=ee(!1),f=ee(),d=ee(),{editorPaneState:y,editorPane:S,destroyPane:K,moveToFocus:G,showPane:T,hidePane:R,moveTo:H,switchPane:P,unsetId:L,goForward:Y,goBack:V,createPane:A}=pa(o.spaceId),{subDocState:m,ySubDoc:I,ySubDocIndexedDb:E,ySubDocs:v,jSubDocs:D,deleteSubDoc:U}=fa(o.yRootDoc,o.spaceId,o.docId?o.docId:null),{subStates:N,provideAwareness:k,provideSubHocuspocus:B,provideSubWebRtc:Z}=qt();k(I);const X=ae(()=>o.nodeId);ae(()=>o.docId);const F=ae(()=>r.value.useWebRtc),Q=ae(()=>r.value.useHocuspocus);ee(!1);const he=Ze();F.value&&!d.value&&(d.value=Z()),Q.value&&!f.value&&(f.value=B(o.spaceUrl,o.spaceToken)),window.rpc&&window.rpc.notify&&ft.listen("tauri://menu",({event:se,payload:J})=>{switch(J){case"Open Search":l();break;case"Toggle Editor Breaks":P();break}});const xe=se=>{se.key==="Escape"&&(se.preventDefault(),a.push(`/${o.spaceId}/${o.docId}`)),se.key==="Tab"&&se.shiftKey&&!se.altKey&&(se.preventDefault(),P()),se.key==="f"&&c(se)&&(se.preventDefault(),h("search")),se.key==="Backspace"&&se.shiftKey&&c(se)&&(se.preventDefault(),U(o.docId)),se.key==="p"&&c(se)&&se.preventDefault()};return fe(X,()=>{X.value&&X.value.length>=3?T():R()}),fe(F,()=>{F.value?d.value=Z():d.value&&d.value.destroy()}),fe(Q,()=>{Q.value?f.value=B(o.spaceUrl,o.spaceToken):f.value&&f.value.destroy()}),Pe(()=>{document.addEventListener("keydown",xe),window.addEventListener("resize",()=>{})}),Ce(()=>{d.value&&d.value.destroy(),f.value&&f.value.destroy(),document.removeEventListener("keydown",xe)}),(se,J)=>($(),j("div",Sa,[s("div",{style:{bottom:"130px"},class:z(["mt-0 ml-6 m-0 fixed nav-bar z-50 flex",{hidden:e.nodeId}])},[s("button",{class:"relative pt-0 p-1 pl-0 ml-3 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",type:"button",onClick:J[0]||(J[0]=(...ce)=>t(V)&&t(V)(...ce))},Na),s("button",{class:"relative pt-0 p-1 pl-0 ml-1 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",onClick:J[1]||(J[1]=(...ce)=>t(Y)&&t(Y)(...ce)),type:"button"},Da)],2),s("div",{class:z(["cupertino-pane editor-pane select-none",{blur:t(r)?t(r).blurredInterface&&!t(he):!1,"blur-dark":t(r)?t(r).blurredInterface&&t(he):!1,dark:t(r)&&!t(r).blurredInterface&&t(he),hidden:e.nodeId}])},[t(m).hasLoadedSubDoc&&e.nodeId&&t(y).paneCreated||t(r).useHocuspocus&&t(N).hocuspocus.connected&&t(m).hasLoadedSubDoc&&e.nodeId&&t(y).paneCreated||t(r).useWebRtc&&t(N).rtc.connected&&t(m).hasLoadedSubDoc&&e.nodeId&&t(y).paneCreated?($(),le(nn,{key:e.spaceId+e.docId+e.nodeId,"y-root-doc":e.yRootDoc,"y-root-docs":e.yRootDocs,"j-root-docs":e.jRootDocs,"y-sub-doc":t(I),"y-sub-doc-indexed-db":t(E),"y-sub-docs":t(v),"j-sub-docs":t(D),"space-id":e.spaceId,"doc-id":e.docId,"node-id":e.nodeId,"hocuspocus-provider":f.value,"web-rtc-provider":d.value,"sub-states":t(N),"pane-visible":t(y).paneVisible,"pane-state":t(y).paneState,onOnFocus:J[2]||(J[2]=ce=>t(G)()),onBottom:J[3]||(J[3]=ce=>t(H)("bottom")),onMiddle:J[4]||(J[4]=ce=>t(H)("middle")),onTop:J[5]||(J[5]=ce=>t(H)("top")),onHide:J[6]||(J[6]=ce=>t(L)()),onBack:J[7]||(J[7]=ce=>t(V)()),onForward:J[8]||(J[8]=ce=>t(Y)()),onSwitch:J[9]||(J[9]=ce=>t(P)())},null,8,["y-root-doc","y-root-docs","j-root-docs","y-sub-doc","y-sub-doc-indexed-db","y-sub-docs","j-sub-docs","space-id","doc-id","node-id","hocuspocus-provider","web-rtc-provider","sub-states","pane-visible","pane-state"])):q("",!0)],2),t(m).hasLoadedSubDoc&&e.docId&&t(y).paneCreated?($(),le(ua,{key:e.spaceId+e.docId,"y-root-doc":e.yRootDoc,"y-sub-doc":t(I),"y-sub-doc-indexed-db":t(E),"y-sub-docs":t(v),"j-sub-docs":t(D),"space-id":e.spaceId,"doc-id":e.docId,"node-id":e.nodeId,"hocuspocus-provider":f.value,"web-rtc-provider":d.value,"sub-states":t(N),"root-states":e.rootStates,"pane-visible":t(y).paneVisible,onHide:t(R),onShow:t(T),onDeleteIndex:J[10]||(J[10]=ce=>C.value=!0)},null,8,["y-root-doc","y-sub-doc","y-sub-doc-indexed-db","y-sub-docs","j-sub-docs","space-id","doc-id","node-id","hocuspocus-provider","web-rtc-provider","sub-states","root-states","pane-visible","onHide","onShow"])):q("",!0),_(_a,{open:C.value,onAction:J[11]||(J[11]=ce=>{t(U)(o.docId),C.value=!1}),onCancel:J[12]||(J[12]=ce=>C.value=!1)},null,8,["open"])]))}}),Ia={class:"fixed inset-0 z-50 dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 overflow-y-auto"},Aa={class:"text-center"},La=s("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),Ra={class:"m-3 text-black dark:text-white"},Ta={key:0,class:"pb-4"},Pa={key:1,class:"relative z-0 w-full mb-4 inline-flex justify-between"},Ea=["onKeydown","placeholder"],Ua={class:"absolute inset-y-0 right-0 flex py-0.5 pr-1.5"},Ma=s("i",{class:"ri-question-fill text-2xl"},null,-1),Ha=[Ma],Ba=s("i",{class:"ri-close-circle-fill text-2xl"},null,-1),ja=[Ba],Fa={class:"relative z-0 w-full overflow-y-scroll"},za={class:"flex inline-flex flex-nowrap"},Wa=s("i",{class:"ri-focus-line pr-1.5 text-2xl"},null,-1),Va=be(" New Gravity "),Ga=[Wa,Va],Ka=be(" Change Space "),Ja={class:"relative z-0 overflow-ellipsis w-full overflow-x-scroll"},qa={role:"list"},Za={style:{"min-width":"300px"},class:"px-2"},Xa={class:"flex justify-between"},Ya={class:"flex"},Qa={class:"mx-1 flex items-center text-sm w-64 font-bold overflow-hidden"},er=s("div",{class:"mt-1 flex items-center text-sm sm:mt-0"},null,-1),tr={class:"mt-1 flex items-center text-sm sm:mt-0"},or={key:0,class:"px-1 w-28 text-sm font-medium"},sr=s("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"nodes ",-1),nr={class:"w-48 text-md font-medium"},ar=s("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"UPDATED ",-1),rr={class:"px-1 w-48 text-sm font-medium"},lr=s("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"CREATED ",-1),ir=s("p",{class:"opacity-0 px-2 groups-hover:opacity-100"},[s("i",{class:"ri-delete-bin-2-fill text-lg"})],-1),cr=pe({props:{yRootDoc:null,yRootDocIndexedDb:null,jRootDocs:null,hocuspocusProvider:null,webRtcProvider:null,rootStates:null},emits:["createDocument"],setup(e,{emit:o}){const a=e,r=me(),u=ve(),{state:l,toggleSelector:p,toggleProvider:h,toggleShare:c,toggleUser:C,toggleOnly:f}=ue(),{getPlainText:d,hasNotch:y}=de(),S=ee(""),K=ee(0),G=(A,m)=>{Y(A,m)},T=ae(()=>a.jRootDocs?a.jRootDocs.filter(A=>A[1].title&&d(A[1].title).toLowerCase().includes(S.value.toLowerCase())).sort((A,m)=>A.updatedAt>m.updatedAt?-1:A.updatedAt<m.updatedAt?1:0).sort((A,m)=>d(A.title)>d(m.title)?1:d(m.title)>d(A.title)?-1:0):[]),R=()=>{K.value=(K.value+T.value.length-1)%T.value.length},H=()=>{K.value=(K.value+1)%T.value.length},P=()=>{S.value=d(T.value[K.value][1].title)},L=()=>{S.value.startsWith("/")?u.push(S.value):S.value.startsWith("{")?V(S.value):Y(T.value[K.value][0],K.value)},Y=(A,m)=>{K.value=m,p(),u.push("/"+r.params.space+"/"+A+"/index"),m>=T.value.length},V=A=>{if(A){S.value="";const m=JSON.parse(A);if(m.nodes&&m.links&&m.documents){const I=new qe;u.push(`/${r.params.space}/${I.guid}/index`);const E=Object.entries(m.links),v=Object.entries(m.nodes),D=I.getMap("nodes"),U=I.getMap("links");for(let N=0;N<v.length;N++)D.set(v[N][0],v[N][1]);for(let N=0;N<E.length;N++)U.set(E[N][0],E[N][1]);for(let N=0;N<m.documents.length;N++);}}};return(A,m)=>{const I=Ge("router-link");return $(),le(t(Ae),{show:t(l).isSelectorOpen,as:"template"},{default:O(()=>[_(t(Ie),{as:"div",onClose:t(p)},{default:O(()=>[s("div",Ia,[s("div",Aa,[_(t(ge),{as:"template",enter:"duration-20 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-20 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[_(t(De),{class:"fixed inset-0 backdrop-filter backdrop-blur2"})]),_:1}),La,_(t(ge),{as:"template",enter:"ease-out duration-20","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-20","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[s("div",{class:z(["inline-block align-bottom bg-white dark:bg-lityblack mt-16 p-0 rounded-lg pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:align-middle sm:max-w-4xl w-full",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(l).blurredInterface,"mt-32":t(y)()}])},[s("div",Ra,[e.rootStates.hocuspocus.awareness&&e.rootStates.hocuspocus.awareness.length>1?($(),j("div",Ta,[($(!0),j(ke,null,Te(e.rootStates.hocuspocus.awareness.slice(1),E=>($(),le(Mn,{key:E.clientId,route:t(r),state:E},null,8,["route","state"]))),128))])):q("",!0),($(),j("span",Pa,[s("form",{class:"w-full",onSubmit:m[3]||(m[3]=we(()=>{},["prevent"]))},[Ee(s("input",{id:"search",onKeydown:[Oe(we(R,["prevent"]),["up"]),Oe(we(H,["prevent"]),["down"]),Oe(we(P,["prevent"]),["right"]),Oe(we(L,["prevent"]),["enter"])],"onUpdate:modelValue":m[0]||(m[0]=E=>S.value=E),placeholder:"/"+t(r).params.space+"/"+(t(r).params.document?t(r).params.document+"/"+(t(r).params.node?t(r).params.node:""):""),autocomplete:"off",autocapitalize:"off",spellcheck:"false",autofocus:"",tabindex:"0",type:"text",name:"search",class:"border-0 h-8 bg-white dark:bg-gray-800 dark:text-white bg-opacity-50 dark:bg-opacity-50 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-100 block w-full pl-3 py-5 pr-12 rounded-lg"},null,40,Ea),[[Ue,S.value]]),s("div",Ua,[s("button",{type:"button",class:"-ml-px p-1 relative inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-200 hover:opacity-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-blue-600",onClick:m[1]||(m[1]=E=>t(f)("info"))},Ha),s("button",{type:"button",class:"-ml-px p-1 relative inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-200 hover:opacity-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-blue-600",onClick:m[2]||(m[2]=(...E)=>t(p)&&t(p)(...E))},ja)])],32)])),s("div",Fa,[s("span",za,[s("button",{type:"button",class:"ml-1 p-1 pr-3 relative inline-flex items-center text-sm font-medium text-gray-900 dark:text-gray-100 hover:opacity-70 flex-nowrap focus:z-10 focus:outline-none",onClick:m[4]||(m[4]=E=>{o("createDocument"),t(p)()})},Ga),s("button",{type:"button",class:"ml-1 p-1 pr-3 relative inline-flex items-center text-sm font-medium text-gray-900 dark:text-gray-100 hover:opacity-70 focus:z-10 focus:outline-none",onClick:m[5]||(m[5]=E=>{t(p)(),t(h)()})},[s("i",{class:z([{"animate animate-pulse text-green-600 dark:text-green-400":e.rootStates.hocuspocus.connected&&t(l).useHocuspocus},"ri-focus-2-line pr-1.5 text-2xl"])},null,2),Ka]),s("button",{type:"button",class:"ml-1 p-1 pr-3 relative inline-flex items-center text-sm font-medium text-gray-900 dark:text-gray-100 hover:opacity-70 focus:z-10 focus:outline-none",onClick:m[6]||(m[6]=E=>{t(p)(),t(c)()})},[s("i",{class:z([{"animate animate-pulse text-blue-600 dark:text-blue-400":t(l).useWebRtc},"ri-broadcast-line pr-1.5 text-2xl"])},null,2),be(" "+ie(t(l).useWebRtc?"Sharing":"Share")+" P2P ",1)]),s("button",{type:"button",class:"ml-1 p-1 pr-3 relative inline-flex items-center text-sm font-medium text-gray-900 dark:text-gray-100 hover:opacity-70 focus:z-10 focus:outline-none",onClick:m[7]||(m[7]=E=>{t(p)(),t(C)()})},[s("i",{class:"ri-fingerprint-line pr-1.5 text-2xl",style:Xe("color: "+t(l).localUserColor)},null,4),be(" "+ie(t(l).localUserName),1)])])])]),s("div",Ja,[s("ul",qa,[($(!0),j(ke,null,Te(t(T),(E,v)=>($(),j("li",{class:"group",key:E[1].id},[E[1]&&E[1].title?($(),le(I,{key:0,"active-class":"bg-gray-200 dark:bg-gray-800",class:z(["mb-1 mt-1 m-3 block rounded-md bg-white text-black dark:text-white dark:bg-gray-900 bg-opacity-50 dark:bg-opacity-50 group-hover:bg-gray-100 group-hover:bg-opacity-50 dark:group-hover:bg-gray-800 overflow-x-scroll",{"bg-blue-100 group-hover:text-black ring-2 ring-blue-600 dark:group-hover:text-white hover:bg-blue-200 dark:bg-blue-700 dark:group-hover:bg-blue-800":v===K.value}]),to:"/"+t(r).params.space+"/"+E[1].id+"/index",onClick:D=>G(E[0],v)},{default:O(()=>[s("div",Za,[s("div",Xa,[s("div",Ya,[s("p",Qa,ie(t(d)(E[1].title)),1)]),er,s("div",tr,[($(),j("p",or,[sr,be(" "+ie(E[1].count),1)])),s("p",nr,[ar,_(t(Ye),{time:E[1].updatedAt},{default:O(({timeAgo:D})=>[be(ie(D),1)]),_:2},1032,["time"])]),s("p",rr,[lr,_(t(Ye),{time:E[1].createdAt},{default:O(({timeAgo:D})=>[be(ie(D),1)]),_:2},1032,["time"])]),ir])])])]),_:2},1032,["class","to","onClick"])):q("",!0)]))),128))])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])}}});var dr="/assets/icon.43d42a8c.png";const ur={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 backdrop-filter backdrop-blur2 inset-0 z-50 overflow-y-auto"},pr={class:"text-center"},fr=s("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),gr={class:"grid grid-cols-2 text-black dark:text-white"},hr=s("img",{class:"mx-auto h-32 w-auto",src:dr,alt:"lity logo"},null,-1),mr={class:"mx-auto my-auto"},br=s("h1",{class:"mb-2 leading-1 text-2xl"},[be("Lity "),s("span",{class:"text-gray-700 dark:text-gray-300"},"Beta")],-1),yr={class:"text-gray-600 dark:text-gray-200"},vr=pe({setup(e){me(),ve();const{state:o,toggleInfo:a}=ue(),{hasNotch:r}=de();return(u,l)=>($(),le(t(Ae),{show:t(o).isInfoOpen,as:"template"},{default:O(()=>[_(t(Ie),{as:"div",onClose:t(a)},{default:O(()=>[s("div",ur,[s("div",pr,[_(t(ge),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[_(t(De),{class:"fixed inset-0"})]),_:1}),fr,_(t(ge),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[s("div",{class:z(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all m-3 sm:align-middle sm:max-w-md sm:w-full sm:p-6",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(o).blurredInterface,"mt-32":t(r)()}])},[s("div",null,[s("div",gr,[hr,s("div",mr,[br,s("span",yr,"Version "+ie(t(o).version),1)])])]),q("",!0)],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),xr={class:"h-full flex flex-col overflow-hidden dark:text-white text-black"},kr=pe({props:{spaceId:null,spaceUrl:null,spaceToken:null},setup(e){const o=e,a=me(),{state:r,logger:u,toggleOnly:l}=ue(),{osKey:p}=de(),{getSpace:h,setGravity:c,setIndex:C}=Qe(),{rootState:f,yRootDoc:d,yRootDocs:y,yRootIndexedDb:S,jRootDocs:K}=Ds(o.spaceId),{rootStates:G,rootHocuspocusProvider:T,rootWebRtcProvider:R,rootAwareness:H,provideRootHocuspocus:P,provideRootWebRtc:L,destroyRootWebRtc:Y,destroyRootHocuspocus:V}=Is(d);h(o.spaceId);const A=ae(()=>r.value.useWebRtc),m=ae(()=>r.value.useHocuspocus);A.value&&L(),m.value&&P(o.spaceUrl,o.spaceToken);const I=ae(()=>a.params.space),E=ae(()=>a.params.document),v=ae(()=>a.params.node);fe(v,()=>{D()}),fe(E,()=>{D(),E.value||c()}),fe(I,()=>{C(o.spaceId,a.params.document)});const D=()=>{H.setLocalStateField("user",{latestNode:v.value?v.value:null,latestDocument:E.value?E.value:null,latestSpace:o.spaceId||null,name:r.value.localUserName,color:r.value.localUserColor}),r.value.localLatestNode=v.value?v.value:null,r.value.localLatestSpace=o.spaceId||null,r.value.localLatestDocument=E.value?E.value:null};window.rpc&&window.rpc.notify&&ft.listen("tauri://menu",({event:N,payload:k})=>{}),fe(A,()=>{A.value?L():Y()}),fe(m,()=>{m.value?P(o.spaceUrl,o.spaceToken):V()});const U=N=>{N.key==="p"&&p(N)&&(N.preventDefault(),l("selector"))};return Pe(()=>{document.addEventListener("keydown",U)}),Ce(()=>{document.removeEventListener("keydown",U)}),(N,k)=>($(),j("div",xr,[_(vr),t(f).hasLoadedRootDoc?($(),le(cr,{key:0,"y-root-doc":t(d),"y-root-doc-indexed-db":t(S),"hocuspocus-provider":t(T),"web-rtc-provider":t(R),"root-states":t(G),"j-root-docs":t(K),onCreateDocument:t(c)},null,8,["y-root-doc","y-root-doc-indexed-db","hocuspocus-provider","web-rtc-provider","root-states","j-root-docs","onCreateDocument"])):q("",!0),t(f).hasLoadedRootDoc?($(),le(Oa,{"y-root-doc":t(d),"y-root-doc-indexed-db":t(S),"y-root-docs":t(y),"j-root-docs":t(K),key:t(a).params.space+t(a).params.document,"space-id":t(a).params.space,"space-token":e.spaceToken,"space-url":e.spaceUrl,"doc-id":t(a).params.document,"node-id":t(a).params.node,"hocuspocus-provider":t(T),"web-rtc-provider":t(R),"root-states":t(G)},null,8,["y-root-doc","y-root-doc-indexed-db","y-root-docs","j-root-docs","space-id","space-token","space-url","doc-id","node-id","hocuspocus-provider","web-rtc-provider","root-states"])):q("",!0)]))}}),wr={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 backdrop-filter backdrop-blur2 inset-0 z-50 overflow-y-auto"},_r={class:"text-center"},Sr=s("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),$r={class:"mt-2"},Nr=s("h1",{class:"text-2xl text-center"},"Settings ",-1),Cr={class:"mt-1"},Dr=s("div",{class:"text-xs font-sans font-bold text-gray-500 dark:text-gray-400 uppercase text-center tracking-wider"}," visual ",-1),Or={class:"my-2"},Ir=s("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Enable blurred windows",-1),Ar=s("div",{class:"text-xs font-sans font-bold text-gray-500 dark:text-gray-400 uppercase text-center tracking-wider"}," collaboration ",-1),Lr={class:"my-2"},Rr=s("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Show other online users in selectors",-1),Tr={class:"my-2"},Pr=s("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Dye nodes in user color",-1),Er={class:"my-2"},Ur=s("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Show cursors in nodes",-1),Mr=s("span",{class:"text-sm text-gray-500"},null,-1),Hr=s("div",{class:"text-xs font-sans font-bold text-gray-500 dark:text-gray-400 uppercase text-center tracking-wider"}," gravity ",-1),Br={class:"my-2"},jr=s("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Use stronger gravity forces ",-1),Fr=s("span",{class:"text-sm mx-2 float-right text-gray-500"},[s("kbd",null,"\u2318"),s("kbd",null,".")],-1),zr=pe({emits:["change"],setup(e,{emit:o}){me(),ve();const{state:a,toggleInfo:r,toggleSettings:u,setDefaults:l}=ue(),{hasNotch:p}=de();return ee(),ee(),(h,c)=>($(),le(t(Ae),{show:t(a).isSettingsOpen,as:"template"},{default:O(()=>[_(t(Ie),{as:"div",onClose:t(u)},{default:O(()=>[s("div",wr,[s("div",_r,[_(t(ge),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[_(t(De),{class:"fixed inset-0"})]),_:1}),Sr,_(t(ge),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[s("div",{class:z(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-3 text-left overflow-hidden shadow-xl transform transition-all sm:align-middle sm:max-w-md w-full",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(a).blurredInterface,"mt-32":t(p)()}])},[s("div",null,[s("div",$r,[Nr,s("div",Cr,[q("",!0),q("",!0),q("",!0),Dr,s("div",Or,[_(t(Me),{as:"div",class:"flex justify-between"},{default:O(()=>[_(t(He),{as:"span",class:""},{default:O(()=>[Ir]),_:1}),_(t(Be),{modelValue:t(a).blurredInterface,"onUpdate:modelValue":c[2]||(c[2]=C=>t(a).blurredInterface=C),class:z([t(a).blurredInterface?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:O(()=>[s("span",{"aria-hidden":"true",class:z([t(a).blurredInterface?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),Ar,s("div",Lr,[_(t(Me),{as:"div",class:"flex justify-between"},{default:O(()=>[_(t(He),{as:"span",class:""},{default:O(()=>[Rr]),_:1}),_(t(Be),{modelValue:t(a).showOtherUsers,"onUpdate:modelValue":c[3]||(c[3]=C=>t(a).showOtherUsers=C),class:z([t(a).showOtherUsers?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:O(()=>[s("span",{"aria-hidden":"true",class:z([t(a).showOtherUsers?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),s("div",Tr,[_(t(Me),{as:"div",class:"flex justify-between"},{default:O(()=>[_(t(He),{as:"span",class:""},{default:O(()=>[Pr]),_:1}),_(t(Be),{modelValue:t(a).showOtherColors,"onUpdate:modelValue":c[4]||(c[4]=C=>t(a).showOtherColors=C),class:z([t(a).showOtherColors?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:O(()=>[s("span",{"aria-hidden":"true",class:z([t(a).showOtherColors?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),s("div",Er,[_(t(Me),{as:"div",class:"flex justify-between"},{default:O(()=>[_(t(He),{as:"span",class:""},{default:O(()=>[Ur,Mr]),_:1}),_(t(Be),{modelValue:t(a).showOtherCursors,"onUpdate:modelValue":c[5]||(c[5]=C=>t(a).showOtherCursors=C),class:z([t(a).showOtherCursors?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:O(()=>[s("span",{"aria-hidden":"true",class:z([t(a).showOtherCursors?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),Hr,s("div",Br,[_(t(Me),{as:"div",class:"flex justify-between"},{default:O(()=>[_(t(He),{as:"span",class:""},{default:O(()=>[jr]),_:1}),Fr,_(t(Be),{modelValue:t(a).useStrongGravity,"onUpdate:modelValue":c[6]||(c[6]=C=>t(a).useStrongGravity=C),class:z([t(a).useStrongGravity?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:O(()=>[s("span",{"aria-hidden":"true",class:z([t(a).useStrongGravity?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),q("",!0),q("",!0),q("",!0),q("",!0),q("",!0),s("div",{onClick:c[12]||(c[12]=C=>{t(l)(),t(u)()}),class:"cursor-pointer text-xs font-sans font-bold m-5 text-gray-500 uppercase text-center tracking-wider"}," reset default ")])])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),Wr={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 inset-0 z-50 overflow-y-auto"},Vr={class:"text-center"},Gr=s("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),Kr={class:""},Jr={class:"pb-2"},qr=s("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Synchronize",-1),Zr={key:0,class:"mt-2"},Xr={class:"space-y-2"},Yr=["onClick"],Qr={class:"flex dark:text-white text-black items-center"},el={class:"text-sm"},tl={as:"p",class:"font-medium text-gray-900 dark:text-gray-100"},ol={key:0,as:"div",class:"text-gray-500"},sl={class:"sm:inline"},nl=be(" "+ie(" ")+" "),al=s("span",{class:"hidden sm:inline sm:mx-1","aria-hidden":"true"},"\xB7",-1),rl={key:1,class:""},ll={class:"my-2 w-full"},il=s("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Server Address",-1),cl={class:"mt-1 relative rounded-md shadow-sm"},dl=["onUpdate:modelValue"],ul={class:"my-1"},pl=s("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Access Code",-1),fl={class:"mt-1 relative rounded-md shadow-sm"},gl=["onUpdate:modelValue"],hl=s("p",null,"Leave empty if you want this space to remain offline.",-1),ml={key:0,type:"button",class:"mt-2 rounded-lg p-3 shadow-xl bg-blue-700 text-white bg-opacity-50"},bl={as:"div",class:"mt-2 flex text-sm sm:mt-0 sm:block sm:ml-4 sm:text-right"},yl={class:"font-medium text-gray-900 dark:text-gray-300"},vl=pe({emits:["change"],setup(e,{emit:o}){const a=me(),r=ve(),{state:u,toggleInfo:l,toggleProvider:p,toggleSelector:h,toggleOnly:c}=ue(),{localSpaces:C,resetSpaces:f,getSpace:d}=Qe(),{hasNotch:y}=de();ee(),ee();const S=ee();S.value=C.value.spaces[0];const K=G=>{G!==S.value&&(r.push(`/${G}/`),S.value=G,c("selector"))};return(G,T)=>($(),le(t(Ae),{show:t(u).isProviderOpen,as:"template"},{default:O(()=>[_(t(Ie),{as:"div",onClose:t(p)},{default:O(()=>[s("div",Wr,[s("div",Vr,[_(t(ge),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[_(t(De),{class:"fixed inset-0"})]),_:1}),Gr,_(t(ge),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[s("div",{class:z(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all m-3 sm:align-middle sm:max-w-md sm:w-full sm:p-6",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(u).blurredInterface,"mt-32":t(y)()}])},[s("div",null,[s("div",Kr,[s("div",Jr,[_(t(Me),{as:"div",class:"flex justify-between"},{default:O(()=>[_(t(He),{as:"span",class:""},{default:O(()=>[qr]),_:1}),_(t(Be),{modelValue:t(u).useHocuspocus,"onUpdate:modelValue":T[0]||(T[0]=R=>t(u).useHocuspocus=R),class:z([t(u).useHocuspocus?"bg-green-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"])},{default:O(()=>[s("span",{"aria-hidden":"true",class:z([t(u).useHocuspocus?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),($(),j("div",Zr,[s("div",null,[s("div",Xr,[($(!0),j(ke,null,Te(t(C).spaces,R=>($(),j("div",{onClick:H=>K(R.id),as:"template",key:R.id},[s("div",{class:z([R.id!==S.value?"border-transparent":"border-gray-300 ring-2 ring-blue-600",R.id===t(a).params.space?" ring-2 ring-blue-600 bg-blue-300 dark:bg-blue-600 bg-opacity-50 dark:bg-opacity-50":"","relative block border rounded-lg shadow-sm px-6 py-4 cursor-pointer sm:flex sm:justify-between focus:outline-none dark:bg-opacity-50 bg-opacity-50"])},[s("div",Qr,[s("div",el,[s("div",tl,ie(R.name),1),R.url?($(),j("div",ol,[s("p",sl,ie(R.url)+" / "+ie(R.id),1),nl,al])):q("",!0),S.value===R.id?($(),j("div",rl,[s("div",ll,[il,s("div",cl,[Ee(s("input",{"onUpdate:modelValue":H=>R.url=H,tabindex:"0",type:"text",name:"lity-server",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"wss://causa.lity.cc"},null,8,dl),[[Ue,R.url]])])]),s("div",ul,[pl,s("div",fl,[Ee(s("input",{"onUpdate:modelValue":H=>R.token=H,type:"text",name:"lity-server",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"xxxx-xxxx-xxxx-xxxx"},null,8,gl),[[Ue,R.token]])])]),hl,R.id!==t(a).params.space?($(),j("button",ml," Set as current Space ")):q("",!0)])):q("",!0)])]),s("div",bl,[s("div",yl,"/"+ie(R.id),1)]),s("div",{class:z([R.id===t(a).params.space?"border":"border-2",R.id===S.value?"border-white":"border-opacity-50","absolute -inset-px rounded-lg pointer-events-none"]),"aria-hidden":"true"},null,2)],2)],8,Yr))),128))])])])),q("",!0),q("",!0)])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),xl={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 backdrop-filter backdrop-blur2 inset-0 z-50 overflow-y-auto"},kl={class:"text-center"},wl=s("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),_l={class:""},Sl={key:0,class:"mt-2"},$l={class:"mt-2"},Nl=s("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Display Name",-1),Cl={class:"mt-1 relative rounded-md shadow-sm"},Dl={class:"mt-2"},Ol=s("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Color",-1),Il={class:"mt-1 relative rounded-md shadow-sm"},Al={class:"absolute inset-y-0 right-0 flex py-0.5 pr-1.5"},Ll={type:"button",class:"-ml-px p-1 relative inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-200 focus:z-10 focus:outline-none"},Rl={class:"mt-4"},Tl={class:"flex justify-between","aria-label":"Tabs"},Pl=["onClick"],El=pe({emits:["change"],setup(e,{emit:o}){me(),ve();const{state:a,toggleInfo:r,toggleProvider:u,toggleUser:l}=ue(),{hasNotch:p}=de();ee(),ee();const h=[{color:"#00a492",current:!1},{color:"#00b1ff",current:!1},{color:"#ffc711",current:!1},{color:"#F98181",current:!1},{color:"#b7f981",current:!1},{color:"#81eff9",current:!1},{color:"#8183f9",current:!1},{color:"#d181f9",current:!1},{color:"#f9ab81",current:!1},{color:"#1d4dd0",current:!1}];return(c,C)=>($(),le(t(Ae),{show:t(a).isUserOpen,as:"template"},{default:O(()=>[_(t(Ie),{as:"div",onClose:t(l)},{default:O(()=>[s("div",xl,[s("div",kl,[_(t(ge),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[_(t(De),{class:"fixed inset-0"})]),_:1}),wl,_(t(ge),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[s("div",{class:z(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all m-3 sm:align-middle sm:max-w-md sm:w-full sm:p-6",{"bg-opacity-80 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(a).blurredInterface,"mt-32":t(p)()}])},[s("div",null,[s("div",_l,[($(),j("div",Sl,[s("div",$l,[Nl,s("div",Cl,[Ee(s("input",{"onUpdate:modelValue":C[0]||(C[0]=f=>t(a).localUserName=f),type:"text",name:"lity-server",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"Name"},null,512),[[Ue,t(a).localUserName]])])]),s("div",Dl,[Ol,s("div",Il,[Ee(s("input",{"onUpdate:modelValue":C[1]||(C[1]=f=>t(a).localUserColor=f),type:"text",name:"lity-server",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"Color"},null,512),[[Ue,t(a).localUserColor]]),s("div",Al,[s("button",Ll,[s("i",{class:"ri-paint-brush-fill text-2xl",style:Xe("color: "+t(a).localUserColor)},null,4)])])])]),s("div",Rl,[s("nav",Tl,[($(),j(ke,null,Te(h,f=>s("span",{onClick:d=>t(a).localUserColor=f.color,key:f.color,style:Xe("cursor: pointer; background: "+f.color),class:z([[f.current?" text-gray-700":"text-gray-500 hover:text-gray-700","transition transition-opacity hover:opacity-50 px-3 py-2 font-medium text-sm rounded-md"],"inline-flex items-center justify-center h-8 w-8 rounded-full"])},null,14,Pl)),64))])])]))])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),Ul={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 backdrop-filter backdrop-blur2 inset-0 z-50 overflow-y-auto"},Ml={class:"text-center"},Hl=s("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),Bl={class:""},jl={class:""},Fl={class:"mt-0"},zl=s("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Share Gravity",-1),Wl=s("span",{class:"text-sm text-gray-500 dark:text-gray-400"}," (using WebRTC until restart)",-1),Vl={key:0,class:"mt-2"},Gl=s("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Share Link",-1),Kl={class:"mt-1 relative rounded-md shadow-sm"},Jl=["value"],ql={key:1,class:"mt-2"},Zl=s("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},[be("Password"),s("span",{class:"text-sm text-gray-500 dark:text-gray-400"}," (leave empty for an open room)")],-1),Xl={class:"mt-1 relative rounded-md shadow-sm"},Yl=pe({emits:["share","stop-sharing"],setup(e,{emit:o}){const a=me();ve();const{state:r,toggleShare:u}=ue(),{hasNotch:l}=de();ee(),ee(),ee();const p=ae(()=>"https://app.lity.cc/#/"+a.params.space+"/"+a.params.document+"/index");return(h,c)=>($(),le(t(Ae),{show:t(r).isShareOpen,as:"template"},{default:O(()=>[_(t(Ie),{as:"div",onClose:t(u)},{default:O(()=>[s("div",Ul,[s("div",Ml,[_(t(ge),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:O(()=>[_(t(De),{class:"fixed inset-0"})]),_:1}),Hl,_(t(ge),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:O(()=>[s("div",{class:z(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all m-3 sm:align-middle sm:max-w-md sm:w-full sm:p-6",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(r).blurredInterface,"mt-32":t(l)()}])},[s("div",null,[s("div",Bl,[s("div",jl,[s("div",Fl,[_(t(Me),{as:"div",class:"flex justify-between"},{default:O(()=>[_(t(He),{as:"span",class:""},{default:O(()=>[zl,Wl]),_:1}),_(t(Be),{modelValue:t(r).useWebRtc,"onUpdate:modelValue":c[0]||(c[0]=C=>t(r).useWebRtc=C),class:z([t(r).useWebRtc?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:O(()=>[s("span",{"aria-hidden":"true",class:z([t(r).useWebRtc?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),t(r).useWebRtc?($(),j("div",Vl,[Gl,s("div",Kl,[s("input",{type:"text",name:"webrtc-password",readonly:"",value:t(p),class:"h-8on bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg select-all",placeholder:"Share Link"},null,8,Jl)])])):q("",!0),t(r).useWebRtc?($(),j("div",ql,[Zl,s("div",Xl,[Ee(s("input",{type:"text",name:"webrtc-password","onUpdate:modelValue":c[1]||(c[1]=C=>t(r).localWebRtcPassword=C),class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"Room Password"},null,512),[[Ue,t(r).localWebRtcPassword]])])])):q("",!0)])])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),Ql={class:"w-screen h-screen"},tt={setup(e){const{state:o,toggleOnly:a}=ue(),{osKey:r}=de(),{redirect:u,isRedirected:l,spaceId:p,spaceUrl:h,spaceToken:c}=Qe();u();const C=f=>{f.key===","&&r(f)&&(f.preventDefault(),a("settings"))};return Pe(()=>{document.addEventListener("keydown",C)}),Ce(()=>{document.removeEventListener("keydown",C)}),(f,d)=>($(),j("div",Ql,[_(zr),_(vl),_(El),_(Yl),t(l)?($(),le(kr,{"space-id":t(p),key:t(p),"space-token":t(c),"space-url":t(h)},null,8,["space-id","space-token","space-url"])):q("",!0)]))}},ei=[{path:"/",component:tt},{path:"/:space",component:tt},{path:"/:space/:document",component:tt},{path:"/:space/:document/:node",component:tt}],ti=Ho({history:Bo(),linkActiveClass:"text-gray-900 font-bold",routes:ei});var ot;(function(e){e.INCREMENT="INCREMENT",e.RESTORE="RESTORE"})(ot||(ot={}));const oi={[ot.INCREMENT](e,o=1){e.count+=o},[ot.RESTORE](e,o){o.localUserName&&(e.localUserName=o.localUserName),o.localUserColor&&(e.localUserColor=o.localUserColor),o.serverAddress&&(e.serverAddress=o.serverAddress),o.serverToken&&(e.serverToken=o.serverToken),o.v1&&(e.v1=o.v1)}};var je;(function(e){e.initApp="initApp",e.openInfo="openInfo",e.openSelector="openSelector",e.openSettings="openSettings",e.openSearch="openSearch"})(je||(je={}));const si={[je.initApp]({state:e,commit:o,dispatch:a}){},[je.openSelector]({state:e,commit:o,dispatch:a}){e.isSelectorOpen=!e.isSelectorOpen},[je.openInfo]({state:e,commit:o,dispatch:a}){e.isInfoOpen=!e.isInfoOpen},[je.openSettings]({state:e,commit:o,dispatch:a}){e.isSettingsOpen=!e.isSettingsOpen},[je.openSearch]({state:e,commit:o,dispatch:a}){e.isSearchOpen=!e.isSearchOpen}},ni={isReady(e){return!e.isInitialized}},ai="1.2.5",ri={debug:!1,version:ai,isInitialized:!1,isOffline:!1,count:0,localUserName:"",localUserColor:"",localUserId:"",serverAddress:"",serverToken:"",isSettingsOpen:!1,isInfoOpen:!1,isSelectorOpen:!1,isSearchOpen:!1,useRTC:!1,useHocuspocus:!0},li=jo({state:ri,getters:ni,mutations:oi,actions:si});const ii=60*60*1e3;zt({onRegistered(e){e&&setInterval(()=>{e.update()},ii)}});const ci=Fo(),st=zo(Xo);st.use(li);st.use(ti);st.use(ci);st.mount("#app");
