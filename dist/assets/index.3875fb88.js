var ro=Object.defineProperty,io=Object.defineProperties;var lo=Object.getOwnPropertyDescriptors;var Dt=Object.getOwnPropertySymbols;var co=Object.prototype.hasOwnProperty,uo=Object.prototype.propertyIsEnumerable;var Ot=(e,o,s)=>o in e?ro(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s,Se=(e,o)=>{for(var s in o||(o={}))co.call(o,s)&&Ot(e,s,o[s]);if(Dt)for(var s of Dt(o))uo.call(o,s)&&Ot(e,s,o[s]);return e},It=(e,o)=>io(e,lo(o));import{r as q,v as po,d as ae,u as t,o as N,c as M,a,b as V,e as Ge,f as S,F as me,g as At,h as fe,i as ce,j as ee,k as je,D as Ze,I as Lt,A as Rt,H as Tt,W as Pt,l as $e,m as fo,n as j,p as Re,q as oe,s as go,P as Xe,N as Et,t as Ut,S as Mt,w as Ht,x as se,y as Bt,z as ho,C as mo,B as bo,E as yo,L as vo,G as xo,T as ko,J as wo,U as _o,K as So,M as $o,O as No,Q as Co,V as Do,R as Oo,X as Io,Y as Ft,Z as Ao,_ as be,$ as Lo,a0 as Ye,a1 as Ro,a2 as D,a3 as Qe,a4 as re,a5 as Ne,a6 as ie,a7 as Ce,a8 as Te,a9 as Pe,aa as De,ab as de,ac as et,ad as Oe,ae as Ie,af as To,ag as Po,ah as zt,ai as We,aj as jt,ak as Wt,al as Eo,am as Ae,an as Uo,ao as gt,ap as Mo,aq as Ho,ar as Ee,as as Ue,at as Me,au as Bo,av as Fo,aw as zo,ax as jo,ay as Wo}from"./vendor.6f949c86.js";const Vo=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))r(c);new MutationObserver(c=>{for(const i of c)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function s(c){const i={};return c.integrity&&(i.integrity=c.integrity),c.referrerpolicy&&(i.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?i.credentials="include":c.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(c){if(c.ep)return;c.ep=!0;const i=s(c);fetch(c.href,i)}};Vo();function Go(e={}){const{immediate:o=!1,onNeedRefresh:s,onOfflineReady:r,onRegistered:c,onRegisterError:i}=e;let m;const d=async(g=!0)=>{};return"serviceWorker"in navigator&&(m=new po("/sw.js",{scope:"/"}),m.addEventListener("activated",g=>{g.isUpdate?window.location.reload():r==null||r()}),m.register({immediate:o}).then(g=>{c==null||c(g)}).catch(g=>{i==null||i(g)})),d}function Vt(e={}){const{immediate:o=!0,onNeedRefresh:s,onOfflineReady:r,onRegistered:c,onRegisterError:i}=e,m=q(!1),d=q(!1);return{updateServiceWorker:Go({immediate:o,onNeedRefresh(){m.value=!0,s==null||s()},onOfflineReady(){d.value=!0,r==null||r()},onRegistered:c,onRegisterError:i}),offlineReady:d,needRefresh:m}}const Ko={key:0,class:"pwa-toast",role:"alert"},Jo={class:"message"},qo={key:0},Zo={key:1},Xo=ae({setup(e){const{offlineReady:o,needRefresh:s,updateServiceWorker:r}=Vt(),c=async()=>{o.value=!1,s.value=!1};return(i,m)=>t(o)||t(s)?(N(),M("div",Ko,[a("div",Jo,[t(o)?(N(),M("span",qo," App ready to work offline ")):(N(),M("span",Zo," New content available, click on reload button to update. "))]),t(s)?(N(),M("button",{key:0,onClick:m[0]||(m[0]=d=>t(r)())},"Reload")):V("",!0),a("button",{onClick:c},"Close")])):V("",!0)}});const Yo=ae({setup(e){return(o,s)=>{const r=Ge("router-view");return N(),M(me,null,[S(Xo),S(r)],64)}}}),Gt=()=>navigator.userAgent.indexOf("Mac OS X")!==-1,Qo=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),es=()=>{let e=!1;const o=document.createElement("div");if(CSS.supports("padding-bottom: env(safe-area-inset-bottom)")?(o.style.paddingBottom="env(safe-area-inset-bottom)",e=!0):CSS.supports("padding-bottom: constant(safe-area-inset-bottom)")&&(o.style.paddingBottom="constant(safe-area-inset-bottom)",e=!0),e){document.body.appendChild(o);const s=parseInt(window.getComputedStyle(o).paddingBottom);if(document.body.removeChild(o),s>0)return!0}return!1};function ts(e){return Gt()?e.metaKey:e.ctrlKey}const os=()=>"xxx-xxx-xxx".replace(/[xy]/g,function(e){const o=Math.random()*16|0;return(e=="x"?o:o&3|8).toString(16)}),ht=e=>e[Math.floor(Math.random()*e.length)],ss=()=>ht(["Isaac Newton","Friedrich Nietzsche","Johann Wolfgang von Goethe","Carl Jung","Steve Jobs","Ernesto Guevara","Robert M. Pirsig","Nikola Tesla","Leonardo da Vinci","Archimedes","Johannes Gutenberg","Galileo Galilei","Albert Einstein","Carl Benz","Steve Wozniak","Alfred Nobel","Hedy Lamarr","Ada Lovelace","Stephanie Kwolek","Grace Hopper","Konrad Zuse"]),ns=()=>ht(as()),as=()=>["#00a492","#00b1ff","#ffc711","#F98181","#b7f981","#81eff9","#8183f9","#d181f9","#f9ab81","#f9e181"],rs=e=>{let o="";if(Array.isArray(e))for(let s=0;s<e.length;s++)o+=e[s].text;else o=e;return o},is=e=>new Promise(o=>setTimeout(o,e)),ls=e=>{e=e.replace(/^\s+|\s+$/g,""),e=e.toLowerCase();const o="\xE0\xE1\xE4\xE2\xE8\xE9\xEB\xEA\xEC\xED\xEF\xEE\xF2\xF3\xF6\xF4\xF9\xFA\xFC\xFB\xF1\xE7\xB7/_,:;",s="aaaaeeeeiiiioooouuuunc------";for(let r=0,c=o.length;r<c;r++)e=e.replace(new RegExp(o.charAt(r),"g"),s.charAt(r));return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),e},cs=e=>Array.from(e.entries()).map(([o,s])=>Se({clientId:o},s.user));function ds(e,o,s){let r={};const c=e.getMap().get(o);c&&(r=c),r.title=s.title,r.count=3,r.updatedAt=new Date().toISOString(),r.guid||(r.guid=o),r.filled=!0,r.createdAt||(r.createdAt=new Date().toISOString()),e.getMap().set(o,r)}const he=()=>({isMac:Gt,isMobile:Qo,hasNotch:es,osKey:ts,uuid:os,delay:is,getPlainText:rs,getRandomElement:ht,getRandomUser:ss,getRandomColor:ns,stringToSlug:ls,updateDoc:ds,awarenessStatesToArray:cs}),{uuid:us,getRandomUser:ps,getRandomColor:fs}=he(),mt="1.2.4",gs="",hs="",ms="",Kt=!1,Jt=[],bs=e=>{E.value.debug&&console.log(e),E.value.debug&&Jt.push(e)},qt={debug:Kt,version:mt,useHocuspocus:!0,serverAddress:hs,serverToken:gs,useWebRtc:!1,signalingServerAddress:ms,localUserName:ps(),localUserId:us(),localUserColor:fs(),localWebRtcPassword:"",localLatestSpace:null,localLatestDocument:null,localLatestNode:null,isSettingsOpen:!1,isInfoOpen:!1,isSelectorOpen:!1,isSearchOpen:!1,isUserOpen:!1,isShareOpen:!1,isProviderOpen:!1,blurredInterface:!1,useLatestDocument:!0,showOtherColors:!0,showOtherUsers:!0,showOtherCursors:!0,useStrongGravity:!0,fixNodesOnDrag:!0,unfixLastNode:!0,zoomInOnNodeClick:!0,followNewlyCreatedNode:!0,followNewlyCreatedNodeMention:!0},E=At("local-lity-states",qt),ys=()=>{E.value=qt},Zt=()=>{E.value.isSelectorOpen=!1,E.value.isSearchOpen=!1,E.value.isSettingsOpen=!1,E.value.isInfoOpen=!1,E.value.isProviderOpen=!1,E.value.isUserOpen=!1,E.value.isShareOpen=!1,E.value.useWebRtc=!1,E.value.version<mt&&(E.value.version=mt,E.value.isInfoOpen=!0),E.value.blurredInterface&&(E.value.blurredInterface=!1,setTimeout(()=>{E.value.blurredInterface=!0},1e3))},vs=()=>{},xs=e=>{E.value.isSelectorOpen=e==="selector"?!E.value.isSelectorOpen:!1,E.value.isSearchOpen=e==="search"?!E.value.isSearchOpen:!1,E.value.isSettingsOpen=e==="settings"?!E.value.isSettingsOpen:!1,E.value.isInfoOpen=e==="info"?!E.value.isInfoOpen:!1,E.value.isProviderOpen=e==="provider"?!E.value.isProviderOpen:!1,E.value.isUserOpen=e==="user"?!E.value.isUserOpen:!1,E.value.isShareOpen=e==="share"?!E.value.isShareOpen:!1},ks=e=>{E.value.isSelectorOpen=!E.value.isSelectorOpen},ws=e=>{E.value.isSearchOpen=!E.value.isSearchOpen},_s=e=>{E.value.isSettingsOpen=!E.value.isSettingsOpen},Ss=e=>{E.value.isInfoOpen=!E.value.isInfoOpen},$s=e=>{E.value.isProviderOpen=!E.value.isProviderOpen},Ns=e=>{E.value.isUserOpen=!E.value.isUserOpen},Cs=e=>{E.value.isShareOpen=!E.value.isShareOpen};Zt();const ne=()=>({state:E,debug:Kt,debugLog:Jt,toggleOnly:xs,logger:bs,checkForOpenWindows:vs,toggleSelector:ks,toggleSearch:ws,toggleSettings:_s,toggleProvider:$s,toggleInfo:Ss,toggleUser:Ns,toggleShare:Cs,setDefaults:ys,setAppDefaults:Zt}),{uuid:bt,stringToSlug:Ds}=he(),ye=At("local-lity-spaces",{spaces:[]}),tt=()=>{const e=fe(),o=ce(),s=q(!1),r=ee(()=>o.params.space),c=ee(()=>o.params.space&&g(o.params.space)?g(o.params.space).url:""),i=ee(()=>o.params.space&&g(o.params.space)?g(o.params.space).token:""),m=()=>{f(),s.value=!0},d=(C,T,W,P)=>{const A=T?Ds(T):bt(),H={id:C||A,name:T||"LocalStorage",url:W||null,token:P||null,index:o.params.document||bt()};ye.value.spaces.push(H)},g=C=>{for(let T=0;T<ye.value.spaces.length;T++)if(ye.value.spaces[T].id===C)return ye.value.spaces[T];return null},I=()=>ye.value.spaces[0],f=()=>{ye.value.spaces.length===0?u():(o.params.space&&(g(o.params.space)||d(o.params.space,"Shared Space",null,null)),o.params.space||O(I()),o.params.space&&!o.params.document&&O(g(o.params.space)))},u=()=>{ye.value.spaces=[],d(),d("causa-lity-cc","Lity.CC (readme only)","wss://causa.lity.cc","READ-ME-ONLY"),d("y","LocalStorage (previous versions)"),o.params.space?g(o.params.space)||d(o.params.space,"Shared Space",null,null):O(I())},v=(C,T)=>{if(C&&T)for(let W=0;W<ye.value.spaces.length;W++)ye.value.spaces[W].id===C&&(ye.value.spaces[W].index=T)},O=C=>{e.push(`/${C.id}/${C.index}/index`)};return{localSpaces:ye,resetSpaces:u,redirect:m,isRedirected:s,spaceId:r,spaceUrl:c,spaceToken:i,setIndex:v,getSpace:g,createSpace:d,setGravity:C=>{const T=C||bt();e.push(`/${o.params.space}/${T}/index`)},createDefaultSpace:f}};tt();const Os=e=>{const o=je({hasLoadedRootDoc:!1}),s=new Ze({guid:e,autoLoad:!0}),r=s.getMap(),c=s.getMap("settings"),i=s.getText("latest"),m=new Lt(e,s),d=q();return m.once("synced",()=>{o.hasLoadedRootDoc=!0,d.value=Object.entries(r.toJSON());for(let g=0;g<d.value.length;g++)d.value[g][1].filled||r.delete(d.value[g][1].guid);r.observe(()=>{d.value=Object.entries(r.toJSON())})}),{rootState:o,yRootDoc:s,yRootDocs:r,yRootSettings:c,yRootLatestDoc:i,yRootIndexedDb:m,jRootDocs:d}},{awarenessStatesToArray:Is}=he(),As=e=>{const{state:o,logger:s}=ne(),r=je({hocuspocus:{init:!1,connected:!1,authenticated:!1,readOnly:!1,awareness:[]},rtc:{init:!1,connected:!1,readOnly:!1,awareness:[]}});let c,i;const m=new Rt(e),d=(u,v)=>{u&&(c=new Tt({url:u,name:e.guid,document:e,token:v,awareness:m,onAwarenessUpdate:({states:O})=>{r.hocuspocus.awareness=O},onConnect:()=>{r.hocuspocus.connected=!0},onAuthenticated:()=>{},onAuthenticationFailed:()=>{},onMessage:({event:O,message:G})=>{},onClose:({event:O})=>{r.hocuspocus.connected=!1},onDisconnect:({event:O})=>{r.hocuspocus.connected=!1}}),r.hocuspocus.init=!0,c.setAwarenessField("user",{name:o.value.localUserName,color:o.value.localUserColor}))},g=()=>{i=new Pt(e.guid,e,{awareness:m,password:o.value.localWebRtcPassword}),r.rtc.init=!0,r.rtc.connected=!0,i.awareness.setLocalStateField("user",{name:o.value.localUserName,color:o.value.localUserColor}),i.awareness.on("update",()=>{r.rtc.awareness=Is(i.awareness.states)})},I=()=>c.destroy();r.hocuspocus.connected=!1;const f=()=>i.destroy();return r.rtc.connected=!1,$e(()=>{c&&I(),i&&f()}),{rootStates:r,rootHocuspocusProvider:c,rootWebRtcProvider:i,rootAwareness:m,provideRootHocuspocus:d,provideRootWebRtc:g,destroyRootHocuspocus:I,destroyRootWebRtc:f}};var yt=(e,o)=>{for(const[s,r]of o)e[s]=r;return e};const Ls={props:{icon:{type:String,required:!0},title:{type:String,required:!0},action:{type:Function,required:!0},isActive:{type:Function,default:null}},data(){return{remixiconUrl:fo}}},Rs=["title"],Ts={class:"remix"},Ps=["xlink:href"];function Es(e,o,s,r,c,i){return N(),M("button",{class:j(["menu-item text-black dark:text-white hover:bg-opacity-50 hover:bg-gray-300 dark:hover:bg-gray-800",{"bg-gray-200 dark:bg-gray-900 text-blue-500 dark:text-blue-500":s.isActive?s.isActive():null}]),title:s.title,onClick:o[0]||(o[0]=(...m)=>s.action&&s.action(...m))},[(N(),M("svg",Ts,[a("use",{"xlink:href":`${c.remixiconUrl}#ri-${s.icon}`},null,8,Ps)]))],10,Rs)}var Us=yt(Ls,[["render",Es]]);const Ms={components:{MenuItem:Us},props:{editor:{type:Object,required:!0},pane:{type:Object}},data(){return{items:[{icon:"bold",title:"Bold",action:()=>this.editor.chain().focus().toggleBold().run(),isActive:()=>this.editor.isActive("bold")},{icon:"italic",title:"Italic",action:()=>this.editor.chain().focus().toggleItalic().run(),isActive:()=>this.editor.isActive("italic")},{icon:"strikethrough",title:"Strike",action:()=>this.editor.chain().focus().toggleStrike().run(),isActive:()=>this.editor.isActive("strike")},{icon:"code-view",title:"Code",action:()=>this.editor.chain().focus().toggleCode().run(),isActive:()=>this.editor.isActive("code")},{icon:"mark-pen-line",title:"Highlight",action:()=>this.editor.chain().focus().toggleHighlight().run(),isActive:()=>this.editor.isActive("highlight")},{type:"divider"},{icon:"h-1",title:"Heading 1",action:()=>this.editor.chain().focus().toggleHeading({level:1}).run(),isActive:()=>this.editor.isActive("heading",{level:1})},{icon:"h-2",title:"Heading 2",action:()=>this.editor.chain().focus().toggleHeading({level:2}).run(),isActive:()=>this.editor.isActive("heading",{level:2})},{icon:"paragraph",title:"Paragraph",action:()=>this.editor.chain().focus().setParagraph().run(),isActive:()=>this.editor.isActive("paragraph")},{icon:"list-unordered",title:"Bullet List",action:()=>this.editor.chain().focus().toggleBulletList().run(),isActive:()=>this.editor.isActive("bulletList")},{icon:"list-ordered",title:"Ordered List",action:()=>this.editor.chain().focus().toggleOrderedList().run(),isActive:()=>this.editor.isActive("orderedList")},{icon:"list-check-2",title:"Task List",action:()=>this.editor.chain().focus().toggleTaskList().run(),isActive:()=>this.editor.isActive("taskList")},{icon:"code-box-line",title:"Code Block",action:()=>this.editor.chain().focus().toggleCodeBlock().run(),isActive:()=>this.editor.isActive("codeBlock")},{type:"divider"},{icon:"double-quotes-l",title:"Blockquote",action:()=>this.editor.chain().focus().toggleBlockquote().run(),isActive:()=>this.editor.isActive("blockquote")},{icon:"separator",title:"Horizontal Rule",action:()=>this.editor.chain().focus().setHorizontalRule().run()},{type:"divider"},{icon:"text-wrap",title:"Hard Break",action:()=>this.editor.chain().focus().setHardBreak().run()},{icon:"format-clear",title:"Clear Format",action:()=>this.editor.chain().focus().clearNodes().unsetAllMarks().run()},{type:"divider"},{icon:"arrow-go-back-line",title:"Undo",action:()=>this.editor.chain().focus().undo().run()},{icon:"arrow-go-forward-line",title:"Redo",action:()=>this.editor.chain().focus().redo().run()},{type:"divider"}]}}},Hs={class:"pl-3 pr-3"};function Bs(e,o,s,r,c,i){const m=Ge("menu-item");return N(),M("div",Hs,[(N(!0),M(me,null,Re(c.items,(d,g)=>(N(),M(me,null,[d.type==="divider"?(N(),M("span",{key:`divider${g}`,class:"divider w-8"})):(N(),oe(m,go({key:1,key:g},d),null,16))],64))),256))])}var Fs=yt(Ms,[["render",Bs]]);const zs=new Xe("mention"),js=Et.create({name:"mention",addOptions(){return{HTMLAttributes:{},renderLabel({options:e,node:o}){return`${o.attrs.label}`},suggestion:{char:"@",pluginKey:zs,command:({editor:e,range:o,props:s})=>{var i;const r=e.view.state.selection.$to.nodeAfter;((i=r==null?void 0:r.text)==null?void 0:i.startsWith(" "))&&(o.to+=1),e.chain().focus().insertContentAt(o,[{type:this.name,attrs:s},{type:"text",text:" "}]).run()},allow:({editor:e,range:o})=>{const s=e.state.doc.resolve(o.from),r=e.schema.nodes[this.name];return!!s.parent.type.contentMatch.matchType(r)}}}},group:"inline",inline:!0,draggable:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}}},parseHTML(){return[{tag:"span[data-mention]"}]},renderHTML({node:e,HTMLAttributes:o}){return["span",Ut({"data-mention":"",class:"dark:bg-gray-700 dark:text-gray-200"},this.options.HTMLAttributes,o),this.options.renderLabel({options:this.options,node:e})]},renderText({node:e}){return this.options.renderLabel({options:this.options,node:e})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:e,state:o})=>{let s=!1;const{selection:r}=o,{empty:c,anchor:i}=r;return c?(o.doc.nodesBetween(i-1,i,(m,d)=>{if(m.type.name===this.name)return s=!0,e.insertText(this.options.suggestion.char||"",d,d+m.nodeSize),!1}),s):!1}),"Mod-Shift-k":()=>this.editor.commands.command(({tr:e,state:o})=>{const{selection:s}=o,r=Math.floor(new Date().getTime()+Math.random());return this.editor.chain().focus().insertContentAt(s,[{type:this.name,attrs:{id:r,label:s.$from.doc.textBetween(s.from,s.to,"")}},{type:"text",text:" "}]).run()})}},addProseMirrorPlugins(){return[Mt(Se({editor:this.editor},this.options.suggestion)),new Ht({key:new Xe("handleClick"),props:{handleClick:(e,o,s)=>{var c;const r=(c=s.target)==null?void 0:c.closest("span.mention");if(r){const i=window.location.href.match("(.*)#\\/(.+)\\/");return window.location.href=i[1]+"#/"+i[2]+"/"+r.getAttribute("data-id"),!0}return!1}}})]}});const Ws={props:{items:{type:Array,required:!0},command:{type:Function,required:!0}},data(){return{selectedIndex:0}},watch:{items(){this.selectedIndex=0}},methods:{onKeyDown({event:e}){return e.key==="ArrowUp"?(this.upHandler(),!0):e.key==="ArrowDown"?(this.downHandler(),!0):e.key==="Enter"?(this.enterHandler(),!0):!1},upHandler(){this.selectedIndex=(this.selectedIndex+this.items.length-1)%this.items.length},downHandler(){this.selectedIndex=(this.selectedIndex+1)%this.items.length},enterHandler(){this.selectItem(this.selectedIndex)},selectItem(e){const o=this.items[e];o&&this.command({id:o.id,label:o.label})}}},Vs={class:"items text-sm bg-white dark:bg-black shadow-xl backdrop-filter backdrop-blur2 backdrop-blur-lg font-mono p-0.5"},Gs=["onClick"];function Ks(e,o,s,r,c,i){return N(),M("div",Vs,[(N(!0),M(me,null,Re(s.items,(m,d)=>(N(),M("button",{key:d,class:j(["item text-gray-700 dark:text-gray-200 rounded-sm",{"dark:bg-blue-600 bg-blue-300 text-white ring-2 ring-blue-600 ":d===c.selectedIndex}]),onClick:g=>i.selectItem(d)},se(m.label),11,Gs))),128))])}var Js=yt(Ws,[["render",Ks],["__scopeId","data-v-59e8ae84"]]);const{awarenessStatesToArray:qs}=he(),Xt=()=>{const{state:e,logger:o}=ne(),s=je({init:!1,hocuspocus:{init:!1,connected:!1,authenticated:!1,readOnly:!1,awareness:[]},rtc:{init:!1,connected:!1,readOnly:!1,awareness:[]}});let r,c;const i=u=>(c=u,r=new Rt(c),r);let m,d;const g=(u,v)=>!u&&!v?null:(m=new Tt({url:u,name:c.guid,document:c,token:v,awareness:r,onAwarenessUpdate:({states:O})=>{s.hocuspocus.awareness=O},onConnect:()=>{s.hocuspocus.connected=!0},onAuthenticated:()=>{s.hocuspocus.authenticated=!0},onAuthenticationFailed:()=>{s.hocuspocus.authenticated=!1},onMessage:({event:O,message:G})=>{s.hocuspocus.init=!0},onClose:({event:O})=>{s.hocuspocus.init=!1},onDisconnect:({event:O})=>{s.hocuspocus.connected=!1,s.hocuspocus.authenticated=!1}}),s.hocuspocus.init=!0,m.setAwarenessField("user",{name:e.value.localUserName,color:e.value.localUserColor}),f(),m),I=()=>(d=new Pt(c.guid,c,{awareness:r,password:e.value.localWebRtcPassword}),s.rtc.init=!0,s.rtc.connected=!0,d.awareness.setLocalStateField("user",{test1:!0,name:e.value.localUserName,color:e.value.localUserColor}),d.awareness.on("update",()=>{s.rtc.awareness=qs(d.awareness.states)}),d),f=()=>{r.setLocalStateField("user",{latestDocument:"route.params.document",latestNode:"route.params.node",test:!0,name:e.value.localUserName,color:e.value.localUserColor})};return{subStates:s,subAwareness:r,subWebRtcProvider:d,subHocuspocusProvider:m,provideAwareness:i,provideSubHocuspocus:g,provideSubWebRtc:I}},Zs=new Xe("meta");Et.create({name:"meta",addOptions(){return{HTMLAttributes:{},renderLabel({options:e,node:o}){return`${o.attrs.label}`},suggestion:{char:"#",pluginKey:Zs,command:({editor:e,range:o,props:s})=>{var i;const r=e.view.state.selection.$to.nodeAfter;((i=r==null?void 0:r.text)==null?void 0:i.startsWith(" "))&&(o.to+=1),e.chain().focus().insertContentAt(o,[{type:this.name,attrs:s},{type:"text",text:" "}]).run()},allow:({editor:e,range:o})=>{const s=e.state.doc.resolve(o.from),r=e.schema.nodes[this.name];return!!s.parent.type.contentMatch.matchType(r)}}}},group:"inline",inline:!0,draggable:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}}},parseHTML(){return[{tag:"span[data-meta]"}]},renderHTML({node:e,HTMLAttributes:o}){return["i",Ut({"data-meta":"",class:"dark:bg-gray-700 dark:text-gray-200 ri-"+e.attrs.label+"-fill"},this.options.HTMLAttributes,o)]},renderText({node:e}){return this.options.renderLabel({options:this.options,node:e})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:e,state:o})=>{let s=!1;const{selection:r}=o,{empty:c,anchor:i}=r;return c?(o.doc.nodesBetween(i-1,i,(m,d)=>{if(m.type.name===this.name)return s=!0,e.insertText(this.options.suggestion.char||"",d,d+m.nodeSize),!1}),s):!1})}},addProseMirrorPlugins(){return[Mt(Se({editor:this.editor},this.options.suggestion)),new Ht({key:new Xe("handleClick"),props:{handleClick:(e,o,s)=>{var c;const r=(c=s.target)==null?void 0:c.closest("span.meta");if(r){const i=window.location.href.match("(.*)#\\/(.+)\\/");return window.location.href=i[1]+"#/"+i[2]+"/"+r.getAttribute("data-id"),!0}return!1}}})]}});const Xs=Bt.extend({content:"heading block*"}),{state:Ve,logger:cl}=ne();Xt();const Ys=(e,o,s,r,c,i)=>{const m=ce();fe(),q([]);const{isMobile:d,getPlainText:g,delay:I}=he(),f=o.getMap("nodes"),u=o.getMap("links"),v=f.get(s);console.dir(o.getXmlFragment(s));let O;const G=[Xs,ho.configure({history:!1,document:!1,codeBlock:!1}),mo.configure({lowlight:bo}),yo.configure({placeholder:({node:x})=>x.type.name==="heading"?v&&v.href?"Type a title for "+v.href:"Type a title for "+s:"/"}),vo,xo,ko,wo,_o,So,$o,No,Co,js.configure({HTMLAttributes:{class:"mention"},ySubDoc:o,suggestion:{allowSpaces:!0,items:({query:x})=>{const p=Object.values(f.toJSON()),b=[];return p.forEach(y=>{const $=y.id!==y.title?g(y.title):y.title;b.push({id:y.id,label:$})}),x.length>0&&b.push({id:Math.floor(new Date().getTime()+Math.random()),label:x}),b.filter(y=>y.label.toLowerCase().includes(x.toLowerCase())).slice(0,10)},render:()=>{let x,p;return{onStart:b=>{x=new Do(Js,{props:b,editor:b.editor}),p=Oo("body",{getReferenceClientRect:b.clientRect,appendTo:()=>document.body,content:x.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate(b){x.updateProps(b),p[0].setProps({getReferenceClientRect:b.clientRect})},onKeyDown(b){var y;return b.event.key==="Escape"?(p[0].hide(),!0):(y=x.ref)==null?void 0:y.onKeyDown(b)},onExit(){p[0].destroy(),x.destroy()}}}}}),Io.configure({document:o,field:s})];r&&Ve.value.showOtherCursors&&G.push(Ft.configure({provider:r,user:{name:Ve.value.localUserName,color:Ve.value.localUserColor}})),c&&!r&&Ve.value.showOtherCursors&&G.push(Ft.configure({provider:c,user:{name:Ve.value.localUserName,color:Ve.value.localUserColor}}));let C=!1;const T=new Ao({autofocus:!1,extensions:G,onCreate({editor:x}){H(x),B(),O=setTimeout(()=>{d()||x.commands.focus("end")},500)},onUpdate({editor:x}){e("onUpdate"),B();function p(b,y){let $={};const L=b.getMap().get(y);L&&($=L),$.updatedAt=new Date().toISOString(),$.guid||($.guid=y),$.filled=!0,$.createdAt||($.createdAt=new Date().toISOString()),b.getMap().set(y,$)}C&&p(i,m.params.document),C||(C=!0),O&&(clearTimeout(O),O=setTimeout(()=>{H(x)},200))},onFocus({editor:x}){e("onFocus"),B()},onBlur({editor:x}){e("onBlur")}}),W=x=>{const p=[];let b;function y($){if(Array.isArray($)){for(let L=0;L<$.length;L++)if(Array.isArray($[L].content))for(let F=0;F<$[L].content.length;F++)if(Array.isArray($[L].content)&&Array.isArray($[L].content[F].marks)){if($[L].content[F]){b={title:void 0,href:void 0},b.title=$[L].content[F].text;for(let R=0;R<$[L].content[F].marks.length;R++)$[L].content[F].marks[R].attrs&&$[L].content[F].marks[R].attrs.href&&(b.href=$[L].content[F].marks[R].attrs.href.replace(/\/$/,""),p.push(b))}}else $[L].content[F].content&&y($[L].content[F].content)}}return y(x),p},P=x=>{const p=[];let b;function y($){if(Array.isArray($)){for(let L=0;L<$.length;L++)if(Array.isArray($[L].content)){for(let F=0;F<$[L].content.length;F++)if(Array.isArray($[L].content)){const U=$[L].content[F];U.type==="mention"?(b={title:U.attrs.label,id:U.attrs.id},p.push(b)):U.content&&y(U.content)}}}}return y(x),p};function A(x){x=x.replace(/^\s+|\s+$/g,""),x=x.toLowerCase();const p="\xE0\xE1\xE4\xE2\xE8\xE9\xEB\xEA\xEC\xED\xEF\xEE\xF2\xF3\xF6\xF4\xF9\xFA\xFC\xFB\xF1\xE7\xB7/_,:;",b="aaaaeeeeiiiioooouuuunc------";for(let y=0,$=p.length;y<$;y++)x=x.replace(new RegExp(p.charAt(y),"g"),b.charAt(y));return x=x.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),x}function H(x){let p={id:s,title:s,group:1,created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[],links:[]};const b=f.get(s);b&&(p=b,p.created||(p.created=new Date().toISOString(),f.set(s,p)));const y=x.getJSON().content;if(y&&y[0]){const $=y[0].content?y[0].content:"";if($&&g($)!==g(p.title)&&(p.title=$,f.set(s,p),s==="index"?function(F,U){let R={};const K=F.getMap().get(U);K&&(R=K),R.title=p.title,R.updatedAt=new Date().toISOString(),R.guid||(R.guid=U),R.filled=!0,R.createdAt||(R.createdAt=new Date().toISOString()),F.getMap().set(U,R)}(i,m.params.document):function(F,U){let R={};const K=F.getMap().get(U);K&&(R=K),R.updatedAt=new Date().toISOString(),R.guid||(R.guid=U),R.filled=!0,R.createdAt||(R.createdAt=new Date().toISOString()),F.getMap().set(U,R)}(i,m.params.document)),$||y[0]&&!y[0].content&&p.id!==g(p.title)&&(f.set(s,p),p.href?x.commands.setContent(`<a href="${p.href}">${p.title}</a>`):x.commands.setContent(p.title)),y&&y.length>=1){const L=P(y),F=W(y);for(let U=0;U<L.length;U++){const R=s.toString(),K=L[U].id.toString(),le=u.get(R+"_"+K),ge=f.get(K);!le&&!ge?(f.set(K,{id:K,group:1,title:""+L[U].title+"",created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[R],links:[R]}),(async()=>{await I(100),u.set(R+"_"+K,{target:K,source:R,value:0})})()):!le&&ge&&(async()=>{await I(100),u.set(R+"_"+K,{target:K,source:R,value:0})})()}for(let U=0;U<F.length;U++){const R=s,K=F[U].href,le=A(K),ge=f.get(le);if((!ge||ge.href!==K)&&(f.set(le,{id:le,group:1,title:K,created:new Date().toISOString(),updated:new Date().toISOString(),href:K,neighbors:[R],links:[R]}),u.set(le+"_"+R,{target:R,source:le,value:0})),ge){const ve=s,xe=A(K);f.get(xe+"_"+ve)||u.set(xe+"_"+ve,{target:ve,source:xe,value:0})}}}}}function B(){const x=document.getElementsByClassName("ProseMirror")[0];x&&x.clientHeight<=35?e("bottom"):x&&x.clientHeight>=36&&x.clientHeight<=229&&e("middle"),x&&x.clientHeight>=230&&e("top")}return{yNodes:f,yLinks:u,currentNode:v,editor:T,getAllLinks:W,getAllMentions:P,stringToSlug:A,managePane:H,changePane:B}};const Qs=a("i",{class:"ri-arrow-left-circle-fill text-2xl"},null,-1),en=[Qs],tn=a("i",{class:"ri-arrow-right-circle-fill text-2xl"},null,-1),on=[tn],sn=a("i",{class:"ri-close-circle-fill text-2xl"},null,-1),nn=[sn],an=ae({props:{yRootDoc:null,yRootDocs:null,jRootDocs:null,ySubDoc:null,ySubDocIndexedDb:null,ySubDocs:null,jSubDocs:null,spaceId:null,docId:null,nodeId:null,hocuspocusProvider:null,webRtcProvider:null,subStates:null,paneVisible:null,paneState:null},emits:["onFocus","onBlur","onUpdate","bottom","middle","top","hide","back","forward","switch"],setup(e,{emit:o}){const s=e,r=()=>{const m=document.getElementsByClassName("editor__content")[0];m.scrollTop<=-50&&o("bottom"),m.scrollTop>=50&&o("top")},{state:c}=ne(),{editor:i}=Ys(o,s.ySubDoc,s.nodeId,s.hocuspocusProvider,s.webRtcProvider,s.yRootDoc);return $e(()=>{i.destroy()}),(m,d)=>(N(),M(me,null,[t(i)?(N(),M("div",{key:0,style:{width:"100%","margin-top":"-1px"},class:j(["mt-0 m-0 rounded-t-lg fixed z-20 top-0 flex bg-white dark:bg-lityblack",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(c).blurredInterface}])},[a("button",{class:"relative pt-0 p-1 pl-0 ml-3 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",type:"button",onClick:d[0]||(d[0]=g=>o("back"))},en),a("button",{class:"relative pt-0 p-1 pl-0 ml-1 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",type:"button",onClick:d[1]||(d[1]=g=>o("forward"))},on),S(Fs,{class:"editor__header my-2 w-auto mx-auto overflow-x-scroll whitespace-nowrap",editor:t(i)},null,8,["editor"]),a("button",{class:"relative pt-0 p-1 pr-0 mr-1 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",type:"button",onClick:d[2]||(d[2]=g=>o("switch"))},[a("i",{class:j(["text-2xl",{"ri-arrow-down-circle-fill":e.paneState==="top","ri-arrow-up-circle-fill":e.paneState!=="top"}])},null,2)]),a("button",{class:"relative pt-0 p-1 pr-0 mr-3 inline-flex items-center bg-transparent text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:outline-none",type:"button",onClick:d[3]||(d[3]=g=>o("hide"))},nn)],2)):V("",!0),t(i)?(N(),oe(t(Lo),{key:1,onScroll:r,onClick:d[4]||(d[4]=be(g=>t(i).isFocused?null:t(i).commands.focus("end"),["self"])),class:"editor__content dark:text-white fixed top-0 bottom-5 left-0 right-0 overflow-y-scroll p-3 pb-12 pt-12 select-auto",editor:t(i)},null,8,["editor"])):V("",!0)],64))}}),rn={class:"flex flex-col flex-nowrap items-center rounded-t-md rounded-b-md"},ln={class:"relative z-0 inline-flex"},cn=a("input",{id:"input",class:"hidden",type:"text"},null,-1),dn=a("i",{class:"ri-asterisk text-2xl"},null,-1),un=[dn],pn=a("i",{class:"ri-search-line text-2xl"},null,-1),fn=[pn],gn=a("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),hn=a("i",{class:"ri-refresh-line text-2xl"},null,-1),mn=[hn],bn=a("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),yn=a("i",{class:"ri-share-fill text-2xl"},null,-1),vn=[yn],xn=a("i",{class:"ri-add-circle-fill text-2xl"},null,-1),kn=[xn],wn=a("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),_n=a("i",{class:"ri-delete-bin-fill text-2xl"},null,-1),Sn=[_n],$n=a("i",{class:"ri-scissors-fill text-2xl"},null,-1),Nn=[$n],Cn=a("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),Dn=a("i",{class:"ri-arrow-go-back-fill text-2xl"},null,-1),On=[Dn],In=a("i",{class:"ri-arrow-go-forward-fill text-2xl"},null,-1),An=[In],Ln=a("span",{class:"bg-gray-100 dark:bg-gray-700 my-2 ml-1 mr-1",style:{width:"1px"}},null,-1),Rn=a("i",{class:"ri-settings-5-fill text-2xl"},null,-1),Tn=[Rn],Pn=ae({props:{unlinkingNodes:null,linkingNodes:null,deletingNodes:null},emits:["linkNodes","unlinkNodes","createNode","deleteNode","refreshGraph","undo","redo"],setup(e,{emit:o}){const s=e,r=Ye();Ro(r);const{state:c,toggleInfo:i,toggleSettings:m,toggleSearch:d,toggleSelector:g}=ne();return(I,f)=>(N(),M("div",{style:{width:"22.5em"},class:j(["transition top-pane rounded-lg transition-all duration-500 ease-in-out bg-white dark:bg-lityblack absolute follower-bar ml-auto mr-auto left-0 right-0 z-10",{"dark:bg-lityblackblur bg-opacity-50 backdrop-filter backdrop-blur":t(c).blurredInterface,blur2:t(r)}])},[a("div",rn,[a("span",ln,[cn,a("button",{class:"tooltip -ml-px pl-2 pr-0.5 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:f[0]||(f[0]=(...u)=>t(g)&&t(g)(...u))},un),a("button",{type:"button",class:"tooltip p-1 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",onClick:f[1]||(f[1]=(...u)=>t(d)&&t(d)(...u))},fn),gn,a("button",{class:"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:f[2]||(f[2]=u=>o("refreshGraph"))},mn),bn,a("button",{class:j([{"text-black":!s.linkingNodes,"text-blue-500 dark:text-blue-500 animate-pulse":s.linkingNodes},"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none"]),type:"button",onClick:f[3]||(f[3]=u=>o("linkNodes"))},vn,2),a("button",{class:"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:f[4]||(f[4]=u=>o("createNode"))},kn),wn,a("button",{class:j([{"text-black":!s.deletingNodes,"text-red-500 dark:text-red-500 animate-pulse":s.deletingNodes},"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none"]),type:"button",onClick:f[5]||(f[5]=u=>o("deleteNode"))},Sn,2),a("button",{class:j([{"text-black":!s.unlinkingNodes,"text-yellow-500 dark:text-yellow-500 animate-pulse":s.unlinkingNodes},"tooltip -ml-px p-1 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none"]),type:"button",onClick:f[6]||(f[6]=u=>o("unlinkNodes"))},Nn,2),Cn,a("button",{class:"tooltip -ml-px p-0.5 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:f[7]||(f[7]=u=>o("undo"))},On),a("button",{class:"tooltip -ml-px p-0.5 relative inline-flex items-center text-sm font-medium dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:f[8]||(f[8]=u=>o("redo"))},An),Ln,a("button",{class:"tooltip -ml-px p-1 pr-2 relative inline-flex items-center text-sm font-medium text-black dark:text-white opacity-70 hover:opacity-100 focus:z-10 focus:outline-none",type:"button",onClick:f[9]||(f[9]=(...u)=>t(m)&&t(m)(...u))},Tn)])])],2))}}),En={key:0,class:"font-medium leading-none text-white text-shadow-lg"},Un={key:0,class:""},Mn={key:1,class:"mx-3"},Hn=ae({props:{route:null,state:null},emits:["setStates"],setup(e,{emit:o}){const s=q(!1);return(r,c)=>{const i=Ge("router-link");return N(),oe(i,{onMouseenter:c[0]||(c[0]=m=>s.value=!0),onMouseleave:c[1]||(c[1]=m=>s.value=!1),disabled:!e.state.user.latestDocument,to:`/${e.route.params.space}/${e.state.user.latestDocument}/${e.state.user.latestNode?e.state.user.latestNode:"index"}`,tabindex:"1",onClick:c[2]||(c[2]=m=>o("setStates")),class:j(["inline-flex transition transition-all ease-in-out duration-500 group items-center justify-center h-10 w-10 rounded-full mr-2",{"w-auto":s.value}]),style:Qe("background: "+e.state.user.color)},{default:D(()=>[e.state.user&&e.state.user.name?(N(),M("span",En,[s.value?V("",!0):(N(),M("span",Un,se(e.state.user.name.split(/\s/).reduce((m,d)=>m+=d.slice(0,1),"")),1)),s.value?(N(),M("span",Mn,se(e.state.user.name),1)):V("",!0)])):V("",!0)]),_:1},8,["disabled","to","class","style"])}}}),Bn={class:"fixed inset-0 z-50 dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 overflow-y-auto"},Fn={class:"text-center"},zn=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),jn={class:"m-3"};const Wn={key:1,class:"relative mb-3 z-0 w-full inline-flex"},Vn=["onKeydown"],Gn={class:"absolute inset-y-0 right-0 flex py-0.5 pr-1.5"},Kn=a("i",{class:"ri-close-circle-fill text-2xl"},null,-1),Jn=[Kn],qn={key:0,class:"relative mt-3 z-0 overflow-ellipsis w-full overflow-x-scroll"},Zn={role:"list",style:{"max-height":"50vh"}},Xn={style:{"min-width":"300px"},class:"px-2 py-0"},Yn={class:"flex justify-between"},Qn={class:"flex"},ea={class:"flex items-center font-bold text-sm w-64 overflow-ellipsis"},ta=a("div",{class:"mt-2 flex items-center mt-0"},null,-1),oa={class:"mt-1 flex items-center mb-1"},sa={class:"px-2 w-28 text-sm font-medium"},na=a("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"Links ",-1),aa={class:"px-2 w-48 text-sm font-medium"},ra=a("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"Created ",-1),ia={class:"w-48 text-sm font-medium"},la=a("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"Updated ",-1),ca=ae({props:{ySubDoc:null,jSubDocs:null,hocuspocusProvider:null,webRtcProvider:null,subStates:null},setup(e){const o=e;Bt.extend({content:"heading block*"});const s=ce(),r=fe(),{state:c,toggleSearch:i}=ne(),m=q([]),d=q(""),g=ee(()=>c.value.isSearchOpen),I=ee(()=>o.jSubDocs?o.jSubDocs.filter(P=>W(P[1].title).toLowerCase().includes(d.value.toLowerCase())).slice(0,10).sort((P,A)=>W(P.title)>W(A.title)?1:W(A.title)>W(P.title)?-1:0):[]),f=q(0);re(d,()=>{f.value=0}),re(g,()=>{g.value?f.value=0:d.value=""});const u=()=>{f.value=(f.value+I.value.length-1)%I.value.length},v=()=>{f.value=(f.value+1)%I.value.length},O=()=>{d.value=W(I.value[f.value][1].title)},G=()=>{d.value.startsWith("{")?T(d.value):C(I.value[f.value],f.value)},C=(P,A)=>{f.value=A,i(),r.push("/"+s.params.space+"/"+s.params.document+"/"+P[0])},T=P=>{if(P){d.value="";const A=JSON.parse(P);if(A.nodes&&A.links&&A.documents){const H=Object.entries(A.links),B=Object.entries(A.nodes),x=o.ySubDoc.getMap("nodes"),p=o.ySubDoc.getMap("links");for(let b=0;b<B.length;b++)B[b][1].created||(B[b][1].created=new Date),B[b][1].updated||(B[b][1].updated=new Date),x.set(B[b][0],B[b][1]);for(let b=0;b<H.length;b++)p.set(H[b][0],H[b][1]);for(let b=0;b<A.documents.length;b++)o.ySubDoc.getXmlFragment()}}},W=P=>{let A="";if(Array.isArray(P))for(let H=0;H<P.length;H++)A+=P[H].text;else A=P;return A};return Ne(()=>{m.value=o.ySubDoc.getMap("nodes").toJSON()}),(P,A)=>{const H=Ge("router-link");return N(),oe(t(Ie),{show:t(c).isSearchOpen,as:"template"},{default:D(()=>[S(t(Oe),{as:"div",onClose:t(i)},{default:D(()=>[a("div",Bn,[a("div",Fn,[S(t(ie),{as:"template",enter:"duration-20 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-20 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[S(t(Ce),{class:"fixed inset-0"})]),_:1}),zn,S(t(ie),{as:"template",enter:"ease-out duration-20","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-20","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:j(["inline-block align-bottom bg-white dark:bg-lityblack mt-16 pb-3 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:align-middle sm:max-w-4xl w-full",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(c).blurredInterface}])},[a("div",jn,[(e.subStates.hocuspocus.awareness&&e.subStates.hocuspocus.awareness.length>1,V("",!0)),(N(),M("span",Wn,[a("form",{class:"w-full",onSubmit:A[2]||(A[2]=be(()=>{},["prevent"]))},[Te(a("input",{id:"search",onKeydown:[De(be(u,["prevent"]),["up"]),De(be(v,["prevent"]),["down"]),De(be(O,["prevent"]),["right"]),De(be(G,["prevent"]),["enter"])],"onUpdate:modelValue":A[0]||(A[0]=B=>d.value=B),placeholder:"Search for Nodes",autocomplete:"off",autocapitalize:"off",spellcheck:"false",autofocus:"",type:"text",name:"search",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg pr-12"},null,40,Vn),[[Pe,d.value]]),a("div",Gn,[a("button",{type:"button",class:"-ml-px p-1 relative inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-200 hover:opacity-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-blue-600",onClick:A[1]||(A[1]=(...B)=>t(i)&&t(i)(...B))},Jn)])],32)])),V("",!0)]),(N(),M("div",qn,[a("ul",Zn,[(N(!0),M(me,null,Re(t(I),(B,x)=>(N(),M("li",{key:B},[B[1]&&B[1].title?(N(),oe(H,{key:0,"active-class":"bg-gray-200 dark:bg-gray-800",class:j(["mb-1 mt-0.5 m-3 block rounded-md mb-0.5 bg-white text-black dark:text-white dark:bg-gray-900 bg-opacity-50 dark:bg-opacity-50 hover:bg-gray-100 dark:hover:bg-gray-800 overflow-x-scroll",{"bg-blue-100 hover:text-black ring-2 ring-blue-600 dark:hover:text-white hover:bg-blue-200 dark:bg-blue-700 dark:hover:bg-blue-800":x===f.value}]),onClick:p=>C(B,x),to:"/"+t(s).params.space+"/"+t(s).params.document+"/"+B[0]},{default:D(()=>[a("div",Xn,[a("div",Yn,[a("div",Qn,[a("p",ea,se(W(B[1].title)),1)]),ta,a("div",oa,[a("p",sa,[na,de(" "+se(B[1].links.length),1)]),a("p",aa,[ra,S(t(et),{time:B[1].created},{default:D(({timeAgo:p})=>[de(se(p),1)]),_:2},1032,["time"])]),a("p",ia,[la,S(t(et),{time:B[1].updated},{default:D(({timeAgo:p})=>[de(se(p),1)]),_:2},1032,["time"])])])])])]),_:2},1032,["class","onClick","to"])):V("",!0)]))),128))])]))],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])}}}),ot=Ye(),z=je({autoLink:!1,linkingNodes:!1,unlinkingNodes:!1,deletingNodes:!1,firstNode:void 0,secondNode:void 0,jsonDocuments:[]}),{osKey:da}=he(),{state:Ke,logger:dl}=ne(),ua=(e,o,s,r,c,i)=>{const m="graph";let d;const g=ce(),I=fe(),f=ee(()=>g.params.node);ee(()=>g.params.space);const u=To(),v=e.getMap("nodes"),O=e.getMap("links");e.getMap("selected");const G=new Po([v,O]),C=ee(()=>r.hocuspocus.awareness),T=ee(()=>r.rtc.awareness),W=q(),P={background:"rgba(255,255,255,0)",fontSize:16,lineColor:"#a7bac4",lineWidth:1,particleWidth:1.5,highlightedForeground:Ke.value.localUserColor||"#009dff",node:{note:"#00192a",placeholder:"#414141"}},A=zt().domain([0,30]).range([.5,2]).clamp(!0),H=zt().domain([1.2,2]).range([0,1]).clamp(!0),B={background:P.background,fontSize:parseInt(P.fontSize)-2,lineColor:P.lineColor,lineWidth:parseFloat(P.lineWidth),particleWidth:parseFloat(P.particleWidth),highlightedForeground:P.highlightedForeground,node:{note:P.node.note,placeholder:P.node.placeholder}},x={background:"rgba(0,0,0,0)",fontSize:16,lineColor:"#656565",lineWidth:1,particleWidth:1.5,highlightedForeground:Ke.value.localUserColor||"#009dff",node:{note:"#eaeaea",placeholder:"#a1a1a1"}},p={selectedNodes:new Set,hoverNode:null,focusNodes:new Set,focusLinks:new Set,hoverNodes:new Set,hoverLinks:new Set,nodeInfo:{},data:{nodes:[],links:[]},style:B},b=n=>{n(p);const l=new Set,h=new Set,w=new Set,_=new Set;if(p.hoverNode){w.add(p.hoverNode);const k=p.nodeInfo[p.hoverNode];k!==void 0&&(k.neighbors.forEach(Z=>l.add(Z)),k.links.forEach(Z=>h.add(Z)))}p.selectedNodes&&p.selectedNodes.forEach(k=>{l.add(k);const Z=p.nodeInfo[k];Z!==void 0&&(Z.neighbors.forEach(Q=>l.add(Q)),Z.links.forEach(Q=>h.add(Q)))}),p.focusNodes=l,p.focusLinks=h,p.hoverNodes=w,p.hoverLinks=_},y={refresh:n=>b(l=>{l.nodeInfo=n.nodes;const h=n.links,w=new Set(Object.keys(l.nodeInfo)),_=new Set;l.data.nodes.forEach((k,Z)=>{w.has(k.id)?w.delete(k.id):_.add(Z)}),_.forEach(k=>{l.data.nodes.splice(k,1)}),w.forEach(k=>{v.get(k)&&l.data.nodes.push({id:k,y:v.get(k).y,x:v.get(k).x})}),l.data.links=h,l.hoverNode=l.nodeInfo[l.hoverNode]!=null?l.hoverNode:null,l.selectedNodes=new Set(Array.from(l.selectedNodes).filter(k=>l.nodeInfo[k]!=null)),u.graphData(l.data)}),selectNode:(n,l)=>b(h=>{if(l||h.selectedNodes.clear(),n!=null){h.selectedNodes.add(n);const w=u.graphData().nodes;for(const[_,k]of Object.entries(w))if(k.id===n){u.centerAt(k.x,k.y,300),u.zoom(7,300);break}}}),highlightNode:n=>b(l=>{l.hoverNode=n}),updateStyle:n=>{!n||(p.style=It(Se(Se({},B),n),{lineColor:n.lineColor||n.node&&n.node.note||B.lineColor,node:Se(Se({},B.node),n.node)}),u.backgroundColor(p.style.background))}},$=(n,l=!0)=>(Object.values(n.nodes).forEach(h=>{h.neighbors=[],h.links=[]}),l||n.links.forEach(h=>{try{const w=n.nodes[h.source||h.source.id],_=n.nodes[h.target||h.target.id];w&&_&&(w.neighbors.push(_.id),_.neighbors.push(w.id),w.links.push(h),_.links.push(h))}catch(w){console.log(w)}}),n);function L(){const n=[],l=[];O.forEach((h,w,_)=>{l.push(h)});for(let h=0;h<l.length;h++)l[h].source&&l[h].source.id?v.get(l[h].source.id)&&v.get(l[h].target.id)&&n.push({source:l[h].source.id,target:l[h].target.id,value:0}):v.get(l[h].source)&&v.get(l[h].target)&&n.push({source:l[h].source,target:l[h].target,value:0});return n}const F=(n=!1)=>{const l=L(),h=v.toJSON();v.get("index")||(v.set("index",{id:"index",group:1,title:"",created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[],links:[]}),y.selectNode("index"));function w(Z,Q){let X={};const pe=Z.getMap().get(Q);pe&&(X=pe);const Y=Object.entries(h).length;X.count!==Y&&(X.count=Y),X.updatedAt=new Date().toISOString(),X.guid||(X.guid=Q),X.filled=!0,X.createdAt||(X.createdAt=new Date().toISOString()),X.count.toString()!==Y.toString()&&Z.getMap().set(Q,X)}w(i,g.params.document);const k=$({nodes:h,links:l},n);y.refresh(k),u.d3ReheatSimulation()},U=()=>{u.zoom(u.zoom()+1,300)},R=()=>{u.zoom(u.zoom()-1,300)},K=()=>{u.d3Force("center",We(0,0)),u.d3Force("x",jt(0).strength(.1)),u.d3Force("y",Wt(0).strength(.1)),qe()},le=()=>{u.d3Force("center",We(0,0)),u.d3Force("x",jt(0).strength(.01)),u.d3Force("y",Wt(0).strength(.01)),qe()},ge=n=>{const l=Object.values(v.toJSON()),h=[];for(let w=0;w<l.length;w++)n.toLowerCase()===getPlainText(l[w].title).toLowerCase()&&h.push(l[w].id);return[]},ve=n=>{const l=ge(n);return l.length>=1?l[0]:!1},xe=n=>!!v.get(n).getJSON(),we=(n,l,h)=>(v.set(n,{id:n,group:1,title:""+l+"",neighbors:[],links:[]}),n),Be=(n,l)=>(O.set(n+"_"+l,{source:n,target:l,value:0}),n+"_"+l),Je=(n,l)=>{const w=Math.floor(new Date().getTime()+Math.random()).toString();return we(w,n,l)},te=(n,l,h)=>{const _=Math.floor(new Date().getTime()+Math.random()).toString(),k=we(_,l,h);return Be(n,_),k},J=(n,l)=>{z.linkingNodes&&(z.linkingNodes=!1),z.deletingNodes&&(z.deletingNodes=!1),z.unlinkingNodes&&(z.unlinkingNodes=!1);const h=Math.floor(new Date().getTime()+Math.random());let w;if(l){const X=f.value||null,pe=l.id?l.id.toString():X,Y=h.toString();w=Y,pe?(v.set(Y,{id:Y,group:1,created:new Date().toISOString(),updated:new Date().toISOString(),title:""+Y+"",neighbors:[pe],links:[pe]}),O.set(pe+"_"+Y,{source:pe,target:Y,value:0})):v.set(Y,{id:Y,group:1,title:""+Y+"",created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[],links:[]})}else w=h,v.set(h.toString(),{id:h.toString(),group:1,title:""+h.toString()+"",created:new Date().toISOString(),updated:new Date().toISOString(),neighbors:[],links:[]});const _=L(),k={nodes:v.toJSON(),links:_},Z=v.get(w),Q=$(k,!1);y.refresh(Q),y.selectNode(w),u.centerAt(Z.x,Z.y,300),I.push({path:`/${g.params.space}/${g.params.document}/${w}`})},ue=()=>{u(d).cooldownTicks(50).graphData(p.data).backgroundColor(p.style.background).linkHoverPrecision(8).d3Force("collide",Eo(u.nodeRelSize())).linkWidth(()=>p.style.lineWidth||P.lineWidth).linkDirectionalParticles(1).linkDirectionalParticleWidth(n=>it(n,p)==="highlighted"?p.style.particleWidth||P.particleWidth:0).nodeCanvasObject((n,l,h)=>{const w=p.nodeInfo[n.id];if(w==null){console.error(`Could not find info for node ${n.id} - skipping`);return}const _=A(w.neighbors.length),{fill:k,border:Z}=xt(n.id,p),Q=p.style.fontSize/h*1.1,X=rt(n.id,p),pe=k.copy({opacity:X==="regular"?H(h):X==="highlighted"?1:Math.min(H(h),k.opacity)}),Y=Z.copy({opacity:X==="regular"?H(h):X==="highlighted"?1:Math.min(H(h),k.opacity)}),ke=(_e=>{let ze="";const ao=[];if(Array.isArray(_e))for(let ft=0;ft<_e.length;ft++)ze+=_e[ft].text;else ze=_e;return{text:ze,marks:ao}})(w.title).text,so=JSON.stringify(w.title).toString(),Nt=/(\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/gi,ut=ke.match(Nt);ke.replace(Nt,"");const no=n.id.startsWith("http"),pt=so.includes("highlight");function Le(_e,ze){return _e.length>ze?_e.substr(0,ze-1)+"...":_e}Ae(pe).copy({opacity:.3});const Ct=X==="lessened";ut&&!pt?Fe(l).circle(n.x,n.y,_+.5,Z).circle(n.x,n.y,_,k).text(Le(ke,48),n.x,n.y+_+1,Q,Y):pt&&!ut?Fe(l).circle(n.x,n.y,_+.5,Z).circle(n.x,n.y,_,k).highlighted(Le(ke,48),n.x,n.y+_+1,Q,Y,Ct,H(h)).text(Le(ke,48),n.x,n.y+_+1,Q,Y):pt&&ut?Fe(l).highlighted(Le(ke,48),n.x,n.y+_,Q,Y,Ct,H(h)).text(Le(ke,48),n.x,n.y-_+1,Q,Y):no?Fe(l).circle(n.x,n.y,_,Z).text(Le(ke,48),n.x,n.y+_+1,Q,Y):Fe(l).circle(n.x,n.y,_+.5,k).circle(n.x,n.y,_,Z).text(Le(ke,48),n.x,n.y+_+1,Q,Y)}).linkColor(n=>kt(n,p)).nodePointerAreaPaint((n,l,h)=>{const w=6;h.beginPath(),h.arc(n.x,n.y,w,0,2*Math.PI,!1),h.fillStyle=l,h.fill(),h.closePath()}).onNodeHover(n=>{o("onNodeHover",n),y.highlightNode(n==null?void 0:n.id)}).onNodeClick((n,l)=>{if(o("onNodeClick",n),z.unlinkingNodes){lt(n.id);return}if(z.deletingNodes){ct(n.id);return}if(da(l)){const h=v.get(n.id);h.href&&open(h.href)}else n.fx=n.x,n.fy=n.y,z.linkingNodes&&(z.firstNode&&z.firstNode.length>3?_t(z.firstNode,n.id):z.firstNode=n.id),u.centerAt(n.x,n.y,300),y.selectNode(n.id,!1),I.push({path:`/${g.params.space}/${g.params.document}/${n.id}`})}).onZoom((n,l)=>{o("onZoom")}).onZoomEnd((n,l)=>{o("onZoomEnd")}).onLinkHover((n,l)=>{o("onLinkHover")}).onLinkClick((n,l)=>{o("onLinkClick"),z.unlinkingNodes&&to(n.source.id+"_"+n.target.id)}).onLinkRightClick((n,l)=>{o("onLinkRightClick")}).onEngineTick((n,l)=>{o("onEngineTick")}).onEngineStop((n,l)=>{o("onEngineStop")}).onBackgroundClick(()=>{o("onBackgroundClick"),y.selectNode(void 0,!1),I.push({path:`/${g.params.space}/${g.params.document}`})}).onBackgroundRightClick(n=>{o("onBackgroundRightClick",n),u.screen2GraphCoords(n.x,n.y),J()}).onNodeRightClick(n=>{o("onNodeRightClick",n),J(!1,n)}).onNodeDrag(n=>{o("onNodeDrag",n)}).onNodeDragEnd(n=>{o("onNodeDragEnd",n),n.fx&&n.fy?(n.fx=void 0,n.fy=void 0):(n.fx=n.x,n.fy=n.y)})},vt=n=>{const l=[],h=r.hocuspocus.awareness.length>1?Object.values(r.hocuspocus.awareness):r.rtc.awareness.length>1?Object.values(r.rtc.awareness):[];if(h)for(let w=0;w<h.length;w++){const _=h[w].user;_&&_.latestDocument&&_.latestNode&&_.latestNode===n&&l.push(_)}return l};function xt(n,l){var Q,X,pe,Y;const h=l.nodeInfo[n],w=l.style,_=Ae((X=w.node[(Q=h.type)!=null?Q:"note"])!=null?X:w.node.note);let k=Ae((Y=w.node[(pe=h.type)!=null?pe:"note"])!=null?Y:w.node.note);const Z=Ke.value.showOtherColors?vt(n):[];switch(Z.length>=1&&(k=Ae(Z[0].color)),n===f.value&&(k=Ae(Ke.value.localUserColor)),rt(n,l)){case"regular":return{fill:_,text:_,border:k};case"lessened":const $t=Ae(_).copy({opacity:.3}),dt=Ae(k).copy({opacity:.3});return{fill:$t,text:dt,border:dt};case"focused":return{fill:Ae(w.highlightedForeground),text:_,border:k};case"highlighted":return{fill:_,text:_,border:k};default:throw new Error("Unknown type for node",n)}}function kt(n,l){const h=l.style;switch(it(n,l)){case"regular":return h.lineColor;case"highlighted":return h.highlightedForeground;case"focused":return h.highlightedForeground;case"lessened":return Uo(h.lineColor).copy({opacity:.5});default:throw new Error("Unknown type for link",n)}}function rt(n,l){return l.selectedNodes.has(n)?"highlighted":l.hoverNode===n?"focused":l.focusNodes.size===0||l.focusNodes.has(n)?"regular":"lessened"}function it(n,l){return l.focusNodes.size===0?"regular":l.focusLinks.has(n)?"highlighted":"lessened"}const Fe=n=>({circle:function(l,h,w,_){return n.beginPath(),n.arc(l,h,w,0,2*Math.PI,!1),n.fillStyle=_,n.fill(),n.closePath(),this},ring:function(l,h,w,_){return n.beginPath(),n.arc(l,h,w*2,0,2*Math.PI,!1),n.fillStyle=_,n.fill(),n.closePath(),this},text:function(l,h,w,_,k){return n.font=`${_}px Sans-Serif`,n.textAlign="center",n.textBaseline="top",n.fillStyle=k,n.fillText(l,h,w),this},emoji:function(l,h,w,_,k){return n.font=`${_}px Sans-Serif`,n.textAlign="center",n.globalAlpha=.7,n.fillStyle=k,n.fillText(l,h,w),this},highlighted:function(l,h,w,_,k,Z,Q){n.font=`${_}px Sans-Serif`,n.fillStyle="rgba(255,251,0,"+(Q-.2)+")",Z&&(n.fillStyle="rgba(255,251,0,"+(Q-.2)+")");const X=n.measureText(l).width;return n.fillRect(h-X/2,w,X,parseInt(n.font,0)*1.1),this}}),wt=()=>{I.push(`/${g.params.space}/${g.params.document}/`)},Yt=()=>{z.deletingNodes&&(z.deletingNodes=!1),z.unlinkingNodes&&(z.unlinkingNodes=!1),f.value&&f.value.length>3&&(z.firstNode=f.value),z.linkingNodes=!z.linkingNodes,z.linkingNodes||(z.firstNode=null)},Qt=()=>{z.deletingNodes&&(z.deletingNodes=!1),z.linkingNodes&&(z.linkingNodes=!1),f.value&&f.value.length>3?lt(f.value):z.unlinkingNodes=!z.unlinkingNodes},eo=()=>{z.linkingNodes&&(z.linkingNodes=!1),z.unlinkingNodes&&(z.unlinkingNodes=!1),f.value&&f.value.length>3?ct(f.value):z.deletingNodes=!z.deletingNodes},_t=(n,l)=>{n&&l&&(z.firstNode=void 0,z.secondNode=void 0,O.set(n+"_"+l,{source:n,target:l,value:0})),z.linkingNodes=!1},lt=n=>{n&&(v.forEach((l,h)=>{const w=l.neighbors,_=l.links;for(let k=0;k<w.length;k++)w[k]===n&&w.splice(k,1);for(let k=0;k<_.length;k++)(_[k].source==n||_[k].source.id==n||_[k].target==n||_[k].target.id==n)&&_.splice(k,1)}),O.forEach((l,h)=>{(l.target==n||l.source==n)&&(O.delete(h,1),F(!0))}),F(!1))},to=n=>{console.log(n),n&&O.delete(n.toString())},ct=n=>{n&&n!="index"?(v.delete(n.toString()),v.forEach((l,h)=>{const w=l.neighbors,_=l.links;for(let k=0;k<w.length;k++)w[k]===n&&w.splice(k,1);for(let k=0;k<_.length;k++)(_[k].source==n||_[k].source.id==n||_[k].target==n||_[k].target.id==n)&&_.splice(k,1)}),F(!1),wt()):n&&n==="index"&&o("deleteIndex")},St=()=>{u.graphData().nodes.forEach((n,l,h)=>{n.fx&&n.fy&&(n.fx=void 0,n.fy=void 0)}),F(!1)};function oo(){if(u.d3Force("center",We(0,0)),u.zoomToFit(300,20),f.value){const n=u.graphData().nodes;for(const[l,h]of Object.entries(n))if(h.id===f.value){u.d3Force("center",We(0,0)),u.centerAt(h.x,h.y,300);break}y.selectNode(f.value,!1)}}const qe=()=>{u&&u._destructor(),ue(),St(),F(),W.value=Object.entries(v.toJSON()),u.width(window.innerWidth),u.height(window.innerHeight);const n=q(!0);u.onEngineStop(()=>{const l=u.graphData().nodes;if(n.value)if(l.length>1){if(u.d3Force("center",We(0,0)),u.zoomToFit(50,20),n.value=!1,f.value){for(const[h,w]of Object.entries(l))if(w.id===f.value){u.d3Force("center",We(0,0)),u.centerAt(w.x,w.y,50);break}y.selectNode(f.value,!1)}}else u.zoomToFit(50,0);u.cooldownTicks(20)}),window.addEventListener("resize",()=>{u.width(window.innerWidth),u.height(window.innerHeight)}),window.addEventListener("orientationchange",function(){u.width(window.innerWidth),u.height(window.innerHeight)})};return Ne(()=>{if(d=document.getElementById(m),d!==void 0){v.observe(()=>{F(),W.value=Object.entries(v.toJSON())}),O.observe(()=>{F()}),re(f,(l,h)=>{z.autoLink&&O.set(l+"_"+h,{source:l,target:h,value:0})}),re(C,()=>{}),re(T,()=>{}),re(ot,()=>{ot.value&&y.updateStyle(x),ot.value||y.updateStyle(B)});const n=ee(()=>Ke.value.useStrongGravity);re(n,()=>{n.value?K():le()}),ot.value?y.updateStyle(x):y.updateStyle(B),n.value?K():le(),qe()}}),$e(()=>{u._destructor()}),re(f,()=>{f.value?(y.selectNode(f.value,!1),o("show")):(y.selectNode(void 0,!1),o("hide"))}),{galaxyState:z,Actions:y,graph:u,update:b,augmentGraphInfo:$,updateLinks:L,updateAll:F,zoomIn:U,zoomOut:R,gravityOn:K,gravityOff:le,nodesWithTitle:ge,hasNodesWithTitle:ve,doesNodeExist:xe,createNodeOrUpdate:we,directLinkNodes:Be,createRootNode:Je,createChildNode:te,doAction:J,initDataviz:ue,isWithUser:vt,getNodeColor:xt,getLinkColor:kt,getNodeState:rt,getLinkState:it,Draw:Fe,unsetID:wt,linkNodes:Yt,unlinkNodes2:Qt,deleteNodes2:eo,linkNodesPermanent:_t,unLinkNodes:lt,deleteNode:ct,unfixAll:St,Escape:oo,reRenderGraph:qe,jsonDocuments:W,yUndoManagerNodes:G}},pa=ae({props:{yRootDoc:null,ySubDoc:null,ySubDocIndexedDb:null,ySubDocs:null,jSubDocs:null,spaceId:null,docId:null,nodeId:null,hocuspocusProvider:null,webRtcProvider:null,subStates:null,rootStates:null,paneVisible:null},emits:["onBackgroundClick","onBackgroundRightClick","onNodeHover","onNodeClick","onNodeRightClick","onNodeDrag","onNodeDragEnd","onLinkRightClick","onZoom","onZoomEnd","onLinkHover","onLinkClick","onLinkRightClick","onEngineTick","onEngineStop","deleteIndex","hide","show"],setup(e,{emit:o}){const s=e,r=Ye(),{state:c}=ne(),{osKey:i}=he(),{galaxyState:m,graph:d,computedNodeId:g,gravityOn:I,gravityOff:f,reRenderGraph:u,Escape:v,deleteNodes2:O,unLinkNodes:G,unlinkNodes2:C,doAction:T,linkNodes:W,jsonDocuments:P,zoomIn:A,zoomOut:H,deleteNode:B,yUndoManagerNodes:x}=ua(s.ySubDoc,o,s.docId,s.rootStates,s.hocuspocusProvider,s.yRootDoc);window.rpc&&window.rpc.notify&&gt.listen("tauri://menu",({event:b,payload:y})=>{switch(y){case"Center-Gravity":I();break;case"No-Gravity":f();break;case"Unfix-Gravity":u();break;case"Previous Node":break;case"Next Node":break;case"Exit Node":v();break;case"Delete Node":O();break;case"Cut Node-Links":C();break;case"New Root-Node":T(!1,!1);break;case"New Child-Node":T(!1,{id:s.nodeId});break;case"Link Nodes":W();break}});const p=b=>{b.key==="Escape"&&(b.preventDefault(),v()),b.key==="k"&&i(b)&&!b.shiftKey&&(b.preventDefault(),T(!1,{id:s.nodeId})),b.key==="o"&&i(b)&&b.preventDefault(),b.key==="j"&&i(b)&&(b.preventDefault(),T(!1,!0)),b.key==="l"&&i(b)&&(b.preventDefault(),G(s.nodeId)),b.key==="+"&&i(b)&&(b.preventDefault(),A()),b.key==="."&&i(b)&&(b.preventDefault(),c.value.useStrongGravity=!c.value.useStrongGravity),b.key==="-"&&i(b)&&(b.preventDefault(),H()),b.key==="Backspace"&&i(b)&&(b.preventDefault(),B(s.nodeId))};return Ne(()=>{document.addEventListener("keydown",p)}),$e(()=>{document.removeEventListener("keydown",p)}),(b,y)=>(N(),M(me,null,[S(ca,{"y-sub-doc":e.ySubDoc,"sub-states":e.subStates,"j-sub-docs":e.jSubDocs,"hocuspocus-provider":e.hocuspocusProvider,"web-rtc-provider":e.webRtcProvider},null,8,["y-sub-doc","sub-states","j-sub-docs","hocuspocus-provider","web-rtc-provider"]),S(Pn,{"linking-nodes":t(m).linkingNodes,"unlinking-nodes":t(m).unlinkingNodes,"deleting-nodes":t(m).deletingNodes,onRefreshGraph:y[0]||(y[0]=$=>t(u)()),onUndo:y[1]||(y[1]=$=>t(x).undo()),onRedo:y[2]||(y[2]=$=>t(x).redo()),onLinkNodes:t(W),onUnlinkNodes:t(C),onCreateNode:y[3]||(y[3]=$=>e.nodeId?t(T)(!1,{id:e.nodeId}):t(T)(!1,!0)),onDeleteNode:t(O)},null,8,["linking-nodes","unlinking-nodes","deleting-nodes","onLinkNodes","onUnlinkNodes","onDeleteNode"]),a("div",{id:"graph",class:j([{"dark-bg":t(r)},"select-none fixed top-0 left-0 right-0 bottom-0"])},null,2)],64))}}),fa=e=>{const{isMobile:o,hasNotch:s}=he(),r=fe(),c=ce();let i;const m=ee(()=>c.params.document),d=ee(()=>c.params.node),g=je({paneCreated:!1,paneVisible:!1,paneState:"",backupPaneState:""}),I=()=>{o()&&(i.currentBreak()==="top"||i.moveToBreak("middle"))},f=()=>{g.paneVisible=!0,i.present()},u=()=>{i.hide()},v=H=>{d.value&&i.moveToBreak(H)},O=()=>{i.currentBreak()==="top"?(v("bottom"),g.paneState="bottom"):i.currentBreak()==="middle"?(v("top"),g.paneState="top"):i.currentBreak()==="bottom"&&(v("middle"),g.paneState="middle")},G=()=>{i.isPanePresented()&&!i.isHidden()&&(g.paneVisible=!1,i.hide())},C=()=>{r.push(`/${c.params.space}/${c.params.document}/`)},T=()=>{r.forward()},W=()=>{r.back()},P=()=>{i=new Mo(".editor-pane",{breaks:{top:{enabled:!0,height:window.innerHeight-(s()&&o()?110:50),bounce:!1},middle:{enabled:!0,height:s()&&o()?400:300,bounce:!1},bottom:{enabled:!0,height:s()&&o()?150:100,bounce:!1}},buttonClose:!1,showDraggable:o(),draggableOver:o(),initialBreak:"bottom",dragBy:[".pane .draggable"],clickBottomOpen:!1,fastSwipeClose:!1,fitHeight:!1,fitScreenHeight:!1,bottomOffset:-10,onDidDismiss:()=>{e.value&&m.value&&r.push(`/${e.value}/${m.value}/`),g.paneVisible=!1},onWillPresent:()=>{g.paneVisible=!0},onTransitionEnd:()=>{var H;g.paneState=i.currentBreak()?(H=i.currentBreak())==null?void 0:H.toString():"",i.isPanePresented()?d.value||i.hide():i.present()}}),g.paneCreated=!0,i.isPanePresented()?d.value||i.hide():i.present(),g.backupPaneState&&i.moveToBreak(g.backupPaneState)},A=()=>{var H;g.paneCreated=!1,g.backupPaneState=(H=i.currentBreak())==null?void 0:H.toString(),i.destroy()};return Ne(()=>{P()}),$e(()=>{A(),g.paneCreated=!1}),{editorPaneState:g,editorPane:i,moveToFocus:I,showPane:f,hidePane:G,moveTo:v,switchPane:O,hide:u,unsetId:C,goForward:T,goBack:W,destroyPane:A,createPane:P}},ga=(e,o,s)=>{const r=je({hasLoadedSubDoc:!1});fe();const c=ce(),i=ee(()=>c.params.node),m=e.getMap();let d;const g=()=>{m.delete(d.guid);const O=d.getMap("nodes"),G=d.getMap("links"),C=O.toJSON(),T=Object.entries(C),W=G.toJSON(),P=Object.entries(W);for(let A=0;A<T.length;A++){const H=d.getXmlFragment(T[A][0]);H.delete(0,H.length),O.delete(T[A][0])}for(let A=0;A<P.length;A++)G.delete(P[A][0])},I=O=>{const G=m.get(O);G?(G.updatedAt=new Date().toString(),m.set(O,G)):m.set(O,{guid:O,title:"Index",createdAt:new Date().toString(),updatedAt:new Date().toString()})};s&&s.length>=1?d=new Ze({guid:s,autoLoad:!0}):d=new Ze({autoLoad:!0});const f=d.getMap("nodes"),u=q(),v=new Lt(d.guid,d);return v.once("synced",()=>{r.hasLoadedSubDoc=!0,(!s||!i.value)&&I(d.guid),u.value=Object.entries(f.toJSON()),f.observe(()=>{u.value=Object.entries(f.toJSON())})}),{subDocState:r,ySubDoc:d,ySubDocIndexedDb:v,ySubDocs:f,jSubDocs:u,deleteSubDoc:g}},ha={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ma=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),ba={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},ya={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},va={class:"sm:flex sm:items-start"},xa={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},ka=de(" Do you want to delete all Nodes? "),wa=a("div",{class:"mt-2"},[a("p",{class:"text-sm font-medium text-gray-500"}," This action can only be partially reversed. ")],-1),_a={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Sa=ae({props:{open:null},emits:["action"],setup(e,{emit:o}){return(s,r)=>(N(),oe(t(Ie),{as:"template",show:e.open},{default:D(()=>[S(t(Oe),{as:"div",class:"fixed z-10 inset-0 overflow-y-auto",onClose:r[2]||(r[2]=c=>e.open=!1)},{default:D(()=>[a("div",ha,[S(t(ie),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[S(t(Ce),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),ma,S(t(ie),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",ba,[a("div",ya,[a("div",va,[a("div",xa,[S(t(Ho),{as:"h3",class:"text-lg leading-6 font-sans font-bold text-gray-900"},{default:D(()=>[ka]),_:1}),wa])])]),a("div",_a,[a("button",{type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:r[0]||(r[0]=c=>{e.open=!1,o("action")})}," Delete "),a("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:r[1]||(r[1]=c=>{e.open=!1,o("cancel")}),ref:(c,i)=>{i.cancelButtonRef=c}}," Cancel ",512)])])]),_:1})])]),_:1})]),_:1},8,["show"]))}}),$a={class:"overflow-hidden"},Na=ae({props:{yRootDoc:null,yRootDocIndexedDb:null,yRootDocs:null,jRootDocs:null,spaceId:null,spaceUrl:null,spaceToken:null,docId:null,nodeId:null,hocuspocusProvider:null,webRtcProvider:null,rootStates:null},setup(e){const o=e,s=fe();ce();const{state:r,logger:c,toggleSearch:i,checkForOpenWindows:m,toggleOnly:d}=ne(),{osKey:g}=he(),I=q(!1),f=q(),u=q(),{editorPaneState:v,editorPane:O,destroyPane:G,moveToFocus:C,showPane:T,hidePane:W,moveTo:P,switchPane:A,unsetId:H,goForward:B,goBack:x,createPane:p}=fa(o.spaceId),{subDocState:b,ySubDoc:y,ySubDocIndexedDb:$,ySubDocs:L,jSubDocs:F,deleteSubDoc:U}=ga(o.yRootDoc,o.spaceId,o.docId?o.docId:null),{subStates:R,provideAwareness:K,provideSubHocuspocus:le,provideSubWebRtc:ge}=Xt();K(y);const ve=ee(()=>o.nodeId);ee(()=>o.docId);const xe=ee(()=>r.value.useWebRtc),we=ee(()=>r.value.useHocuspocus);q(!1);const Be=Ye();xe.value&&!u.value&&(u.value=ge()),we.value&&!f.value&&(f.value=le(o.spaceUrl,o.spaceToken)),window.rpc&&window.rpc.notify&&gt.listen("tauri://menu",({event:te,payload:J})=>{switch(J){case"Open Search":i();break;case"Toggle Editor Breaks":A();break}});const Je=te=>{te.key==="Escape"&&(te.preventDefault(),s.push(`/${o.spaceId}/${o.docId}`)),te.key==="Tab"&&te.shiftKey&&!te.altKey&&(te.preventDefault(),A()),te.key==="f"&&g(te)&&(te.preventDefault(),d("search")),te.key==="Backspace"&&te.shiftKey&&g(te)&&(te.preventDefault(),U(o.docId)),te.key==="p"&&g(te)&&te.preventDefault()};return re(ve,()=>{ve.value&&ve.value.length>=3?T():W()}),re(xe,()=>{xe.value?u.value=ge():u.value&&u.value.destroy()}),re(we,()=>{we.value?f.value=le(o.spaceUrl,o.spaceToken):f.value&&f.value.destroy()}),Ne(()=>{document.addEventListener("keydown",Je),window.addEventListener("resize",()=>{})}),$e(()=>{u.value&&u.value.destroy(),f.value&&f.value.destroy(),document.removeEventListener("keydown",Je)}),(te,J)=>(N(),M("div",$a,[a("div",{class:j(["cupertino-pane editor-pane select-none",{blur:t(r)?t(r).blurredInterface&&!t(Be):!1,"blur-dark":t(r)?t(r).blurredInterface&&t(Be):!1,dark:t(r)&&!t(r).blurredInterface&&t(Be)}])},[t(b).hasLoadedSubDoc&&e.nodeId&&t(v).paneCreated||t(r).useHocuspocus&&t(R).hocuspocus.connected&&t(b).hasLoadedSubDoc&&e.nodeId&&t(v).paneCreated||t(r).useWebRtc&&t(R).rtc.connected&&t(b).hasLoadedSubDoc&&e.nodeId&&t(v).paneCreated?(N(),oe(an,{key:e.spaceId+e.docId+e.nodeId,"y-root-doc":e.yRootDoc,"y-root-docs":e.yRootDocs,"j-root-docs":e.jRootDocs,"y-sub-doc":t(y),"y-sub-doc-indexed-db":t($),"y-sub-docs":t(L),"j-sub-docs":t(F),"space-id":e.spaceId,"doc-id":e.docId,"node-id":e.nodeId,"hocuspocus-provider":f.value,"web-rtc-provider":u.value,"sub-states":t(R),"pane-visible":t(v).paneVisible,"pane-state":t(v).paneState,onOnFocus:J[0]||(J[0]=ue=>t(C)()),onBottom:J[1]||(J[1]=ue=>t(P)("bottom")),onMiddle:J[2]||(J[2]=ue=>t(P)("middle")),onTop:J[3]||(J[3]=ue=>t(P)("top")),onHide:J[4]||(J[4]=ue=>t(H)()),onBack:J[5]||(J[5]=ue=>t(x)()),onForward:J[6]||(J[6]=ue=>t(B)()),onSwitch:J[7]||(J[7]=ue=>t(A)())},null,8,["y-root-doc","y-root-docs","j-root-docs","y-sub-doc","y-sub-doc-indexed-db","y-sub-docs","j-sub-docs","space-id","doc-id","node-id","hocuspocus-provider","web-rtc-provider","sub-states","pane-visible","pane-state"])):V("",!0)],2),t(b).hasLoadedSubDoc&&e.docId&&t(v).paneCreated?(N(),oe(pa,{key:e.spaceId+e.docId,"y-root-doc":e.yRootDoc,"y-sub-doc":t(y),"y-sub-doc-indexed-db":t($),"y-sub-docs":t(L),"j-sub-docs":t(F),"space-id":e.spaceId,"doc-id":e.docId,"node-id":e.nodeId,"hocuspocus-provider":f.value,"web-rtc-provider":u.value,"sub-states":t(R),"root-states":e.rootStates,"pane-visible":t(v).paneVisible,onHide:t(W),onShow:t(T),onDeleteIndex:J[8]||(J[8]=ue=>I.value=!0)},null,8,["y-root-doc","y-sub-doc","y-sub-doc-indexed-db","y-sub-docs","j-sub-docs","space-id","doc-id","node-id","hocuspocus-provider","web-rtc-provider","sub-states","root-states","pane-visible","onHide","onShow"])):V("",!0),S(Sa,{open:I.value,onAction:J[9]||(J[9]=ue=>{t(U)(o.docId),I.value=!1}),onCancel:J[10]||(J[10]=ue=>I.value=!1)},null,8,["open"])]))}}),Ca={class:"fixed inset-0 z-50 dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 overflow-y-auto"},Da={class:"text-center"},Oa=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),Ia={class:"m-3"},Aa={key:0,class:"pb-4"},La={key:1,class:"relative z-0 w-full mb-4 inline-flex justify-between"},Ra=["onKeydown","placeholder"],Ta={class:"absolute inset-y-0 right-0 flex py-0.5 pr-1.5"},Pa=a("i",{class:"ri-question-fill text-2xl"},null,-1),Ea=[Pa],Ua=a("i",{class:"ri-close-circle-fill text-2xl"},null,-1),Ma=[Ua],Ha={class:"relative z-0 w-full inline-flex"},Ba=a("i",{class:"ri-focus-line pr-1.5 text-2xl"},null,-1),Fa=de(" New Gravity "),za=[Ba,Fa],ja=de(" Change Space "),Wa={class:"relative z-0 overflow-ellipsis w-full overflow-x-scroll"},Va={role:"list"},Ga={style:{"min-width":"300px"},class:"px-2"},Ka={class:"flex justify-between"},Ja={class:"flex"},qa={class:"mx-1 flex items-center text-sm w-64 font-bold overflow-hidden"},Za=a("div",{class:"mt-1 flex items-center text-sm sm:mt-0"},null,-1),Xa={class:"mt-1 flex items-center text-sm sm:mt-0"},Ya={key:0,class:"px-1 w-28 text-sm font-medium"},Qa=a("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"nodes ",-1),er={class:"w-48 text-md font-medium"},tr=a("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"UPDATED ",-1),or={class:"px-1 w-48 text-sm font-medium"},sr=a("span",{class:"uppercase font-bold text-gray-700 dark:text-gray-300 text-xs mr-2"},"CREATED ",-1),nr=a("p",{class:"opacity-0 px-2 groups-hover:opacity-100"},[a("i",{class:"ri-delete-bin-2-fill text-lg"})],-1),ar=ae({props:{yRootDoc:null,yRootDocIndexedDb:null,jRootDocs:null,hocuspocusProvider:null,webRtcProvider:null,rootStates:null},emits:["createDocument"],setup(e,{emit:o}){const s=e,r=ce(),c=fe(),{state:i,toggleSelector:m,toggleProvider:d,toggleShare:g,toggleUser:I,toggleOnly:f}=ne(),{getPlainText:u}=he(),v=q(""),O=q(0),G=(x,p)=>{H(x,p)},C=ee(()=>s.jRootDocs?s.jRootDocs.filter(x=>x[1].title&&u(x[1].title).toLowerCase().includes(v.value.toLowerCase())).sort((x,p)=>x.updatedAt>p.updatedAt?-1:x.updatedAt<p.updatedAt?1:0).sort((x,p)=>u(x.title)>u(p.title)?1:u(p.title)>u(x.title)?-1:0):[]),T=()=>{O.value=(O.value+C.value.length-1)%C.value.length},W=()=>{O.value=(O.value+1)%C.value.length},P=()=>{v.value=u(C.value[O.value][1].title)},A=()=>{v.value.startsWith("/")?c.push(v.value):v.value.startsWith("{")?B(v.value):H(C.value[O.value][0],O.value)},H=(x,p)=>{O.value=p,m(),c.push("/"+r.params.space+"/"+x+"/index"),p>=C.value.length},B=x=>{if(x){v.value="";const p=JSON.parse(x);if(p.nodes&&p.links&&p.documents){const b=new Ze;c.push(`/${r.params.space}/${b.guid}/index`);const y=Object.entries(p.links),$=Object.entries(p.nodes),L=b.getMap("nodes"),F=b.getMap("links");for(let U=0;U<$.length;U++)L.set($[U][0],$[U][1]);for(let U=0;U<y.length;U++)F.set(y[U][0],y[U][1]);for(let U=0;U<p.documents.length;U++);}}};return(x,p)=>{const b=Ge("router-link");return N(),oe(t(Ie),{show:t(i).isSelectorOpen,as:"template"},{default:D(()=>[S(t(Oe),{as:"div",onClose:t(m)},{default:D(()=>[a("div",Ca,[a("div",Da,[S(t(ie),{as:"template",enter:"duration-20 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-20 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[S(t(Ce),{class:"fixed inset-0 backdrop-filter backdrop-blur2"})]),_:1}),Oa,S(t(ie),{as:"template",enter:"ease-out duration-20","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-20","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:j(["inline-block align-bottom bg-white dark:bg-lityblack mt-16 p-0 rounded-lg pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:align-middle sm:max-w-4xl w-full",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(i).blurredInterface}])},[a("div",Ia,[e.rootStates.hocuspocus.awareness&&e.rootStates.hocuspocus.awareness.length>1?(N(),M("div",Aa,[(N(!0),M(me,null,Re(e.rootStates.hocuspocus.awareness.slice(1),y=>(N(),oe(Hn,{key:y.clientId,route:t(r),state:y},null,8,["route","state"]))),128))])):V("",!0),(N(),M("span",La,[a("form",{class:"w-full",onSubmit:p[3]||(p[3]=be(()=>{},["prevent"]))},[Te(a("input",{id:"search",onKeydown:[De(be(T,["prevent"]),["up"]),De(be(W,["prevent"]),["down"]),De(be(P,["prevent"]),["right"]),De(be(A,["prevent"]),["enter"])],"onUpdate:modelValue":p[0]||(p[0]=y=>v.value=y),placeholder:"/"+t(r).params.space+"/"+(t(r).params.document?t(r).params.document+"/"+(t(r).params.node?t(r).params.node:""):""),autocomplete:"off",autocapitalize:"off",spellcheck:"false",autofocus:"",tabindex:"0",type:"text",name:"search",class:"border-0 h-8 bg-white dark:bg-gray-800 dark:text-white bg-opacity-50 dark:bg-opacity-50 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-100 block w-full pl-3 py-5 pr-12 rounded-lg"},null,40,Ra),[[Pe,v.value]]),a("div",Ta,[a("button",{type:"button",class:"-ml-px p-1 relative inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-200 hover:opacity-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-blue-600",onClick:p[1]||(p[1]=y=>t(f)("info"))},Ea),a("button",{type:"button",class:"-ml-px p-1 relative inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-200 hover:opacity-50 focus:z-10 focus:outline-none focus:ring-1 focus:ring-blue-600",onClick:p[2]||(p[2]=(...y)=>t(m)&&t(m)(...y))},Ma)])],32)])),a("span",Ha,[a("button",{type:"button",class:"ml-1 p-1 pr-3 relative inline-flex items-center text-sm font-medium text-gray-900 dark:text-gray-100 hover:opacity-70 focus:z-10 focus:outline-none",onClick:p[4]||(p[4]=y=>{o("createDocument"),t(m)()})},za),a("button",{type:"button",class:"ml-1 p-1 pr-3 relative inline-flex items-center text-sm font-medium text-gray-900 dark:text-gray-100 hover:opacity-70 focus:z-10 focus:outline-none",onClick:p[5]||(p[5]=y=>{t(m)(),t(d)()})},[a("i",{class:j([{"animate animate-pulse text-green-600 dark:text-green-400":e.rootStates.hocuspocus.connected&&t(i).useHocuspocus},"ri-focus-2-line pr-1.5 text-2xl"])},null,2),ja]),a("button",{type:"button",class:"ml-1 p-1 pr-3 relative inline-flex items-center text-sm font-medium text-gray-900 dark:text-gray-100 hover:opacity-70 focus:z-10 focus:outline-none",onClick:p[6]||(p[6]=y=>{t(m)(),t(g)()})},[a("i",{class:j([{"animate animate-pulse text-blue-600 dark:text-blue-400":t(i).useWebRtc},"ri-broadcast-line pr-1.5 text-2xl"])},null,2),de(" "+se(t(i).useWebRtc?"Sharing":"Share")+" P2P ",1)]),a("button",{type:"button",class:"ml-1 p-1 pr-3 relative inline-flex items-center text-sm font-medium text-gray-900 dark:text-gray-100 hover:opacity-70 focus:z-10 focus:outline-none",onClick:p[7]||(p[7]=y=>{t(m)(),t(I)()})},[a("i",{class:"ri-fingerprint-line pr-1.5 text-2xl",style:Qe("color: "+t(i).localUserColor)},null,4),de(" "+se(t(i).localUserName),1)])])]),a("div",Wa,[a("ul",Va,[(N(!0),M(me,null,Re(t(C),(y,$)=>(N(),M("li",{class:"group",key:y[1].id},[y[1]&&y[1].title?(N(),oe(b,{key:0,"active-class":"bg-gray-200 dark:bg-gray-800",class:j(["mb-1 mt-1 m-3 block rounded-md bg-white text-black dark:text-white dark:bg-gray-900 bg-opacity-50 dark:bg-opacity-50 group-hover:bg-gray-100 group-hover:bg-opacity-50 dark:group-hover:bg-gray-800 overflow-x-scroll",{"bg-blue-100 group-hover:text-black ring-2 ring-blue-600 dark:group-hover:text-white hover:bg-blue-200 dark:bg-blue-700 dark:group-hover:bg-blue-800":$===O.value}]),to:"/"+t(r).params.space+"/"+y[1].id+"/index",onClick:L=>G(y[0],$)},{default:D(()=>[a("div",Ga,[a("div",Ka,[a("div",Ja,[a("p",qa,se(t(u)(y[1].title)),1)]),Za,a("div",Xa,[(N(),M("p",Ya,[Qa,de(" "+se(y[1].count),1)])),a("p",er,[tr,S(t(et),{time:y[1].updatedAt},{default:D(({timeAgo:L})=>[de(se(L),1)]),_:2},1032,["time"])]),a("p",or,[sr,S(t(et),{time:y[1].createdAt},{default:D(({timeAgo:L})=>[de(se(L),1)]),_:2},1032,["time"])]),nr])])])]),_:2},1032,["class","to","onClick"])):V("",!0)]))),128))])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])}}});var rr="/assets/icon.43d42a8c.png";const ir={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 backdrop-filter backdrop-blur2 inset-0 z-50 overflow-y-auto"},lr={class:"text-center"},cr=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),dr={class:"grid grid-cols-2 text-black dark:text-white"},ur=a("img",{class:"mx-auto h-32 w-auto",src:rr,alt:"lity logo"},null,-1),pr={class:"mx-auto my-auto"},fr=a("h1",{class:"mb-2 leading-1 text-2xl"},[de("Lity "),a("span",{class:"text-gray-700 dark:text-gray-300"},"Beta")],-1),gr={class:"text-gray-600 dark:text-gray-200"},hr=ae({setup(e){ce(),fe();const{state:o,toggleInfo:s}=ne();return(r,c)=>(N(),oe(t(Ie),{show:t(o).isInfoOpen,as:"template"},{default:D(()=>[S(t(Oe),{as:"div",onClose:t(s)},{default:D(()=>[a("div",ir,[a("div",lr,[S(t(ie),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[S(t(Ce),{class:"fixed inset-0"})]),_:1}),cr,S(t(ie),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:j(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all m-3 sm:align-middle sm:max-w-md sm:w-full sm:p-6",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(o).blurredInterface}])},[a("div",null,[a("div",dr,[ur,a("div",pr,[fr,a("span",gr,"Version "+se(t(o).version),1)])])]),V("",!0)],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),mr={class:"h-full flex flex-col overflow-hidden dark:text-white text-black"},br=ae({props:{spaceId:null,spaceUrl:null,spaceToken:null},setup(e){const o=e,s=ce(),{state:r,logger:c,toggleOnly:i}=ne(),{osKey:m}=he(),{getSpace:d,setGravity:g,setIndex:I}=tt(),{rootState:f,yRootDoc:u,yRootDocs:v,yRootIndexedDb:O,jRootDocs:G}=Os(o.spaceId),{rootStates:C,rootHocuspocusProvider:T,rootWebRtcProvider:W,rootAwareness:P,provideRootHocuspocus:A,provideRootWebRtc:H,destroyRootWebRtc:B,destroyRootHocuspocus:x}=As(u);d(o.spaceId);const p=ee(()=>r.value.useWebRtc),b=ee(()=>r.value.useHocuspocus);p.value&&H(),b.value&&A(o.spaceUrl,o.spaceToken);const y=ee(()=>s.params.space),$=ee(()=>s.params.document),L=ee(()=>s.params.node);re(L,()=>{F()}),re($,()=>{F(),$.value||g()}),re(y,()=>{I(o.spaceId,s.params.document)});const F=()=>{P.setLocalStateField("user",{latestNode:L.value?L.value:null,latestDocument:$.value?$.value:null,latestSpace:o.spaceId||null,name:r.value.localUserName,color:r.value.localUserColor}),r.value.localLatestNode=L.value?L.value:null,r.value.localLatestSpace=o.spaceId||null,r.value.localLatestDocument=$.value?$.value:null};window.rpc&&window.rpc.notify&&gt.listen("tauri://menu",({event:R,payload:K})=>{}),re(p,()=>{p.value?H():B()}),re(b,()=>{b.value?A(o.spaceUrl,o.spaceToken):x()});const U=R=>{R.key==="p"&&m(R)&&(R.preventDefault(),i("selector"))};return Ne(()=>{document.addEventListener("keydown",U)}),$e(()=>{document.removeEventListener("keydown",U)}),(R,K)=>(N(),M("div",mr,[S(hr),t(f).hasLoadedRootDoc?(N(),oe(ar,{key:0,"y-root-doc":t(u),"y-root-doc-indexed-db":t(O),"hocuspocus-provider":t(T),"web-rtc-provider":t(W),"root-states":t(C),"j-root-docs":t(G),onCreateDocument:t(g)},null,8,["y-root-doc","y-root-doc-indexed-db","hocuspocus-provider","web-rtc-provider","root-states","j-root-docs","onCreateDocument"])):V("",!0),t(f).hasLoadedRootDoc?(N(),oe(Na,{"y-root-doc":t(u),"y-root-doc-indexed-db":t(O),"y-root-docs":t(v),"j-root-docs":t(G),key:t(s).params.space+t(s).params.document,"space-id":t(s).params.space,"space-token":e.spaceToken,"space-url":e.spaceUrl,"doc-id":t(s).params.document,"node-id":t(s).params.node,"hocuspocus-provider":t(T),"web-rtc-provider":t(W),"root-states":t(C)},null,8,["y-root-doc","y-root-doc-indexed-db","y-root-docs","j-root-docs","space-id","space-token","space-url","doc-id","node-id","hocuspocus-provider","web-rtc-provider","root-states"])):V("",!0)]))}}),yr={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 backdrop-filter backdrop-blur2 inset-0 z-50 overflow-y-auto"},vr={class:"text-center"},xr=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),kr={class:"mt-2"},wr=a("h1",{class:"text-2xl text-center"},"Settings ",-1),_r={class:"mt-1"},Sr=a("div",{class:"text-xs font-sans font-bold text-gray-500 dark:text-gray-400 uppercase text-center tracking-wider"}," visual ",-1),$r={class:"my-2"},Nr=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Enable blurred windows",-1),Cr=a("div",{class:"text-xs font-sans font-bold text-gray-500 dark:text-gray-400 uppercase text-center tracking-wider"}," collaboration ",-1),Dr={class:"my-2"},Or=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Show other online users in selectors",-1),Ir={class:"my-2"},Ar=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Dye nodes in user color",-1),Lr={class:"my-2"},Rr=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Show cursors in nodes",-1),Tr=a("span",{class:"text-sm text-gray-500"},null,-1),Pr=a("div",{class:"text-xs font-sans font-bold text-gray-500 dark:text-gray-400 uppercase text-center tracking-wider"}," gravity ",-1),Er={class:"my-2"},Ur=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Use stronger gravity forces ",-1),Mr=a("span",{class:"text-sm mx-2 float-right text-gray-500"},[a("kbd",null,"\u2318"),a("kbd",null,".")],-1),Hr=ae({emits:["change"],setup(e,{emit:o}){ce(),fe();const{state:s,toggleInfo:r,toggleSettings:c,setDefaults:i}=ne();return q(),q(),(m,d)=>(N(),oe(t(Ie),{show:t(s).isSettingsOpen,as:"template"},{default:D(()=>[S(t(Oe),{as:"div",onClose:t(c)},{default:D(()=>[a("div",yr,[a("div",vr,[S(t(ie),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[S(t(Ce),{class:"fixed inset-0"})]),_:1}),xr,S(t(ie),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:j(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-3 text-left overflow-hidden shadow-xl transform transition-all sm:align-middle sm:max-w-md w-full",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(s).blurredInterface}])},[a("div",null,[a("div",kr,[wr,a("div",_r,[V("",!0),V("",!0),V("",!0),Sr,a("div",$r,[S(t(Ee),{as:"div",class:"flex justify-between"},{default:D(()=>[S(t(Ue),{as:"span",class:""},{default:D(()=>[Nr]),_:1}),S(t(Me),{modelValue:t(s).blurredInterface,"onUpdate:modelValue":d[2]||(d[2]=g=>t(s).blurredInterface=g),class:j([t(s).blurredInterface?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:j([t(s).blurredInterface?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),Cr,a("div",Dr,[S(t(Ee),{as:"div",class:"flex justify-between"},{default:D(()=>[S(t(Ue),{as:"span",class:""},{default:D(()=>[Or]),_:1}),S(t(Me),{modelValue:t(s).showOtherUsers,"onUpdate:modelValue":d[3]||(d[3]=g=>t(s).showOtherUsers=g),class:j([t(s).showOtherUsers?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:j([t(s).showOtherUsers?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),a("div",Ir,[S(t(Ee),{as:"div",class:"flex justify-between"},{default:D(()=>[S(t(Ue),{as:"span",class:""},{default:D(()=>[Ar]),_:1}),S(t(Me),{modelValue:t(s).showOtherColors,"onUpdate:modelValue":d[4]||(d[4]=g=>t(s).showOtherColors=g),class:j([t(s).showOtherColors?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:j([t(s).showOtherColors?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),a("div",Lr,[S(t(Ee),{as:"div",class:"flex justify-between"},{default:D(()=>[S(t(Ue),{as:"span",class:""},{default:D(()=>[Rr,Tr]),_:1}),S(t(Me),{modelValue:t(s).showOtherCursors,"onUpdate:modelValue":d[5]||(d[5]=g=>t(s).showOtherCursors=g),class:j([t(s).showOtherCursors?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:j([t(s).showOtherCursors?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),Pr,a("div",Er,[S(t(Ee),{as:"div",class:"flex justify-between"},{default:D(()=>[S(t(Ue),{as:"span",class:""},{default:D(()=>[Ur]),_:1}),Mr,S(t(Me),{modelValue:t(s).useStrongGravity,"onUpdate:modelValue":d[6]||(d[6]=g=>t(s).useStrongGravity=g),class:j([t(s).useStrongGravity?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:j([t(s).useStrongGravity?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),V("",!0),V("",!0),V("",!0),V("",!0),V("",!0),a("div",{onClick:d[12]||(d[12]=g=>{t(i)(),t(c)()}),class:"cursor-pointer text-xs font-sans font-bold m-5 text-gray-500 uppercase text-center tracking-wider"}," reset default ")])])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),Br={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 inset-0 z-50 overflow-y-auto"},Fr={class:"text-center"},zr=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),jr={class:""},Wr={class:"pb-2"},Vr=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Synchronize with Server",-1),Gr=a("span",{class:"text-sm text-gray-500 dark:text-gray-400"}," (when set)",-1),Kr={key:0,class:"mt-2"},Jr={class:"space-y-2"},qr=["onClick"],Zr={class:"flex dark:text-white text-black items-center"},Xr={class:"text-sm"},Yr={as:"p",class:"font-medium text-gray-900 dark:text-gray-100"},Qr={key:0,as:"div",class:"text-gray-500"},ei={class:"sm:inline"},ti=de(" "+se(" ")+" "),oi=a("span",{class:"hidden sm:inline sm:mx-1","aria-hidden":"true"},"\xB7",-1),si={key:1,class:""},ni={class:"my-2 w-full"},ai=a("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Server Address",-1),ri={class:"mt-1 relative rounded-md shadow-sm"},ii=["onUpdate:modelValue"],li={class:"my-1"},ci=a("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Access Code",-1),di={class:"mt-1 relative rounded-md shadow-sm"},ui=["onUpdate:modelValue"],pi=a("p",null,"Leave empty if you want this space to remain offline.",-1),fi=["onClick"],gi={as:"div",class:"mt-2 flex text-sm sm:mt-0 sm:block sm:ml-4 sm:text-right"},hi={class:"font-medium text-gray-900 dark:text-gray-300"},mi=ae({emits:["change"],setup(e,{emit:o}){const s=ce(),r=fe(),{state:c,toggleInfo:i,toggleProvider:m,toggleSelector:d,toggleOnly:g}=ne(),{localSpaces:I,resetSpaces:f,getSpace:u}=tt();q(),q();const v=q(I.value.spaces[0]);return(O,G)=>(N(),oe(t(Ie),{show:t(c).isProviderOpen,as:"template"},{default:D(()=>[S(t(Oe),{as:"div",onClose:t(m)},{default:D(()=>[a("div",Br,[a("div",Fr,[S(t(ie),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[S(t(Ce),{class:"fixed inset-0"})]),_:1}),zr,S(t(ie),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:j(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all m-3 sm:align-middle sm:max-w-md sm:w-full sm:p-6",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(c).blurredInterface}])},[a("div",null,[a("div",jr,[a("div",Wr,[S(t(Ee),{as:"div",class:"flex justify-between"},{default:D(()=>[S(t(Ue),{as:"span",class:""},{default:D(()=>[Vr,Gr]),_:1}),S(t(Me),{modelValue:t(c).useHocuspocus,"onUpdate:modelValue":G[0]||(G[0]=C=>t(c).useHocuspocus=C),class:j([t(c).useHocuspocus?"bg-green-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:j([t(c).useHocuspocus?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),(N(),M("div",Kr,[a("div",null,[a("div",Jr,[(N(!0),M(me,null,Re(t(I).spaces,C=>(N(),M("div",{as:"template",key:C.id,onClick:T=>v.value=C.id},[a("div",{class:j([C.id!==v.value?"border-transparent":"border-gray-300 ring-2 ring-blue-600",C.id===t(s).params.space?" ring-2 ring-blue-600 bg-blue-300 dark:bg-blue-600 bg-opacity-50 dark:bg-opacity-50":"","relative block border rounded-lg shadow-sm px-6 py-4 cursor-pointer sm:flex sm:justify-between focus:outline-none dark:bg-opacity-50 bg-opacity-50"])},[a("div",Zr,[a("div",Xr,[a("div",Yr,se(C.name),1),C.url?(N(),M("div",Qr,[a("p",ei,se(C.url)+" / "+se(C.id),1),ti,oi])):V("",!0),v.value===C.id?(N(),M("div",si,[a("div",ni,[ai,a("div",ri,[Te(a("input",{"onUpdate:modelValue":T=>C.url=T,tabindex:"0",type:"text",name:"lity-server",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"wss://causa.lity.cc"},null,8,ii),[[Pe,C.url]])])]),a("div",li,[ci,a("div",di,[Te(a("input",{"onUpdate:modelValue":T=>C.token=T,type:"text",name:"lity-server",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"xxxx-xxxx-xxxx-xxxx"},null,8,ui),[[Pe,C.token]])])]),pi,C.id!==t(s).params.space?(N(),M("button",{key:0,type:"button",class:"mt-2 rounded-lg p-3 shadow-xl bg-blue-700 text-white bg-opacity-50",onClick:T=>{t(r).push(`/${C.id}/`),t(g)("selector")}}," Set as current Space ",8,fi)):V("",!0)])):V("",!0)])]),a("div",gi,[a("div",hi,"/"+se(C.id),1)]),a("div",{class:j([C.id===t(s).params.space?"border":"border-2",C.id===v.value?"border-white":"border-opacity-50","absolute -inset-px rounded-lg pointer-events-none"]),"aria-hidden":"true"},null,2)],2)],8,qr))),128))])])])),V("",!0),V("",!0)])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),bi={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 backdrop-filter backdrop-blur2 inset-0 z-50 overflow-y-auto"},yi={class:"text-center"},vi=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),xi={class:""},ki={key:0,class:"mt-2"},wi={class:"mt-2"},_i=a("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Display Name",-1),Si={class:"mt-1 relative rounded-md shadow-sm"},$i={class:"mt-2"},Ni=a("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Color",-1),Ci={class:"mt-1 relative rounded-md shadow-sm"},Di={class:"absolute inset-y-0 right-0 flex py-0.5 pr-1.5"},Oi={type:"button",class:"-ml-px p-1 relative inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-200 focus:z-10 focus:outline-none"},Ii={class:"mt-4"},Ai={class:"flex justify-between","aria-label":"Tabs"},Li=["onClick"],Ri=ae({emits:["change"],setup(e,{emit:o}){ce(),fe();const{state:s,toggleInfo:r,toggleProvider:c,toggleUser:i}=ne();q(),q();const m=[{color:"#00a492",current:!1},{color:"#00b1ff",current:!1},{color:"#ffc711",current:!1},{color:"#F98181",current:!1},{color:"#b7f981",current:!1},{color:"#81eff9",current:!1},{color:"#8183f9",current:!1},{color:"#d181f9",current:!1},{color:"#f9ab81",current:!1},{color:"#f9e181",current:!1}];return(d,g)=>(N(),oe(t(Ie),{show:t(s).isUserOpen,as:"template"},{default:D(()=>[S(t(Oe),{as:"div",onClose:t(i)},{default:D(()=>[a("div",bi,[a("div",yi,[S(t(ie),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[S(t(Ce),{class:"fixed inset-0"})]),_:1}),vi,S(t(ie),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:j(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all m-3 sm:align-middle sm:max-w-md sm:w-full sm:p-6",{"bg-opacity-80 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(s).blurredInterface}])},[a("div",null,[a("div",xi,[(N(),M("div",ki,[a("div",wi,[_i,a("div",Si,[Te(a("input",{"onUpdate:modelValue":g[0]||(g[0]=I=>t(s).localUserName=I),type:"text",name:"lity-server",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"Name"},null,512),[[Pe,t(s).localUserName]])])]),a("div",$i,[Ni,a("div",Ci,[Te(a("input",{"onUpdate:modelValue":g[1]||(g[1]=I=>t(s).localUserColor=I),type:"text",name:"lity-server",class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"Color"},null,512),[[Pe,t(s).localUserColor]]),a("div",Di,[a("button",Oi,[a("i",{class:"ri-paint-brush-fill text-2xl",style:Qe("color: "+t(s).localUserColor)},null,4)])])])]),a("div",Ii,[a("nav",Ai,[(N(),M(me,null,Re(m,I=>a("span",{onClick:f=>t(s).localUserColor=I.color,key:I.color,style:Qe("cursor: pointer; background: "+I.color),class:j([[I.current?" text-gray-700":"text-gray-500 hover:text-gray-700","transition transition-opacity hover:opacity-50 px-3 py-2 font-medium text-sm rounded-md"],"inline-flex items-center justify-center h-8 w-8 rounded-full"])},null,14,Li)),64))])])]))])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),Ti={class:"fixed dark:bg-gray-900 bg-white bg-opacity-50 dark:bg-opacity-50 backdrop-filter backdrop-blur2 inset-0 z-50 overflow-y-auto"},Pi={class:"text-center"},Ei=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"\u200B",-1),Ui={class:""},Mi={class:""},Hi={class:"mt-0"},Bi=a("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"Share Gravity",-1),Fi=a("span",{class:"text-sm text-gray-500 dark:text-gray-400"}," (using WebRTC until restart)",-1),zi={key:0,class:"mt-2"},ji=a("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},"Share Link",-1),Wi={class:"mt-1 relative rounded-md shadow-sm"},Vi=["value"],Gi={key:1,class:"mt-2"},Ki=a("label",{for:"company-website",class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},[de("Password"),a("span",{class:"text-sm text-gray-500 dark:text-gray-400"}," (leave empty for an open room)")],-1),Ji={class:"mt-1 relative rounded-md shadow-sm"},qi=ae({emits:["share","stop-sharing"],setup(e,{emit:o}){ce(),fe();const{state:s,toggleShare:r}=ne();q(),q();const c=q();return Ne(()=>{const i=window.location.href.match("(.*)#\\/(.+)");i&&i.length>1&&(c.value="https://app.lity.cc/#/"+i[2])}),(i,m)=>(N(),oe(t(Ie),{show:t(s).isShareOpen,as:"template"},{default:D(()=>[S(t(Oe),{as:"div",onClose:t(r)},{default:D(()=>[a("div",Ti,[a("div",Pi,[S(t(ie),{as:"template",enter:"duration-50 ease-out","enter-from":"opacity-0","enter-to":"opacity-50",leave:"duration-50 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>[S(t(Ce),{class:"fixed inset-0"})]),_:1}),Ei,S(t(ie),{as:"template",enter:"ease-out duration-50","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-50","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",{class:j(["inline-block align-bottom bg-white dark:text-white dark:bg-lityblack rounded-lg mt-16 px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all m-3 sm:align-middle sm:max-w-md sm:w-full sm:p-6",{"bg-opacity-50 dark:bg-lityblackblur backdrop-filter backdrop-blur":t(s).blurredInterface}])},[a("div",null,[a("div",Ui,[a("div",Mi,[a("div",Hi,[S(t(Ee),{as:"div",class:"flex justify-between"},{default:D(()=>[S(t(Ue),{as:"span",class:""},{default:D(()=>[Bi,Fi]),_:1}),S(t(Me),{modelValue:t(s).useWebRtc,"onUpdate:modelValue":m[0]||(m[0]=d=>t(s).useWebRtc=d),class:j([t(s).useWebRtc?"bg-blue-600":"bg-gray-200 dark:bg-gray-800","relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},{default:D(()=>[a("span",{"aria-hidden":"true",class:j([t(s).useWebRtc?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200"])},null,2)]),_:1},8,["modelValue","class"])]),_:1})]),t(s).useWebRtc?(N(),M("div",zi,[ji,a("div",Wi,[a("input",{type:"text",name:"webrtc-password",readonly:"",value:c.value,class:"h-8on bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg select-all",placeholder:"Share Link"},null,8,Vi)])])):V("",!0),t(s).useWebRtc?(N(),M("div",Gi,[Ki,a("div",Ji,[Te(a("input",{type:"text",name:"webrtc-password","onUpdate:modelValue":m[1]||(m[1]=d=>t(s).localWebRtcPassword=d),class:"h-8 bg-white border-0 dark:bg-white dark:text-white bg-opacity-50 dark:bg-opacity-5 focus:ring-2 focus:ring-blue-600 text-lg shadow-lg bg-opacity-1 block w-full pl-3 py-5 rounded-lg",placeholder:"Room Password"},null,512),[[Pe,t(s).localWebRtcPassword]])])])):V("",!0)])])])],2)]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}}),Zi={class:"w-screen h-screen"},st={setup(e){const{state:o,toggleOnly:s}=ne(),{osKey:r}=he(),{redirect:c,isRedirected:i,spaceId:m,spaceUrl:d,spaceToken:g}=tt();c();const I=f=>{f.key===","&&r(f)&&(f.preventDefault(),s("settings"))};return Ne(()=>{document.addEventListener("keydown",I)}),$e(()=>{document.removeEventListener("keydown",I)}),(f,u)=>(N(),M("div",Zi,[S(Hr),S(mi),S(Ri),S(qi),t(i)?(N(),oe(br,{"space-id":t(m),key:t(m),"space-token":t(g),"space-url":t(d)},null,8,["space-id","space-token","space-url"])):V("",!0)]))}},Xi=[{path:"/",component:st},{path:"/:space",component:st},{path:"/:space/:document",component:st},{path:"/:space/:document/:node",component:st}],Yi=Bo({history:Fo(),linkActiveClass:"text-gray-900 font-bold",routes:Xi});var nt;(function(e){e.INCREMENT="INCREMENT",e.RESTORE="RESTORE"})(nt||(nt={}));const Qi={[nt.INCREMENT](e,o=1){e.count+=o},[nt.RESTORE](e,o){o.localUserName&&(e.localUserName=o.localUserName),o.localUserColor&&(e.localUserColor=o.localUserColor),o.serverAddress&&(e.serverAddress=o.serverAddress),o.serverToken&&(e.serverToken=o.serverToken),o.v1&&(e.v1=o.v1)}};var He;(function(e){e.initApp="initApp",e.openInfo="openInfo",e.openSelector="openSelector",e.openSettings="openSettings",e.openSearch="openSearch"})(He||(He={}));const el={[He.initApp]({state:e,commit:o,dispatch:s}){},[He.openSelector]({state:e,commit:o,dispatch:s}){e.isSelectorOpen=!e.isSelectorOpen},[He.openInfo]({state:e,commit:o,dispatch:s}){e.isInfoOpen=!e.isInfoOpen},[He.openSettings]({state:e,commit:o,dispatch:s}){e.isSettingsOpen=!e.isSettingsOpen},[He.openSearch]({state:e,commit:o,dispatch:s}){e.isSearchOpen=!e.isSearchOpen}},tl={isReady(e){return!e.isInitialized}},ol="1.2.4",sl={debug:!1,version:ol,isInitialized:!1,isOffline:!1,count:0,localUserName:"",localUserColor:"",localUserId:"",serverAddress:"",serverToken:"",isSettingsOpen:!1,isInfoOpen:!1,isSelectorOpen:!1,isSearchOpen:!1,useRTC:!1,useHocuspocus:!0},nl=zo({state:sl,getters:tl,mutations:Qi,actions:el});const al=60*60*1e3;Vt({onRegistered(e){e&&setInterval(()=>{e.update()},al)}});const rl=jo(),at=Wo(Yo);at.use(nl);at.use(Yi);at.use(rl);at.mount("#app");
